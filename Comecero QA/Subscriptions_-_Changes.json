{
  "info": {
    "_postman_id": "15fc375e-531c-41d0-b2d4-c1b7ed832e4e",
    "name": "Subscriptions - Changes",
    "description": "This set of tests expects you to be using the Base Account.",
    "schema": "https://schema.getpostman.com/json/collection/v2.0.0/collection.json"
  },
  "item": [
    {
      "_postman_id": "e249d914-1176-4db3-8c3c-f894365b80d1",
      "name": "Pre-request Configurations",
      "description": "",
      "item": [
        {
          "_postman_id": "b1e21aeb-a714-47ff-a05c-e23022efda24",
          "name": "Get Notification Subscriptions",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "09e78ddc-848e-4610-a39c-393e9d4f1259",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "",
                  "// Find the payment, order notification subscriptions",
                  "var notifications = JSON.parse(responseBody);",
                  "var list = notifications.data;",
                  "",
                  "_.each(list, function(item) {",
                  "    ",
                  "    if (item.type === \"order:confirmation\")",
                  "        pm.globals.set(\"order_confirmation_subscription_url\", item.url);",
                  "        ",
                  "            if (item.type === \"payment:confirmation\")",
                  "        pm.globals.set(\"payment_confirmation_subscription_url\", item.url);",
                  "        ",
                  "            if (item.type === \"refund:confirmation\")",
                  "        pm.globals.set(\"refund_confirmation_subscription_url\", item.url);        ",
                  "    ",
                  "});",
                  "",
                  "",
                  ""
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "aba03a74-55f6-4b4f-9ff9-e0e92a9f735a",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "https://{{host}}/api/v1/notification_subscriptions",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "198a3de0-9b75-4b45-9623-f524dc6b0ce4",
          "name": "Disable Order Notification Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "ec320aec-60a1-416a-8184-2ebe91db1f38",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Order email notifications have been disabled\"] = responseCode.code === 200;",
                  "",
                  "",
                  ""
                ]
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "aba03a74-55f6-4b4f-9ff9-e0e92a9f735a",
                "type": "text/javascript",
                "exec": [
                  ""
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"active\": false\n}"
            },
            "url": "{{order_confirmation_subscription_url}}",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "fe766129-3a5e-4e03-abfd-4f2dd8bf1d69",
          "name": "Disable Payment Notification Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "82452e4c-9550-4daa-8063-f5b84f40aee0",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Payment email notifications have been disabled\"] = responseCode.code === 200;",
                  "",
                  ""
                ]
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "aba03a74-55f6-4b4f-9ff9-e0e92a9f735a",
                "type": "text/javascript",
                "exec": [
                  ""
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"active\": false\n}"
            },
            "url": "{{payment_confirmation_subscription_url}}",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "462ebf98-b8e4-4b3b-b44e-da4cb082c475",
          "name": "Disable Refund Notification Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "82452e4c-9550-4daa-8063-f5b84f40aee0",
                "exec": [
                  "tests[\"Refund email notifications have been disabled\"] = responseCode.code === 200;",
                  "",
                  ""
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "aba03a74-55f6-4b4f-9ff9-e0e92a9f735a",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"active\": false\n}"
            },
            "url": "{{refund_confirmation_subscription_url}}",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "7dc53f33-4609-4dd9-a7e7-63b7839c44ea",
          "name": "Get Subscription Plans",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "a7f20a52-80fb-4c20-a8d5-e7c404517d70",
                "exec": [
                  "tests[\"Get subscription plans\"] = responseCode.code === 200;",
                  "",
                  "var list = JSON.parse(responseBody);",
                  "var data = list.data;",
                  "",
                  "data.forEach(function(item) {",
                  "    ",
                  "    if (item.billing_interval_unit === \"minute\" && item.trial_interval_unit === null) {",
                  "        pm.globals.set(\"five_minute_subscription_plan_id\", item.subscription_plan_id);",
                  "    }",
                  "    ",
                  "    if (item.billing_interval_unit === \"minute\" && item.trial_interval_unit === \"minute\") {",
                  "        pm.globals.set(\"five_minute_subscription_with_trial_plan_id\", item.subscription_plan_id);",
                  "    }",
                  "    ",
                  "    if (item.billing_interval_unit === \"hour\" && item.billing_interval === 1 && item.trial_interval_unit === null) {",
                  "        pm.globals.set(\"hour_subscription_plan_id\", item.subscription_plan_id);",
                  "    }",
                  "    ",
                  "    if (item.billing_interval_unit === \"hour\" && item.billing_interval === 1 && item.trial_interval_unit === \"hour\") {",
                  "        pm.globals.set(\"hour_subscription_with_trial_plan_id\", item.subscription_plan_id);",
                  "    }",
                  "    ",
                  "    if (item.billing_interval_unit === \"hour\" && item.billing_interval === 2 && item.trial_interval_unit === null) {",
                  "        pm.globals.set(\"two_hour_subscription_plan_id\", item.subscription_plan_id);",
                  "    }",
                  "    ",
                  "    if (item.billing_interval_unit === \"hour\" && item.billing_interval === 2 && item.trial_interval_unit === \"hour\") {",
                  "        pm.globals.set(\"two_hour_subscription_with_trial_plan_id\", item.subscription_plan_id);",
                  "    }    ",
                  "    ",
                  "});"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "812a60fa-cc92-46a0-914d-6599430f5976",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "https://{{host}}/api/v1/subscription_plans",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        }
      ],
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "id": "db236e77-f986-4125-b356-5008a2e559a8",
            "type": "text/javascript",
            "exec": [
              ""
            ]
          }
        },
        {
          "listen": "test",
          "script": {
            "id": "fa8477f9-7918-46af-8244-edb14f473d45",
            "type": "text/javascript",
            "exec": [
              ""
            ]
          }
        }
      ]
    },
    {
      "_postman_id": "43fb8e33-9ac3-4faf-b9e7-1f927a838c18",
      "name": "Quantity Change Up, Immediate",
      "description": "",
      "item": [
        {
          "_postman_id": "14b083c2-a1cc-483d-90a4-453f6f8a78c3",
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "2e45bc1a-8ef7-4349-8712-acfbab72f23e",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);",
                  "pm.globals.set(\"item_total\", data.items[0].total);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "812a60fa-cc92-46a0-914d-6599430f5976",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital-sub.test\",\r\n         \"quantity\":1\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }   \r\n}"
            },
            "url": {
              "raw": "https://{{host}}/api/v1/carts?expand=items.subscription_plan,items.subscription_terms",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "carts"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "items.subscription_plan,items.subscription_terms",
                  "equals": true
                }
              ]
            }
          },
          "response": []
        },
        {
          "_postman_id": "8c5158e8-38af-49fc-a1d4-f9d26d7b68e1",
          "name": "Submit Cart Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.order.items[0];",
                  "tests[\"Subscription was created\"] === item.subcription !== null;",
                  "pm.globals.set(\"subscription_url\", item.subscription);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "{{cart_url}}/payments?expand=order.items",
              "host": [
                "{{cart_url}}"
              ],
              "path": [
                "payments"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order.items",
                  "equals": true
                }
              ]
            }
          },
          "response": []
        },
        {
          "_postman_id": "752a11b4-fc69-4293-ab14-8459c95d925f",
          "name": "Get the Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.items[0];",
                  "pm.globals.set(\"subscription_item\", item);",
                  "pm.globals.set(\"subscription_item_url\", item.url);",
                  "pm.globals.set(\"date_current_period_end\", data.date_current_period_end);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "{{subscription_url}}"
          },
          "response": []
        },
        {
          "_postman_id": "6da33cf6-0155-4a74-a9a6-568a8853f050",
          "name": "Wait 3 seconds",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "a05ebd5c-7c23-42c3-9eb9-63ddde25ee85",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "",
                  "var date = new Date();",
                  "var waitForMinutes = 7;",
                  "",
                  "tests[\"Waiting a few seconds to burn down subscription used time\"] = true;",
                  "",
                  "setTimeout(function() {",
                  "    tests[\"Timer completed. Testing resuming...\"] = true;",
                  "}, 3000);",
                  "",
                  "",
                  ""
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "9751ab2a-b7c5-4e5c-9971-064d19f11c72",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "https://{{host}}/api/v1/subscriptions"
          },
          "response": []
        },
        {
          "_postman_id": "6b0dc3ff-ae74-408e-bd54-db5b3e384d41",
          "name": "Preview",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "var now = new Date();",
                  "var dateEffective = new Date(data.date_effective);",
                  "var diff = Math.abs(now - dateEffective);",
                  "",
                  "tests[\"Date effective is OK \" + now + \", \" + data.date_effective + \", \" + diff] = diff < 60000; // Should be \"now\", basically but we'll give a bit of a buffer to handle any time differences between client and server.",
                  "",
                  "tests[\"New quantity is in subcription terms\"] = data.subscription_terms.quantity === 2;",
                  "",
                  "pm.globals.set(\"payment_total\", data.payment_total);",
                  "pm.globals.set(\"refund_total\", data.refund_total);",
                  "pm.globals.set(\"net_total\", data.net_total);",
                  "pm.globals.set(\"date_effective\", data.date_effective);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"apply_immediately\": true,\n\t\"quantity\": 2\n}"
            },
            "url": {
              "raw": "{{subscription_item_url}}/preview?expand=subscription.invoices",
              "host": [
                "{{subscription_item_url}}"
              ],
              "path": [
                "preview"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "subscription.invoices",
                  "equals": true
                }
              ]
            }
          },
          "response": []
        },
        {
          "_postman_id": "af24adca-2be2-4ad5-9cbc-772391651d51",
          "name": "Change Item Quantity",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "// There should be one subscription and the total should be less than the item total",
                  "tests[\"Change invoice was created\"] = data.subscription.invoices.total_items === 1;",
                  "tests[\"Invoice amount was pro-rated, total: \" + data.subscription.invoices.data[0].total] = data.subscription.invoices.data[0].total < pm.globals.get(\"item_total\") * 2; // Multiply by the new quantity",
                  "",
                  "// Compare with the preview amounts",
                  "tests[\"Invoice total equals the preview payment total\"] = data.subscription.invoices.data[0].total == pm.globals.get(\"payment_total\");",
                  "",
                  "// The external payment should be the same as the net total.",
                  "data.subscription.customer.payments.data = data.subscription.customer.payments.data.reverse();",
                  "var payment = _.find(data.subscription.customer.payments.data, function(p) { return p.payment_method.type === \"credit_card\" });",
                  "tests[\"Credit card payment equals net total \" + pm.globals.get(\"net_total\")] = pm.globals.get(\"net_total\") === payment.total;",
                  "",
                  "// The refund should be to customer account balance and be the same as the refund total",
                  "tests[\"No refund has been processed\"] = data.subscription.customer.refunds.data.length === 0;",
                  "",
                  "tests[\"Date next payment is OK \" + pm.globals.get(\"date_current_period_end\")] = data.subscription.date_current_period_end === pm.globals.get(\"date_current_period_end\");"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"date_effective\": \"{{date_effective}}\",\t\n\t\"apply_immediately\": true,\n\t\"quantity\": 2\n}"
            },
            "url": {
              "raw": "{{subscription_item_url}}?expand=subscription.invoices,subscription.customer.payments.payment_method,subscription.customer.refunds.payment_method",
              "host": [
                "{{subscription_item_url}}"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "subscription.invoices,subscription.customer.payments.payment_method,subscription.customer.refunds.payment_method",
                  "equals": true
                }
              ]
            }
          },
          "response": []
        },
        {
          "_postman_id": "a465ba70-45fb-4543-9cdb-2dcb25d9c2c5",
          "name": "Change Item Quantity with Bad URL",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 404\"] = responseCode.code === 404;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"quantity\": 2\n}"
            },
            "url": {
              "raw": "{{subscription_item_url}}xxx?expand=subscription.invoices",
              "host": [
                "{{subscription_item_url}}xxx"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "subscription.invoices",
                  "equals": true
                }
              ]
            }
          },
          "response": []
        },
        {
          "_postman_id": "4d7d365a-6285-49a5-b224-d2beb0502f9f",
          "name": "Cancel Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Subscription cancelled successfully\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "tests[\"Subscription cancellation confirmed\"] = data.status === \"cancelled\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"cancel_at_current_period_end\": false,\n    \"cancellation_reason\": \"Cancelled upon completion of an automated test\"\n}"
            },
            "url": "{{subscription_url}}/cancel"
          },
          "response": []
        }
      ]
    },
    {
      "_postman_id": "5dbe7b72-406a-47d1-bbec-6c008990bd99",
      "name": "Quantity Change Up, Period End",
      "description": "",
      "item": [
        {
          "_postman_id": "df7feea3-610d-4d50-9de1-52466115418e",
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "2e45bc1a-8ef7-4349-8712-acfbab72f23e",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);",
                  "pm.globals.set(\"item_total\", data.items[0].total);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "812a60fa-cc92-46a0-914d-6599430f5976",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital-sub.test\",\r\n         \"quantity\":1\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }   \r\n}"
            },
            "url": {
              "raw": "https://{{host}}/api/v1/carts?expand=items.subscription_plan,items.subscription_terms",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "carts"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "items.subscription_plan,items.subscription_terms",
                  "equals": true
                }
              ]
            }
          },
          "response": []
        },
        {
          "_postman_id": "c0744ad5-22ff-4659-8b12-443d1b8f33e0",
          "name": "Submit Cart Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.order.items[0];",
                  "tests[\"Subscription was created\"] === item.subcription !== null;",
                  "pm.globals.set(\"subscription_url\", item.subscription);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "{{cart_url}}/payments?expand=order.items",
              "host": [
                "{{cart_url}}"
              ],
              "path": [
                "payments"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order.items",
                  "equals": true
                }
              ]
            }
          },
          "response": []
        },
        {
          "_postman_id": "1d313a94-1b96-40b0-a643-3d73111f13c4",
          "name": "Get the Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.items[0];",
                  "pm.globals.set(\"subscription_item\", item);",
                  "pm.globals.set(\"subscription_item_url\", item.url);",
                  "pm.globals.set(\"date_current_period_end\", data.date_current_period_end);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "{{subscription_url}}"
          },
          "response": []
        },
        {
          "_postman_id": "9951fda2-5d5b-4143-abfe-89594ba6cb32",
          "name": "Preview",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Subscription term is OK\"] = data.subscription_terms.billing_interval === 1 && data.subscription_terms.billing_interval_unit === \"hour\";",
                  "tests[\"Trial term is OK\"] = data.subscription_terms.trial_interval === null && data.subscription_terms.trial_interval_unit === null;",
                  "tests[\"Payment total is 0\"] = data.payment_total === 0;",
                  "tests[\"Net total is 0\"] = data.net_total === 0;",
                  "tests[\"Date next payment is OK \" + data.date_next_payment] = data.date_next_payment === pm.globals.get(\"date_current_period_end\");",
                  "tests[\"Date effective is OK \" + data.date_effective] = data.date_effective === pm.globals.get(\"date_current_period_end\");",
                  "",
                  "pm.globals.set(\"payment_total\", data.payment_total);",
                  "pm.globals.set(\"refund_total\", data.refund_total);",
                  "pm.globals.set(\"net_total\", data.net_total);",
                  "pm.globals.set(\"date_effective\", data.date_effective);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"apply_immediately\": false,\n\t\"quantity\": 2\n}"
            },
            "url": {
              "raw": "{{subscription_item_url}}/preview?expand=subscription.invoices",
              "host": [
                "{{subscription_item_url}}"
              ],
              "path": [
                "preview"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "subscription.invoices",
                  "equals": true
                }
              ]
            }
          },
          "response": []
        },
        {
          "_postman_id": "39398421-0b31-4023-9bf3-d6e204c83240",
          "name": "Change Item Quantity",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "// There should be one subscription and the total should be less than the item total",
                  "tests[\"Change invoice was not created\"] = data.subscription.invoices.total_items === 0;",
                  "tests[\"Change request recorded\"] = data.subscription.items[0].change_at_current_period_end.quantity === 2;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"apply_immediately\": false,\n\t\"quantity\": 2\n}"
            },
            "url": {
              "raw": "{{subscription_item_url}}?expand=subscription.invoices",
              "host": [
                "{{subscription_item_url}}"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "subscription.invoices",
                  "equals": true
                }
              ]
            }
          },
          "response": []
        },
        {
          "_postman_id": "be4d7a8f-0995-4a19-9d65-5147964c059e",
          "name": "Cancel Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Subscription cancelled successfully\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "tests[\"Subscription cancellation confirmed\"] = data.status === \"cancelled\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"cancel_at_current_period_end\": false,\n    \"cancellation_reason\": \"Cancelled upon completion of an automated test\"\n}"
            },
            "url": "{{subscription_url}}/cancel"
          },
          "response": []
        }
      ]
    },
    {
      "_postman_id": "1ff557c8-9dfb-4b26-ab1c-10d218bb02e9",
      "name": "Quantity Change Down, Immediate",
      "description": "",
      "item": [
        {
          "_postman_id": "d3c926a6-e875-41f3-b9c8-95034700849b",
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "2e45bc1a-8ef7-4349-8712-acfbab72f23e",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);",
                  "pm.globals.set(\"item_total\", data.items[0].total);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "812a60fa-cc92-46a0-914d-6599430f5976",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital-sub.test\",\r\n         \"quantity\":2\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }   \r\n}"
            },
            "url": {
              "raw": "https://{{host}}/api/v1/carts?expand=items.subscription_plan,items.subscription_terms",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "carts"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "items.subscription_plan,items.subscription_terms",
                  "equals": true
                }
              ]
            }
          },
          "response": []
        },
        {
          "_postman_id": "fa60297e-461b-45cb-8adf-c883bb3ed752",
          "name": "Submit Cart Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.order.items[0];",
                  "tests[\"Subscription was created\"] === item.subcription !== null;",
                  "pm.globals.set(\"subscription_url\", item.subscription);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "{{cart_url}}/payments?expand=order.items",
              "host": [
                "{{cart_url}}"
              ],
              "path": [
                "payments"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order.items",
                  "equals": true
                }
              ]
            }
          },
          "response": []
        },
        {
          "_postman_id": "b094ab05-b89f-422f-91d5-6bca082f254f",
          "name": "Get the Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.items[0];",
                  "pm.globals.set(\"subscription_item\", item);",
                  "pm.globals.set(\"subscription_item_url\", item.url);",
                  "pm.globals.set(\"date_current_period_end\", data.date_current_period_end);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "{{subscription_url}}"
          },
          "response": []
        },
        {
          "_postman_id": "b0e92f72-edde-4233-b36a-c20443f04cda",
          "name": "Wait 3 seconds",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "a05ebd5c-7c23-42c3-9eb9-63ddde25ee85",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "",
                  "var date = new Date();",
                  "var waitForMinutes = 7;",
                  "",
                  "tests[\"Waiting a few seconds to burn down subscription used time\"] = true;",
                  "",
                  "setTimeout(function() {",
                  "    tests[\"Timer completed. Testing resuming...\"] = true;",
                  "}, 3000);",
                  "",
                  "",
                  ""
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "9751ab2a-b7c5-4e5c-9971-064d19f11c72",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "https://{{host}}/api/v1/subscriptions"
          },
          "response": []
        },
        {
          "_postman_id": "fa8a72c1-1ac7-4773-ae6c-04cf4655a88f",
          "name": "Preview",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "var now = new Date();",
                  "var dateEffective = new Date(data.date_effective);",
                  "var diff = Math.abs(now - dateEffective);",
                  "",
                  "tests[\"Date effective is OK \" + now + \", \" + data.date_effective + \", \" + diff] = diff < 60000; // Should be \"now\", basically but we'll give a bit of a buffer to handle any time differences between client and server.",
                  "tests[\"New quantity is in subcription terms\"] = data.subscription_terms.quantity === 1;",
                  "tests[\"Payment total is 0\"] = data.payment_total === 0;",
                  "tests[\"There will be a refund\"] = data.refund_total > 0;",
                  "",
                  "pm.globals.set(\"payment_total\", data.payment_total);",
                  "pm.globals.set(\"refund_total\", data.refund_total);",
                  "pm.globals.set(\"net_total\", data.net_total);",
                  "pm.globals.set(\"date_effective\", data.date_effective);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"apply_immediately\": true,\n\t\"quantity\": 1\n}"
            },
            "url": {
              "raw": "{{subscription_item_url}}/preview?expand=subscription.invoices",
              "host": [
                "{{subscription_item_url}}"
              ],
              "path": [
                "preview"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "subscription.invoices",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "b15b7cc6-a315-445f-a7c6-876eeea4b16b",
          "name": "Change Item Quantity",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "// There should be one subscription and the total should be less than the item total",
                  "tests[\"No invoices were created\"] = data.subscription.invoices.total_items === 0;",
                  "tests[\"Refund was submited\"] = data.subscription.customer.refunds.total_items === 1;",
                  "tests[\"Refund was the expected amount, total: \" + data.subscription.customer.refunds.data[0].total] = data.subscription.customer.refunds.data[0].total < (pm.globals.get(\"item_total\") / 2);",
                  "",
                  "// Compare with the preview amounts",
                  "tests[\"Refund total equals the preview refund total\"] = data.subscription.customer.refunds.data[0].total == pm.globals.get(\"refund_total\");",
                  "",
                  "// The external refund should be the same as the net total.",
                  "data.subscription.customer.refunds.data = data.subscription.customer.refunds.data.reverse();",
                  "tests[\"Credit card refund equals net total \" + pm.globals.get(\"net_total\")] = pm.globals.get(\"net_total\") === data.subscription.customer.refunds.data[0].total * -1;",
                  "",
                  "//tests[\"A new payment has not been processed\"] = data.subscription.customer.payments.data.length === 1;",
                  "",
                  "tests[\"Date next payment is OK \" + pm.globals.get(\"date_current_period_end\")] = data.subscription.date_current_period_end === pm.globals.get(\"date_current_period_end\");"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"date_effective\": \"{{date_effective}}\",\t\t\n\t\"apply_immediately\": true,\t\n\t\"quantity\": 1\n}"
            },
            "url": {
              "raw": "{{subscription_item_url}}?expand=subscription.invoices,subscription.customer.payments.payment_method,subscription.customer.refunds.payment_method",
              "host": [
                "{{subscription_item_url}}"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "subscription.invoices,subscription.customer.payments.payment_method,subscription.customer.refunds.payment_method",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "d15eec0b-dce6-4229-97a6-f790f80cde4a",
          "name": "Cancel Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Subscription cancelled successfully\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "tests[\"Subscription cancellation confirmed\"] = data.status === \"cancelled\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"cancellation_reason\": \"Cancelled upon completion of an automated test\"\r\n}"
            },
            "url": "{{subscription_url}}/cancel",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        }
      ]
    },
    {
      "_postman_id": "335dc719-64fa-416a-a868-8377d2b3e9cc",
      "name": "Quantity Change Down, Period End",
      "description": "",
      "item": [
        {
          "_postman_id": "87485bbf-fd7b-4fa4-bd39-139b0141b969",
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "2e45bc1a-8ef7-4349-8712-acfbab72f23e",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);",
                  "pm.globals.set(\"item_total\", data.items[0].total);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "812a60fa-cc92-46a0-914d-6599430f5976",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital-sub.test\",\r\n         \"quantity\":2\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }   \r\n}"
            },
            "url": {
              "raw": "https://{{host}}/api/v1/carts?expand=items.subscription_plan,items.subscription_terms",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "carts"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "items.subscription_plan,items.subscription_terms",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "3d3d0742-3a12-4f24-b12e-483df7f0e757",
          "name": "Submit Cart Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.order.items[0];",
                  "tests[\"Subscription was created\"] === item.subcription !== null;",
                  "pm.globals.set(\"subscription_url\", item.subscription);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "{{cart_url}}/payments?expand=order.items",
              "host": [
                "{{cart_url}}"
              ],
              "path": [
                "payments"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order.items",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "84ce2b69-83ea-4111-928b-1b399694fe03",
          "name": "Get the Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.items[0];",
                  "pm.globals.set(\"subscription_item\", item);",
                  "pm.globals.set(\"subscription_item_url\", item.url);",
                  "pm.globals.set(\"date_current_period_end\", data.date_current_period_end);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "{{subscription_url}}",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "2b420157-9507-40b6-b0f4-9eed48978077",
          "name": "Preview",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Subscription term is OK\"] = data.subscription_terms.billing_interval === 1 && data.subscription_terms.billing_interval_unit === \"hour\";",
                  "tests[\"Trial term is OK\"] = data.subscription_terms.trial_interval === null && data.subscription_terms.trial_interval_unit === null;",
                  "tests[\"Payment total is 0\"] = data.payment_total === 0;",
                  "tests[\"Net total is 0\"] = data.net_total === 0;",
                  "tests[\"Date next payment is OK \" + data.date_next_payment] = data.date_next_payment === pm.globals.get(\"date_current_period_end\");",
                  "tests[\"Date effective is OK \" + data.date_effective] = data.date_effective === pm.globals.get(\"date_current_period_end\");",
                  "",
                  "pm.globals.set(\"payment_total\", data.payment_total);",
                  "pm.globals.set(\"refund_total\", data.refund_total);",
                  "pm.globals.set(\"net_total\", data.net_total);",
                  "pm.globals.set(\"date_effective\", data.date_effective);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"apply_immediately\": false,\n\t\"quantity\": 1\n}"
            },
            "url": {
              "raw": "{{subscription_item_url}}/preview?expand=subscription.invoices",
              "host": [
                "{{subscription_item_url}}"
              ],
              "path": [
                "preview"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "subscription.invoices",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "aeee875c-568b-409c-9a4c-dafa9b6b22fe",
          "name": "Change Item Quantity",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "// There should be one subscription and the total should be less than the item total",
                  "tests[\"Change invoice was not created\"] = data.subscription.invoices.total_items === 0;",
                  "tests[\"Change request recorded\"] = data.subscription.items[0].change_at_current_period_end.quantity === 1;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"apply_immediately\": false,\n\t\"quantity\": 1\n}"
            },
            "url": {
              "raw": "{{subscription_item_url}}?expand=subscription.invoices",
              "host": [
                "{{subscription_item_url}}"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "subscription.invoices",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "c6191914-87cc-4c1c-8773-0ba89500fca2",
          "name": "Cancel Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Subscription cancelled successfully\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "tests[\"Subscription cancellation confirmed\"] = data.status === \"cancelled\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"cancellation_reason\": \"Cancelled upon completion of an automated test\"\r\n}"
            },
            "url": "{{subscription_url}}/cancel",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        }
      ]
    },
    {
      "_postman_id": "28202a47-3039-4349-8069-aeefa47ed61e",
      "name": "Add Item, Immediate",
      "description": "",
      "item": [
        {
          "_postman_id": "ec7a2e8a-aa89-4a32-bad4-598128738a44",
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "2e45bc1a-8ef7-4349-8712-acfbab72f23e",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);",
                  "pm.globals.set(\"item_total\", data.items[0].total);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "812a60fa-cc92-46a0-914d-6599430f5976",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital-sub.test\",\r\n         \"quantity\":1\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }   \r\n}"
            },
            "url": {
              "raw": "https://{{host}}/api/v1/carts?expand=items.subscription_plan,items.subscription_terms",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "carts"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "items.subscription_plan,items.subscription_terms",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "ec4d7b3e-32e3-4492-a44e-8f23c66f1f02",
          "name": "Submit Cart Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.order.items[0];",
                  "tests[\"Subscription was created\"] === item.subcription !== null;",
                  "pm.globals.set(\"subscription_url\", item.subscription.url);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "{{cart_url}}/payments?expand=order.items.subscription",
              "host": [
                "{{cart_url}}"
              ],
              "path": [
                "payments"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order.items.subscription",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "ef4dbffa-f563-4020-bd58-f3f9a22a6024",
          "name": "Get the Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.items[0];",
                  "pm.globals.set(\"subscription_item\", item);",
                  "pm.globals.set(\"subscription_item_url\", item.url);",
                  "pm.globals.set(\"date_current_period_end\", data.date_current_period_end);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "{{subscription_url}}",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "1392517c-384d-49a6-8e44-5401a4b80949",
          "name": "Wait 3 seconds",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "a05ebd5c-7c23-42c3-9eb9-63ddde25ee85",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "",
                  "var date = new Date();",
                  "var waitForMinutes = 7;",
                  "",
                  "tests[\"Waiting a few seconds to burn down subscription used time\"] = true;",
                  "",
                  "setTimeout(function() {",
                  "    tests[\"Timer completed. Testing resuming...\"] = true;",
                  "}, 3000);",
                  "",
                  "",
                  ""
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "9751ab2a-b7c5-4e5c-9971-064d19f11c72",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "https://{{host}}/api/v1/subscriptions",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "c7c362ef-8d32-4981-88d9-c05d6133b340",
          "name": "Get the Product",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"product_price\", data.price);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": {
              "raw": "https://{{host}}/api/v1/products/physical-sub.test?currency=USD",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "products",
                "physical-sub.test"
              ],
              "query": [
                {
                  "key": "currency",
                  "value": "USD",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "c82721b8-3b7f-41dd-98a9-14a49eb68986",
          "name": "Update Product Subscription Plan (Physical)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "a7f20a52-80fb-4c20-a8d5-e7c404517d70",
                "exec": [
                  "tests[\"Updated subscription plan\"] = responseCode.code === 200;"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "812a60fa-cc92-46a0-914d-6599430f5976",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n\t\"subscription_plan_id\": \"{{hour_subscription_plan_id}}\"   \r\n}"
            },
            "url": "https://{{host}}/api/v1/products/physical-sub.test",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "4b5b5aa6-c58a-48bf-9cc9-b4e0f67bea71",
          "name": "Preview",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "var now = new Date();",
                  "var dateEffective = new Date(data.date_effective);",
                  "var diff = Math.abs(now - dateEffective);",
                  "",
                  "tests[\"Date effective is OK \" + now + \", \" + data.date_effective + \", \" + diff] = diff < 60000; // Should be \"now\", basically but we'll give a bit of a buffer to handle any time differences between client and server.",
                  "",
                  "tests[\"New quantity is in subcription terms\"] = data.subscription_terms.quantity === 1;",
                  "",
                  "pm.globals.set(\"payment_total\", data.payment_total);",
                  "pm.globals.set(\"refund_total\", data.refund_total);",
                  "pm.globals.set(\"net_total\", data.net_total);",
                  "pm.globals.set(\"date_effective\", data.date_effective);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"apply_immediately\": true,\t\n\t\"product_id\": \"physical-sub.test\"\n}"
            },
            "url": {
              "raw": "{{subscription_url}}/items/preview?expand=subscription.invoices",
              "host": [
                "{{subscription_url}}"
              ],
              "path": [
                "items",
                "preview"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "subscription.invoices",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "72b3f66d-c093-4c4b-824c-6ffbf390cdb2",
          "name": "Add New Item",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "// There should be one invoice and the total should be less than the item total",
                  "tests[\"Change invoice was created\"] = data.subscription.invoices.total_items === 1;",
                  "tests[\"Invoice amount was pro-rated, subtotal: \" + data.subscription.invoices.data[0].subtotal] = data.subscription.invoices.data[0].subtotal < pm.globals.get(\"product_price\");",
                  "tests[\"Subscription has two items\"] = data.subscription.items.length === 2;",
                  "tests[\"Subscription has the added item\"] = _.find(data.subscription.items, function(item) {return item.item_id == 'physical-sub.test'}) !== undefined;",
                  "",
                  "// Compare with the preview amounts",
                  "tests[\"Invoice total equals the preview payment total\"] = data.subscription.invoices.data[0].total == pm.globals.get(\"payment_total\");",
                  "",
                  "// The external payment should be the same as the net total.",
                  "data.subscription.customer.payments.data = data.subscription.customer.payments.data.reverse();",
                  "var payment = _.find(data.subscription.customer.payments.data, function(p) { return p.payment_method.type === \"credit_card\" });",
                  "tests[\"Credit card payment equals net total \" + pm.globals.get(\"net_total\")] = pm.globals.get(\"net_total\") === payment.total;",
                  "",
                  "// The refund should be to customer account balance and be the same as the refund total",
                  "tests[\"No refund has been processed\"] = data.subscription.customer.refunds.data.length === 0;",
                  "",
                  "tests[\"Date next payment is OK \" + pm.globals.get(\"date_current_period_end\")] = data.subscription.date_current_period_end === pm.globals.get(\"date_current_period_end\");"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"date_effective\": \"{{date_effective}}\",\t\t\n\t\"apply_immediately\": true,\t\n\t\"product_id\": \"physical-sub.test\"\n}"
            },
            "url": {
              "raw": "{{subscription_url}}/items?expand=subscription.invoices,subscription.customer.payments.payment_method,subscription.customer.refunds.payment_method",
              "host": [
                "{{subscription_url}}"
              ],
              "path": [
                "items"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "subscription.invoices,subscription.customer.payments.payment_method,subscription.customer.refunds.payment_method",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "7c82ac5d-3ca3-45db-8057-e10a91aec264",
          "name": "Revert Product Subscription Plan (Physical)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "a7f20a52-80fb-4c20-a8d5-e7c404517d70",
                "exec": [
                  "tests[\"Updated subscription plan\"] = responseCode.code === 200;"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "812a60fa-cc92-46a0-914d-6599430f5976",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n\t\"subscription_plan_id\": \"{{two_hour_subscription_with_trial_plan_id}}\"   \r\n}"
            },
            "url": "https://{{host}}/api/v1/products/physical-sub.test",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "0c6840a1-19dd-4404-9dee-05a0c3aed82f",
          "name": "Add Item with Bad product_id",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 404\"] = responseCode.code === 404;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"product_id\": \"xxx\"\n}"
            },
            "url": {
              "raw": "{{subscription_item_url}}xxx?expand=subscription.invoices",
              "host": [
                "{{subscription_item_url}}xxx"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "subscription.invoices",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "e4842d39-9eec-41b3-afb2-24cc6029e7a1",
          "name": "Cancel Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Subscription cancelled successfully\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "tests[\"Subscription cancellation confirmed\"] = data.status === \"cancelled\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"cancellation_reason\": \"Cancelled upon completion of an automated test\"\r\n}"
            },
            "url": "{{subscription_url}}/cancel",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        }
      ]
    },
    {
      "_postman_id": "1447dbde-8fc7-4a1f-8471-ba2c046b6970",
      "name": "Add Item, Period End",
      "description": "",
      "item": [
        {
          "_postman_id": "3fc174a6-ca6f-461a-8197-e5bc29531fc8",
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "2e45bc1a-8ef7-4349-8712-acfbab72f23e",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);",
                  "pm.globals.set(\"item_total\", data.items[0].total);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "812a60fa-cc92-46a0-914d-6599430f5976",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital-sub.test\",\r\n         \"quantity\":1\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }   \r\n}"
            },
            "url": {
              "raw": "https://{{host}}/api/v1/carts?expand=items.subscription_plan,items.subscription_terms",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "carts"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "items.subscription_plan,items.subscription_terms",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "b9559195-f044-4c82-b9a6-275f8fc06bc1",
          "name": "Submit Cart Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.order.items[0];",
                  "tests[\"Subscription was created\"] === item.subcription !== null;",
                  "pm.globals.set(\"subscription_url\", item.subscription.url);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "{{cart_url}}/payments?expand=order.items.subscription",
              "host": [
                "{{cart_url}}"
              ],
              "path": [
                "payments"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order.items.subscription",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "c2e5e45e-0a2c-47b7-a603-84ec803a1b24",
          "name": "Get the Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.items[0];",
                  "pm.globals.set(\"subscription_item\", item);",
                  "pm.globals.set(\"subscription_item_url\", item.url);",
                  "pm.globals.set(\"date_current_period_end\", data.date_current_period_end);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": "{{subscription_url}}",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "f5f64b85-c1d7-4042-bc85-d208c27f8900",
          "name": "Wait 3 seconds",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "a05ebd5c-7c23-42c3-9eb9-63ddde25ee85",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "",
                  "var date = new Date();",
                  "var waitForMinutes = 7;",
                  "",
                  "tests[\"Waiting a few seconds to burn down subscription used time\"] = true;",
                  "",
                  "setTimeout(function() {",
                  "    tests[\"Timer completed. Testing resuming...\"] = true;",
                  "}, 3000);",
                  "",
                  "",
                  ""
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "9751ab2a-b7c5-4e5c-9971-064d19f11c72",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "https://{{host}}/api/v1/subscriptions",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "4653893e-c527-4932-9e61-f8bb1d084910",
          "name": "Get the Product",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"product_price\", data.price);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "https://{{host}}/api/v1/products/physical-sub.test?currency=USD",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "products",
                "physical-sub.test"
              ],
              "query": [
                {
                  "key": "currency",
                  "value": "USD",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "69ef8052-7a0d-44d4-bc92-65e35ee67b94",
          "name": "Update Product Subscription Plan (Physical)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "a7f20a52-80fb-4c20-a8d5-e7c404517d70",
                "exec": [
                  "tests[\"Updated subscription plan\"] = responseCode.code === 200;"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "812a60fa-cc92-46a0-914d-6599430f5976",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n\t\"subscription_plan_id\": \"{{hour_subscription_plan_id}}\"   \r\n}"
            },
            "url": "https://{{host}}/api/v1/products/physical-sub.test",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "baaa0d6a-9925-4d2c-ba21-10eb30723910",
          "name": "Preview",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Subscription term is OK\"] = data.subscription_terms.billing_interval === 1 && data.subscription_terms.billing_interval_unit === \"hour\";",
                  "tests[\"Trial term is OK\"] = data.subscription_terms.trial_interval === null && data.subscription_terms.trial_interval_unit === null;",
                  "tests[\"Payment total is 0\"] = data.payment_total === 0;",
                  "tests[\"Net total is 0\"] = data.net_total === 0;",
                  "tests[\"Date next payment is OK \" + data.date_next_payment] = data.date_next_payment === pm.globals.get(\"date_current_period_end\");",
                  "tests[\"Date effective is OK \" + data.date_effective] = data.date_effective === pm.globals.get(\"date_current_period_end\");",
                  "",
                  "pm.globals.set(\"payment_total\", data.payment_total);",
                  "pm.globals.set(\"refund_total\", data.refund_total);",
                  "pm.globals.set(\"net_total\", data.net_total);",
                  "pm.globals.set(\"date_effective\", data.date_effective);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"apply_immediately\": false,\n\t\"quantity\": 2\n}"
            },
            "url": {
              "raw": "{{subscription_item_url}}/preview?expand=subscription.invoices",
              "host": [
                "{{subscription_item_url}}"
              ],
              "path": [
                "preview"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "subscription.invoices",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "cbdc995c-29f9-49d1-99f6-26af56cf69e9",
          "name": "Add New Item",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "// There should be one invoice and the total should be less than the item total",
                  "tests[\"No invoice was created\"] = data.subscription.invoices.total_items === 0;",
                  "tests[\"Subscription has one item\"] = data.subscription.items.length === 1;",
                  "tests[\"Subscription has new item pending\"] = data.subscription.add_at_current_period_end.length === 1;",
                  "tests[\"Subscription has the correct item pending\"] = _.find(data.subscription.add_at_current_period_end, function(item) {return item.item_id == 'physical-sub.test'}) !== undefined;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"apply_immediately\": false,\n\t\"product_id\": \"physical-sub.test\"\n}"
            },
            "url": {
              "raw": "{{subscription_url}}/items?expand=subscription.invoices",
              "host": [
                "{{subscription_url}}"
              ],
              "path": [
                "items"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "subscription.invoices",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "5b204998-abc2-4d3a-bb43-dde292b904c7",
          "name": "Revert Product Subscription Plan (Physical)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "a7f20a52-80fb-4c20-a8d5-e7c404517d70",
                "exec": [
                  "tests[\"Updated subscription plan\"] = responseCode.code === 200;"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "812a60fa-cc92-46a0-914d-6599430f5976",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n\t\"subscription_plan_id\": \"{{two_hour_subscription_with_trial_plan_id}}\"   \r\n}"
            },
            "url": "https://{{host}}/api/v1/products/physical-sub.test",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "4e73daf8-33ee-46d9-8b37-2a6c41ab1128",
          "name": "Cancel Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Subscription cancelled successfully\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "tests[\"Subscription cancellation confirmed\"] = data.status === \"cancelled\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"cancellation_reason\": \"Cancelled upon completion of an automated test\"\r\n}"
            },
            "url": "{{subscription_url}}/cancel",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        }
      ]
    },
    {
      "_postman_id": "24acd2da-6b1d-4e8d-939f-f4d80668bc0e",
      "name": "Replace Item, Immediate, Same Plan, Upgrade",
      "description": "",
      "item": [
        {
          "_postman_id": "7222f7b9-cec3-4439-be2d-f4fb410a811d",
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "2e45bc1a-8ef7-4349-8712-acfbab72f23e",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);",
                  "pm.globals.set(\"item_total\", data.items[0].total);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "812a60fa-cc92-46a0-914d-6599430f5976",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital-sub.test\",\r\n         \"quantity\":1\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }   \r\n}"
            },
            "url": {
              "raw": "https://{{host}}/api/v1/carts?expand=items.subscription_plan,items.subscription_terms",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "carts"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "items.subscription_plan,items.subscription_terms",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "93e33568-bdd8-4b23-bacc-f541fbe315e7",
          "name": "Submit Cart Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.order.items[0];",
                  "tests[\"Subscription was created\"] === item.subcription !== null;",
                  "pm.globals.set(\"subscription_url\", item.subscription.url);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "{{cart_url}}/payments?expand=order.items.subscription",
              "host": [
                "{{cart_url}}"
              ],
              "path": [
                "payments"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order.items.subscription",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "da9abdd2-4c6a-4098-84f8-aad337a0344b",
          "name": "Get the Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.items[0];",
                  "pm.globals.set(\"subscription_item\", item);",
                  "pm.globals.set(\"subscription_item_url\", item.url);",
                  "pm.globals.set(\"customer_url\", data.customer);",
                  "pm.globals.set(\"date_current_period_end\", data.date_current_period_end);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": "{{subscription_url}}",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "f1ef4534-2e70-4c47-9b37-34dc5d44a7ad",
          "name": "Wait 3 seconds",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "a05ebd5c-7c23-42c3-9eb9-63ddde25ee85",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "",
                  "var date = new Date();",
                  "var waitForMinutes = 7;",
                  "",
                  "tests[\"Waiting a few seconds to burn down subscription used time\"] = true;",
                  "",
                  "setTimeout(function() {",
                  "    tests[\"Timer completed. Testing resuming...\"] = true;",
                  "}, 3000);",
                  "",
                  "",
                  ""
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "9751ab2a-b7c5-4e5c-9971-064d19f11c72",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "https://{{host}}/api/v1/subscriptions",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "7ed8d8e7-1b95-4e4c-af1d-bb38c150efed",
          "name": "Get the Product",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"product_price\", data.price);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "https://{{host}}/api/v1/products/digital-pro-sub.test?currency=USD",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "products",
                "digital-pro-sub.test"
              ],
              "query": [
                {
                  "key": "currency",
                  "value": "USD",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "8a1fd539-8737-4bfc-b0a1-0b8ad0fa8b2b",
          "name": "Run Preview",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Subscription term is OK\"] = data.subscription_terms.billing_interval === 1 && data.subscription_terms.billing_interval_unit === \"hour\";",
                  "tests[\"Trial term is OK\"] = data.subscription_terms.trial_interval === null && data.subscription_terms.trial_interval_unit === null;",
                  "tests[\"Payment total is less than the product price\"] = data.payment_total < 50;",
                  "tests[\"Date next payment is OK \" + pm.globals.get(\"date_current_period_end\")] = data.date_next_payment === pm.globals.get(\"date_current_period_end\");",
                  "",
                  "var now = new Date();",
                  "var dateEffective = new Date(data.date_effective);",
                  "var diff = Math.abs(now - dateEffective);",
                  "",
                  "tests[\"Date effective is OK \" + data.date_effective] = diff < 60000; // Should be \"now\", basically but we'll give a bit of a buffer to handle any time differences between client and server.",
                  "",
                  "pm.globals.set(\"payment_total\", data.payment_total);",
                  "pm.globals.set(\"refund_total\", data.refund_total);",
                  "pm.globals.set(\"net_total\", data.net_total);",
                  "pm.globals.set(\"date_effective\", data.date_effective);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"apply_immediately\": true,\t\n\t\"product_id\": \"digital-pro-sub.test\"\n}"
            },
            "url": {
              "raw": "{{subscription_url}}/items/preview?remove_item_id=digital-sub.test",
              "host": [
                "{{subscription_url}}"
              ],
              "path": [
                "items",
                "preview"
              ],
              "query": [
                {
                  "key": "remove_item_id",
                  "value": "digital-sub.test",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "2ad6ad41-d9c8-478c-826c-d5f998efc1f7",
          "name": "Replace the Item",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "// There should be one invoice and the total should be less than the item total",
                  "tests[\"Change invoice was created\"] = data.subscription.invoices.total_items === 1;",
                  "tests[\"Invoice amount was pro-rated, subtotal: \" + data.subscription.invoices.data[0].subtotal] = data.subscription.invoices.data[0].subtotal < 100;",
                  "tests[\"Subscription has the added item\"] = _.find(data.subscription.items, function(item) {return item.item_id == 'digital-pro-sub.test'}) !== undefined;",
                  "tests[\"Subscription has the cancelled the other item\"] = _.find(data.subscription.items, function(item) {return item.item_id == 'digital-sub.test' && item.cancelled}) !== undefined;",
                  "",
                  "// Compare with the preview amounts",
                  "tests[\"Invoice total equals the preview payment total\"] = data.subscription.invoices.data[0].total == pm.globals.get(\"payment_total\");",
                  "",
                  "// The external payment should be the same as the net total.",
                  "data.subscription.customer.payments.data = data.subscription.customer.payments.data.reverse();",
                  "var payment = _.find(data.subscription.customer.payments.data, function(p) { return p.payment_method.type === \"credit_card\" });",
                  "tests[\"Credit card payment equals net total \" + pm.globals.get(\"net_total\")] = pm.globals.get(\"net_total\") === payment.total;",
                  "",
                  "// The refund should be to customer account balance and be the same as the refund total",
                  "data.subscription.customer.refunds.data = data.subscription.customer.refunds.data.reverse();",
                  "var refund = _.find(data.subscription.customer.refunds.data, function(r) { return r.payment_method.type === \"customer_account_balance\" });",
                  "tests[\"Refund equals refund total and is the correct payment method type \" + pm.globals.get(\"refund_total\")] = pm.globals.get(\"refund_total\") === refund.total;",
                  "",
                  "tests[\"Date next payment is OK \" + pm.globals.get(\"date_current_period_end\")] = data.subscription.date_current_period_end === pm.globals.get(\"date_current_period_end\");"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"date_effective\": \"{{date_effective}}\",\n\t\"apply_immediately\": true,\t\n\t\"product_id\": \"digital-pro-sub.test\"\n}"
            },
            "url": {
              "raw": "{{subscription_url}}/items?remove_item_id=digital-sub.test&expand=subscription.invoices,subscription.customer.payments.payment_method,subscription.customer.refunds.payment_method",
              "host": [
                "{{subscription_url}}"
              ],
              "path": [
                "items"
              ],
              "query": [
                {
                  "key": "remove_item_id",
                  "value": "digital-sub.test",
                  "equals": true
                },
                {
                  "key": "expand",
                  "value": "subscription.invoices,subscription.customer.payments.payment_method,subscription.customer.refunds.payment_method",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "4b92862e-ed2d-4d4a-8898-0f7f6dcb498f",
          "name": "Get the Customer",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "// We should have three payments - two by credit card and one by customer account balance.",
                  "tests[\"Correct number of credit card payments\"] = _.filter(data.payments.data, function(payment) { return payment.payment_method.type == \"credit_card\"}).length === 2;",
                  "tests[\"Correct number of customer account balance payments\"] = _.filter(data.payments.data, function(payment) { return payment.payment_method.type == \"customer_account_balance\"}).length === 1;",
                  "tests[\"All payments are completed\"] = _.filter(data.payments.data, function(payment) { return payment.status == \"completed\"}).length === 3;",
                  "tests[\"Correct number of customer account balance refunds\"] = _.filter(data.refunds.data, function(refund) { return refund.payment_method.type == \"customer_account_balance\"}).length === 1;",
                  "tests[\"Correct number of total refunds\"] = data.refunds.total_items === 1;",
                  "tests[\"Refund total is within range\"] = data.refunds.data[0].total < 20;",
                  "tests[\"Correct number of subscriptions\"] = data.subscriptions.total_items === 1;",
                  "tests[\"Correct number of orders\"] = data.orders.total_items === 2;",
                  "tests[\"Correct number of invoices\"] = data.invoices.total_items === 1;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "{{customer_url}}?expand=refunds.payment_method,payments.payment_method,subscriptions,invoices,orders",
              "host": [
                "{{customer_url}}"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "refunds.payment_method,payments.payment_method,subscriptions,invoices,orders",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "b12081da-34df-4041-a8af-a1799a0f5c21",
          "name": "Cancel Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Subscription cancelled successfully\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "tests[\"Subscription cancellation confirmed\"] = data.status === \"cancelled\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"cancellation_reason\": \"Cancelled upon completion of an automated test\"\r\n}"
            },
            "url": "{{subscription_url}}/cancel",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        }
      ]
    },
    {
      "_postman_id": "65f7c45b-b100-4b52-8570-7281e574dbe1",
      "name": "Replace Item, Period End, Same Plan, Upgrade",
      "description": "",
      "item": [
        {
          "_postman_id": "83b2c8ea-d696-4eac-b2a2-7f1b88aa9795",
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "2e45bc1a-8ef7-4349-8712-acfbab72f23e",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);",
                  "pm.globals.set(\"item_total\", data.items[0].total);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "812a60fa-cc92-46a0-914d-6599430f5976",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital-sub.test\",\r\n         \"quantity\":1\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }   \r\n}"
            },
            "url": {
              "raw": "https://{{host}}/api/v1/carts?expand=items.subscription_plan,items.subscription_terms",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "carts"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "items.subscription_plan,items.subscription_terms",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "5434ed09-03c5-4046-8873-9438f691c491",
          "name": "Submit Cart Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.order.items[0];",
                  "tests[\"Subscription was created\"] === item.subcription !== null;",
                  "pm.globals.set(\"subscription_url\", item.subscription.url);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "{{cart_url}}/payments?expand=order.items.subscription",
              "host": [
                "{{cart_url}}"
              ],
              "path": [
                "payments"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order.items.subscription",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "a7545592-e2e7-478a-89c0-f683c65d01db",
          "name": "Get the Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.items[0];",
                  "pm.globals.set(\"subscription_item\", item);",
                  "pm.globals.set(\"subscription_item_url\", item.url);",
                  "pm.globals.set(\"customer_url\", data.customer);",
                  "pm.globals.set(\"date_current_period_end\", data.date_current_period_end);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": "{{subscription_url}}",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "57084893-863a-45b3-8656-10b9f3dfca9b",
          "name": "Wait 3 seconds",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "a05ebd5c-7c23-42c3-9eb9-63ddde25ee85",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "",
                  "var date = new Date();",
                  "var waitForMinutes = 7;",
                  "",
                  "tests[\"Waiting a few seconds to burn down subscription used time\"] = true;",
                  "",
                  "setTimeout(function() {",
                  "    tests[\"Timer completed. Testing resuming...\"] = true;",
                  "}, 3000);",
                  "",
                  "",
                  ""
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "9751ab2a-b7c5-4e5c-9971-064d19f11c72",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "https://{{host}}/api/v1/subscriptions",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "93091a5e-7b7f-4d99-a80f-0cf8ef13438f",
          "name": "Get the Product",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"product_price\", data.price);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "https://{{host}}/api/v1/products/digital-pro-sub.test?currency=USD",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "products",
                "digital-pro-sub.test"
              ],
              "query": [
                {
                  "key": "currency",
                  "value": "USD",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "7af465e5-d067-4569-8f1e-4fce4886d892",
          "name": "Run Preview",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Subscription term is OK\"] = data.subscription_terms.billing_interval === 1 && data.subscription_terms.billing_interval_unit === \"hour\";",
                  "tests[\"Trial term is OK\"] = data.subscription_terms.trial_interval === null && data.subscription_terms.trial_interval_unit === null;",
                  "tests[\"Payment total is 0\"] = data.payment_total === 0;",
                  "tests[\"Date next payment is OK \" + data.date_next_payment] = data.date_next_payment === pm.globals.get(\"date_current_period_end\");",
                  "tests[\"Date effective is OK \" + data.date_effective] = data.date_effective === pm.globals.get(\"date_current_period_end\");",
                  "",
                  "pm.globals.set(\"payment_total\", data.payment_total);",
                  "pm.globals.set(\"refund_total\", data.refund_total);",
                  "pm.globals.set(\"net_total\", data.net_total);",
                  "pm.globals.set(\"date_effective\", data.date_effective);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"apply_immediately\": false,\t\n\t\"product_id\": \"digital-pro-sub.test\"\n}"
            },
            "url": {
              "raw": "{{subscription_url}}/items/preview?remove_item_id=digital-sub.test",
              "host": [
                "{{subscription_url}}"
              ],
              "path": [
                "items",
                "preview"
              ],
              "query": [
                {
                  "key": "remove_item_id",
                  "value": "digital-sub.test",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "967d3b29-4be1-4334-b852-d87d52b10072",
          "name": "Replace the Item",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "// There should be one invoice and the total should be less than the item total",
                  "tests[\"No invoice was created\"] = data.subscription.invoices.total_items === 0;",
                  "tests[\"Subscription has the correct item pending\"] = data.subscription.items[0].change_at_current_period_end.item_id === \"digital-pro-sub.test\";",
                  "tests[\"Pending item has the correct reference price\"] = data.subscription.items[0].change_at_current_period_end.reference_price === 50;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"apply_immediately\": false,\n\t\"product_id\": \"digital-pro-sub.test\"\n}"
            },
            "url": {
              "raw": "{{subscription_url}}/items?remove_item_id=digital-sub.test&expand=subscription.invoices",
              "host": [
                "{{subscription_url}}"
              ],
              "path": [
                "items"
              ],
              "query": [
                {
                  "key": "remove_item_id",
                  "value": "digital-sub.test",
                  "equals": true
                },
                {
                  "key": "expand",
                  "value": "subscription.invoices",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "c31b2a3c-1f98-49ff-8c5b-6610b37a5a77",
          "name": "Get the Customer",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "// We should have three payments - two by credit card and one by customer account balance.",
                  "tests[\"Correct number of total payments\"] = data.payments.total_items === 1;",
                  "tests[\"All payments are completed\"] = _.filter(data.payments.data, function(payment) { return payment.status == \"completed\"}).length === 1;",
                  "tests[\"Correct number of total refunds\"] = data.refunds.total_items === 0;",
                  "tests[\"Correct number of subscriptions\"] = data.subscriptions.total_items === 1;",
                  "tests[\"Correct number of orders\"] = data.orders.total_items === 1;",
                  "tests[\"Correct number of invoices\"] = data.invoices.total_items === 0;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "{{customer_url}}?expand=refunds.payment_method,payments.payment_method,subscriptions,invoices,orders",
              "host": [
                "{{customer_url}}"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "refunds.payment_method,payments.payment_method,subscriptions,invoices,orders",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "e87b7c72-2a72-43d3-bf07-f057bc6b530e",
          "name": "Cancel Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Subscription cancelled successfully\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "tests[\"Subscription cancellation confirmed\"] = data.status === \"cancelled\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"cancellation_reason\": \"Cancelled upon completion of an automated test\"\r\n}"
            },
            "url": "{{subscription_url}}/cancel",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        }
      ]
    },
    {
      "_postman_id": "6785ffd8-623a-4db6-941d-562ad4e49775",
      "name": "Replace Item, Immediate, Same Plan, Downgrade",
      "description": "",
      "item": [
        {
          "_postman_id": "e482d487-6d51-48f9-8771-ac39b9c20554",
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "2e45bc1a-8ef7-4349-8712-acfbab72f23e",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);",
                  "pm.globals.set(\"item_total\", data.items[0].total);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "812a60fa-cc92-46a0-914d-6599430f5976",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital-pro-sub.test\",\r\n         \"quantity\":1\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }   \r\n}"
            },
            "url": {
              "raw": "https://{{host}}/api/v1/carts?expand=items.subscription_plan,items.subscription_terms",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "carts"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "items.subscription_plan,items.subscription_terms",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "b75d730a-7d2b-49bf-aa48-c7e6af12943c",
          "name": "Submit Cart Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.order.items[0];",
                  "tests[\"Subscription was created\"] === item.subcription !== null;",
                  "pm.globals.set(\"subscription_url\", item.subscription.url);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "{{cart_url}}/payments?expand=order.items.subscription",
              "host": [
                "{{cart_url}}"
              ],
              "path": [
                "payments"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order.items.subscription",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "544b5637-92f5-4abb-83d1-a4162ef0780e",
          "name": "Get the Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.items[0];",
                  "pm.globals.set(\"subscription_item\", item);",
                  "pm.globals.set(\"subscription_item_url\", item.url);",
                  "pm.globals.set(\"customer_url\", data.customer);",
                  "pm.globals.set(\"date_current_period_end\", data.date_current_period_end);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": "{{subscription_url}}",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "78d96430-dedd-480e-ba0b-0fd55dcea30a",
          "name": "Wait 3 seconds",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "a05ebd5c-7c23-42c3-9eb9-63ddde25ee85",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "",
                  "var date = new Date();",
                  "var waitForMinutes = 7;",
                  "",
                  "tests[\"Waiting a few seconds to burn down subscription used time\"] = true;",
                  "",
                  "setTimeout(function() {",
                  "    tests[\"Timer completed. Testing resuming...\"] = true;",
                  "}, 3000);",
                  "",
                  "",
                  ""
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "9751ab2a-b7c5-4e5c-9971-064d19f11c72",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "https://{{host}}/api/v1/subscriptions",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "7beb77a4-6917-462e-b7cb-c4c04e10f6ce",
          "name": "Get the Product",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"product_price\", data.price);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "https://{{host}}/api/v1/products/digital-sub.test?currency=USD",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "products",
                "digital-sub.test"
              ],
              "query": [
                {
                  "key": "currency",
                  "value": "USD",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "271cfb07-5631-405d-b82e-1a860eee0fe9",
          "name": "Run Preview",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Subscription term is OK\"] = data.subscription_terms.billing_interval === 1 && data.subscription_terms.billing_interval_unit === \"hour\";",
                  "tests[\"Trial term is OK\"] = data.subscription_terms.trial_interval === null && data.subscription_terms.trial_interval_unit === null;",
                  "tests[\"Net total is negative\"] = data.net_total < 0;",
                  "tests[\"Payment total is less than the product price\"] = data.payment_total < 20 && data.payment_total > 18;",
                  "tests[\"Refund total is less than the product price\"] = data.refund_total < 50 && data.refund_total > 45;",
                  "tests[\"Date next payment is OK \" + pm.globals.get(\"date_current_period_end\")] = data.date_next_payment === pm.globals.get(\"date_current_period_end\");",
                  "",
                  "var now = new Date();",
                  "var dateEffective = new Date(data.date_effective);",
                  "var diff = Math.abs(now - dateEffective);",
                  "",
                  "tests[\"Date effective is OK \" + data.date_effective] = diff < 60000; // Should be \"now\", basically but we'll give a bit of a buffer to handle any time differences between client and server.",
                  "",
                  "pm.globals.set(\"payment_total\", data.payment_total);",
                  "pm.globals.set(\"refund_total\", data.refund_total);",
                  "pm.globals.set(\"net_total\", data.net_total);",
                  "pm.globals.set(\"date_effective\", data.date_effective);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"apply_immediately\": true,\t\n\t\"product_id\": \"digital-sub.test\"\n}"
            },
            "url": {
              "raw": "{{subscription_url}}/items/preview?remove_item_id=digital-pro-sub.test",
              "host": [
                "{{subscription_url}}"
              ],
              "path": [
                "items",
                "preview"
              ],
              "query": [
                {
                  "key": "remove_item_id",
                  "value": "digital-pro-sub.test",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "1e7419c7-a2ef-4b65-995f-4e366afdb947",
          "name": "Replace the Item",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "// There should be one invoice and the total should be less than the item total",
                  "tests[\"Change invoice was created\"] = data.subscription.invoices.total_items === 1;",
                  "tests[\"Invoice amount was pro-rated, subtotal: \" + data.subscription.invoices.data[0].subtotal] = data.subscription.invoices.data[0].subtotal < 20;",
                  "tests[\"Subscription has the added item\"] = _.find(data.subscription.items, function(item) {return item.item_id == 'digital-sub.test'}) !== undefined;",
                  "tests[\"Subscription has the cancelled the other item\"] = _.find(data.subscription.items, function(item) {return item.item_id == 'digital-pro-sub.test' && item.cancelled}) !== undefined;",
                  "",
                  "// Compare with the preview amounts",
                  "tests[\"Invoice total equals the preview payment total\"] = data.subscription.invoices.data[0].total == pm.globals.get(\"payment_total\");",
                  "",
                  "// The external payment should be the same as the net total.",
                  "data.subscription.customer.refunds.data = data.subscription.customer.refunds.data.reverse();",
                  "var refund = _.find(data.subscription.customer.refunds.data, function(r) { return r.payment_method.type === \"credit_card\" });",
                  "tests[\"Credit card refund equals net total \" + pm.globals.get(\"net_total\")] = pm.globals.get(\"net_total\") === refund.total * -1;",
                  "",
                  "// The payment should be fromt customer account balance and be the same as the payment total",
                  "data.subscription.customer.payments.data = data.subscription.customer.payments.data.reverse();",
                  "var payment = _.find(data.subscription.customer.payments.data, function(r) { return r.payment_method.type === \"customer_account_balance\" });",
                  "tests[\"Payment equals payment total and is the correct payment method type \" + pm.globals.get(\"payment_total\")] = pm.globals.get(\"payment_total\") === payment.total;",
                  "",
                  "tests[\"Date next payment is OK \" + pm.globals.get(\"date_current_period_end\")] = data.subscription.date_current_period_end === pm.globals.get(\"date_current_period_end\");"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"date_effective\": \"{{date_effective}}\",\n\t\"apply_immediately\": true,\t\n\t\"product_id\": \"digital-sub.test\"\n}"
            },
            "url": {
              "raw": "{{subscription_url}}/items?remove_item_id=digital-pro-sub.test&expand=subscription.invoices,subscription.customer.payments.payment_method,subscription.customer.refunds.payment_method",
              "host": [
                "{{subscription_url}}"
              ],
              "path": [
                "items"
              ],
              "query": [
                {
                  "key": "remove_item_id",
                  "value": "digital-pro-sub.test",
                  "equals": true
                },
                {
                  "key": "expand",
                  "value": "subscription.invoices,subscription.customer.payments.payment_method,subscription.customer.refunds.payment_method",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "99dab75e-df97-438a-bb69-e99c38f9b397",
          "name": "Get the Customer",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "// We should have three payments - two by credit card and one by customer account balance.",
                  "tests[\"Correct number of credit card payments\"] = _.filter(data.payments.data, function(payment) { return payment.payment_method.type == \"credit_card\"}).length === 1;",
                  "tests[\"Correct number of customer account balance payments\"] = _.filter(data.payments.data, function(payment) { return payment.payment_method.type == \"customer_account_balance\"}).length === 1;",
                  "tests[\"All payments are completed\"] = _.filter(data.payments.data, function(payment) { return payment.status == \"completed\"}).length === 2;",
                  "tests[\"Correct number of customer account balance refunds\"] = _.filter(data.refunds.data, function(refund) { return refund.payment_method.type == \"customer_account_balance\"}).length === 1;",
                  "tests[\"Correct number of total refunds\"] = data.refunds.total_items === 2;",
                  "tests[\"Refund total is within range\"] = data.refunds.data[0].total < 30;",
                  "tests[\"Correct number of subscriptions\"] = data.subscriptions.total_items === 1;",
                  "tests[\"Correct number of orders\"] = data.orders.total_items === 2;",
                  "tests[\"Correct number of invoices\"] = data.invoices.total_items === 1;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "{{customer_url}}?expand=refunds.payment_method,payments.payment_method,subscriptions,invoices,orders",
              "host": [
                "{{customer_url}}"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "refunds.payment_method,payments.payment_method,subscriptions,invoices,orders",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "36f48a26-0dc3-4bce-900d-92462252db1f",
          "name": "Cancel Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Subscription cancelled successfully\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "tests[\"Subscription cancellation confirmed\"] = data.status === \"cancelled\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"cancellation_reason\": \"Cancelled upon completion of an automated test\"\r\n}"
            },
            "url": "{{subscription_url}}/cancel",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        }
      ]
    },
    {
      "_postman_id": "5e7326af-2c74-46ed-b714-16e11c7c6e82",
      "name": "Replace Item, Period End, Same Plan, Downgrade",
      "description": "",
      "item": [
        {
          "_postman_id": "8cc9c5ef-183d-45cb-b5d3-77d2acdc44d0",
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "2e45bc1a-8ef7-4349-8712-acfbab72f23e",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);",
                  "pm.globals.set(\"item_total\", data.items[0].total);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "812a60fa-cc92-46a0-914d-6599430f5976",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital-pro-sub.test\",\r\n         \"quantity\":1\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }   \r\n}"
            },
            "url": {
              "raw": "https://{{host}}/api/v1/carts?expand=items.subscription_plan,items.subscription_terms",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "carts"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "items.subscription_plan,items.subscription_terms",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "6a0af3f6-ab14-4a0b-b127-93e5ae8901e6",
          "name": "Submit Cart Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.order.items[0];",
                  "tests[\"Subscription was created\"] === item.subcription !== null;",
                  "pm.globals.set(\"subscription_url\", item.subscription.url);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "{{cart_url}}/payments?expand=order.items.subscription",
              "host": [
                "{{cart_url}}"
              ],
              "path": [
                "payments"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order.items.subscription",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "5b6e18bb-f0db-48c4-bc86-aef9efaa1942",
          "name": "Get the Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.items[0];",
                  "pm.globals.set(\"subscription_item\", item);",
                  "pm.globals.set(\"subscription_item_url\", item.url);",
                  "pm.globals.set(\"customer_url\", data.customer);",
                  "pm.globals.set(\"date_current_period_end\", data.date_current_period_end);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": "{{subscription_url}}",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "2b3c510a-2e39-48cd-b2af-922a0293a92d",
          "name": "Wait 3 seconds",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "a05ebd5c-7c23-42c3-9eb9-63ddde25ee85",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "",
                  "var date = new Date();",
                  "var waitForMinutes = 7;",
                  "",
                  "tests[\"Waiting a few seconds to burn down subscription used time\"] = true;",
                  "",
                  "setTimeout(function() {",
                  "    tests[\"Timer completed. Testing resuming...\"] = true;",
                  "}, 3000);",
                  "",
                  "",
                  ""
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "9751ab2a-b7c5-4e5c-9971-064d19f11c72",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "https://{{host}}/api/v1/subscriptions",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "ca2aee69-cdca-45f6-8552-a930be9f3ce5",
          "name": "Get the Product",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"product_price\", data.price);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "https://{{host}}/api/v1/products/digital-sub.test?currency=USD",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "products",
                "digital-sub.test"
              ],
              "query": [
                {
                  "key": "currency",
                  "value": "USD",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "6de3d632-b336-4b44-b9a3-1556eb647a8a",
          "name": "Run Preview",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Subscription term is OK\"] = data.subscription_terms.billing_interval === 1 && data.subscription_terms.billing_interval_unit === \"hour\";",
                  "tests[\"Trial term is OK\"] = data.subscription_terms.trial_interval === null && data.subscription_terms.trial_interval_unit === null;",
                  "tests[\"Payment total is 0\"] = data.payment_total === 0;",
                  "tests[\"Date next payment is OK \" + data.date_next_payment + \" \" + pm.globals.get(\"date_current_period_end\")] = data.date_next_payment === pm.globals.get(\"date_current_period_end\");",
                  "tests[\"Date effective is OK \" + data.date_effective + \" \" + pm.globals.get(\"date_current_period_end\")] = data.date_effective === pm.globals.get(\"date_current_period_end\");",
                  "",
                  "pm.globals.set(\"payment_total\", data.payment_total);",
                  "pm.globals.set(\"refund_total\", data.refund_total);",
                  "pm.globals.set(\"net_total\", data.net_total);",
                  "pm.globals.set(\"date_effective\", data.date_effective);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"apply_immediately\": false,\t\n\t\"product_id\": \"digital-sub.test\"\n}"
            },
            "url": {
              "raw": "{{subscription_url}}/items/preview?remove_product_id=digital-pro-sub.test",
              "host": [
                "{{subscription_url}}"
              ],
              "path": [
                "items",
                "preview"
              ],
              "query": [
                {
                  "key": "remove_product_id",
                  "value": "digital-pro-sub.test",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "db694461-b07a-4980-ab8c-353bc4742517",
          "name": "Replace the Item",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "// There should be one invoice and the total should be less than the item total",
                  "tests[\"No invoice was created\"] = data.subscription.invoices.total_items === 0;",
                  "tests[\"Subscription has the correct item pending\"] = data.subscription.items[0].change_at_current_period_end.item_id === \"digital-sub.test\";",
                  "tests[\"Pending item has the correct reference price\"] = data.subscription.items[0].change_at_current_period_end.reference_price === 20;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"apply_immediately\": false,\n\t\"product_id\": \"digital-sub.test\"\n}"
            },
            "url": {
              "raw": "{{subscription_url}}/items?remove_item_id=digital-pro-sub.test&expand=subscription.invoices",
              "host": [
                "{{subscription_url}}"
              ],
              "path": [
                "items"
              ],
              "query": [
                {
                  "key": "remove_item_id",
                  "value": "digital-pro-sub.test",
                  "equals": true
                },
                {
                  "key": "expand",
                  "value": "subscription.invoices",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "54d84c8d-4c56-4ffa-94a5-d03f85af914a",
          "name": "Get the Customer",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "// We should have three payments - two by credit card and one by customer account balance.",
                  "tests[\"Correct number of total payments\"] = data.payments.total_items === 1;",
                  "tests[\"All payments are completed\"] = _.filter(data.payments.data, function(payment) { return payment.status == \"completed\"}).length === 1;",
                  "tests[\"Correct number of total refunds\"] = data.refunds.total_items === 0;",
                  "tests[\"Correct number of subscriptions\"] = data.subscriptions.total_items === 1;",
                  "tests[\"Correct number of orders\"] = data.orders.total_items === 1;",
                  "tests[\"Correct number of invoices\"] = data.invoices.total_items === 0;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "{{customer_url}}?expand=refunds.payment_method,payments.payment_method,subscriptions,invoices,orders",
              "host": [
                "{{customer_url}}"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "refunds.payment_method,payments.payment_method,subscriptions,invoices,orders",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "3d1c2432-c824-41e3-9e55-9fa3dc23864f",
          "name": "Cancel Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Subscription cancelled successfully\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "tests[\"Subscription cancellation confirmed\"] = data.status === \"cancelled\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"cancellation_reason\": \"Cancelled upon completion of an automated test\"\r\n}"
            },
            "url": "{{subscription_url}}/cancel",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        }
      ]
    },
    {
      "_postman_id": "43e2a560-a967-4f08-9ed1-678828c15e3e",
      "name": "Replace Item, Immediate, Different Plan, Upgrade",
      "description": "",
      "item": [
        {
          "_postman_id": "ecccf38c-d2e1-4104-a6cd-6103e4723f98",
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "2e45bc1a-8ef7-4349-8712-acfbab72f23e",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);",
                  "pm.globals.set(\"item_total\", data.items[0].total);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "812a60fa-cc92-46a0-914d-6599430f5976",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital-sub.test\",\r\n         \"quantity\":1\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }   \r\n}"
            },
            "url": {
              "raw": "https://{{host}}/api/v1/carts?expand=items.subscription_plan,items.subscription_terms",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "carts"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "items.subscription_plan,items.subscription_terms",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "7f8090e6-993f-46a0-8bcd-aa2b2b45f24b",
          "name": "Submit Cart Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.order.items[0];",
                  "tests[\"Subscription was created\"] === item.subcription !== null;",
                  "pm.globals.set(\"subscription_url\", item.subscription.url);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "{{cart_url}}/payments?expand=order.items.subscription",
              "host": [
                "{{cart_url}}"
              ],
              "path": [
                "payments"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order.items.subscription",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "aa79b562-e2c8-4e2c-a636-6e5b09cec399",
          "name": "Get the Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.items[0];",
                  "pm.globals.set(\"subscription_item\", item);",
                  "pm.globals.set(\"subscription_item_url\", item.url);",
                  "pm.globals.set(\"customer_url\", data.customer);",
                  "pm.globals.set(\"date_current_period_end\", data.date_current_period_end);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": "{{subscription_url}}",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "33c8348a-13d3-47f4-818c-ff6d98387187",
          "name": "Wait 3 seconds",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "a05ebd5c-7c23-42c3-9eb9-63ddde25ee85",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "",
                  "var date = new Date();",
                  "var waitForMinutes = 7;",
                  "",
                  "tests[\"Waiting a few seconds to burn down subscription used time\"] = true;",
                  "",
                  "setTimeout(function() {",
                  "    tests[\"Timer completed. Testing resuming...\"] = true;",
                  "}, 3000);",
                  "",
                  "",
                  ""
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "9751ab2a-b7c5-4e5c-9971-064d19f11c72",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "https://{{host}}/api/v1/subscriptions",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "7ced7913-599b-48b5-9e8c-8607f04f6d27",
          "name": "Get the Product",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"product_price\", data.price);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "https://{{host}}/api/v1/products/digital-term-sub.test?currency=USD&expand=subscription_plan",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "products",
                "digital-term-sub.test"
              ],
              "query": [
                {
                  "key": "currency",
                  "value": "USD",
                  "equals": true
                },
                {
                  "key": "expand",
                  "value": "subscription_plan",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "c095d95f-f1ba-4e66-bbdf-660f37565f69",
          "name": "Run Preview",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Subscription term is OK\"] = data.subscription_terms.billing_interval === 2 && data.subscription_terms.billing_interval_unit === \"hour\";",
                  "tests[\"Trial term is OK\"] = data.subscription_terms.trial_interval === null && data.subscription_terms.trial_interval_unit === null;",
                  "tests[\"Payment total equals the product price\"] = data.payment_total === 35;",
                  "",
                  "var dateEffective = new Date(data.date_effective);",
                  "var diff = Math.abs(now - dateEffective);",
                  "",
                  "var now = new Date();",
                  "var dateNextPayment = new Date(data.date_next_payment);",
                  "var dateEffective = new Date(data.date_effective);",
                  "var nextPaymentdiff = Math.abs(dateNextPayment - dateEffective);",
                  "var effectiveDiff = Math.abs(now - dateEffective);",
                  "",
                  "tests[\"Date next payment is OK \" + data.date_next_payment] = nextPaymentdiff === 7200000;",
                  "tests[\"Date effective is OK \" + data.date_effective] = effectiveDiff < 60000; // Should be \"now\", basically but we'll give a bit of a buffer to handle any time differences between client and server.",
                  "",
                  "pm.globals.set(\"payment_total\", data.payment_total);",
                  "pm.globals.set(\"refund_total\", data.refund_total);",
                  "pm.globals.set(\"net_total\", data.net_total);",
                  "pm.globals.set(\"date_effective\", data.date_effective);",
                  "pm.globals.set(\"date_next_payment\", data.date_next_payment);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"apply_immediately\": true,\t\n\t\"product_id\": \"digital-term-sub.test\"\n}"
            },
            "url": {
              "raw": "{{subscription_url}}/items/preview?remove_item_id=digital-sub.test",
              "host": [
                "{{subscription_url}}"
              ],
              "path": [
                "items",
                "preview"
              ],
              "query": [
                {
                  "key": "remove_item_id",
                  "value": "digital-sub.test",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "764d2a4d-fd0e-42ee-82b1-f1614b7efb4a",
          "name": "Replace the Item",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "// There should be one invoice and the total should be less than the item total",
                  "tests[\"No change invoice was created\"] = data.subscription.invoices.total_items === 0;",
                  "tests[\"Subscription has the cancelled the other item\"] = _.find(data.subscription.items, function(item) {return item.item_id == 'digital-sub.test' && item.cancelled}) !== undefined;",
                  "tests[\"Original subscription is cancelled\"] = data.subscription.status === \"cancelled\";",
                  "",
                  "// Compare with the preview amounts",
                  "tests[\"Invoice total equals the preview payment total\"] = data.subscription.customer.invoices.data[0].total == pm.globals.get(\"payment_total\");",
                  "",
                  "// The external payment should be the same as the net total.",
                  "data.subscription.customer.payments.data = data.subscription.customer.payments.data.reverse();",
                  "var payment = _.find(data.subscription.customer.payments.data, function(p) { return p.payment_method.type === \"credit_card\" });",
                  "tests[\"Credit card payment equals net total \" + pm.globals.get(\"net_total\")] = pm.globals.get(\"net_total\") === payment.total;",
                  "",
                  "// The refund should be to customer account balance and be the same as the refund total",
                  "data.subscription.customer.refunds.data = data.subscription.customer.refunds.data.reverse();",
                  "var refund = _.find(data.subscription.customer.refunds.data, function(r) { return r.payment_method.type === \"customer_account_balance\" });",
                  "tests[\"Refund equals refund total and is the correct payment method type \" + pm.globals.get(\"refund_total\")] = pm.globals.get(\"refund_total\") === refund.total;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"date_effective\": \"{{date_effective}}\",\n\t\"apply_immediately\": true,\t\n\t\"product_id\": \"digital-term-sub.test\"\n}"
            },
            "url": {
              "raw": "{{subscription_url}}/items?remove_item_id=digital-sub.test&expand=subscription.invoices,subscription.customer.payments.payment_method,subscription.customer.invoices,subscription.customer.refunds.payment_method",
              "host": [
                "{{subscription_url}}"
              ],
              "path": [
                "items"
              ],
              "query": [
                {
                  "key": "remove_item_id",
                  "value": "digital-sub.test",
                  "equals": true
                },
                {
                  "key": "expand",
                  "value": "subscription.invoices,subscription.customer.payments.payment_method,subscription.customer.invoices,subscription.customer.refunds.payment_method",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "4eac5373-1b0e-4fbb-ad6b-1e9d8f5426de",
          "name": "Get the Customer",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Correct number of orders have been placed\"] = data.orders.total_items === 2;",
                  "tests[\"Order 1 has the correct total\"] = data.orders.data[0].total === 20;",
                  "tests[\"Order 2 has the correct total\"] = data.orders.data[1].total === 35;",
                  "tests[\"Refund has been recorded for the correct amount\"] = data.refunds.total_items == 1 && data.refunds.data[0].total < 20;",
                  "tests[\"Correct number of subscriptions and cancellations\"] = data.subscriptions.total_items === 2 && data.subscriptions.data[0].status === \"cancelled\" && data.subscriptions.data[1].status === \"active\";",
                  "tests[\"Correct number of credit card payments\"] = _.filter(data.payments.data, function(payment) { return payment.payment_method.type == \"credit_card\"}).length === 2;",
                  "tests[\"Correct number of customer account balance payments\"] = _.filter(data.payments.data, function(payment) { return payment.payment_method.type == \"customer_account_balance\"}).length === 1;",
                  "tests[\"All payments are completed\"] = _.filter(data.payments.data, function(payment) { return payment.status == \"completed\"}).length === 3;",
                  "tests[\"Correct number of customer account balance refunds\"] = _.filter(data.refunds.data, function(refund) { return refund.payment_method.type == \"customer_account_balance\"}).length === 1;",
                  "tests[\"Correct number of total refunds\"] = data.refunds.total_items === 1;",
                  "tests[\"Refund total is within range\"] = data.refunds.data[0].total < 20;",
                  "tests[\"Payments 2 and 3 equal order 2 total\"] = data.payments.data[1].total + data.payments.data[2].total === data.orders.data[1].total;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "{{customer_url}}?expand=refunds.payment_method,payments.payment_method,subscriptions,invoices,orders",
              "host": [
                "{{customer_url}}"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "refunds.payment_method,payments.payment_method,subscriptions,invoices,orders",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "b9be32a1-4e2a-436e-8d57-fd51962efeb2",
          "name": "Cancel Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Subscription cancelled successfully\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "tests[\"Subscription cancellation confirmed\"] = data.status === \"cancelled\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"cancellation_reason\": \"Cancelled upon completion of an automated test\"\r\n}"
            },
            "url": "{{subscription_url}}/cancel",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        }
      ]
    },
    {
      "_postman_id": "5cf6a4c4-c456-4d14-bf80-b321c55623ba",
      "name": "Replace Item, Period End, Different Plan, Upgrade",
      "description": "",
      "item": [
        {
          "_postman_id": "0f989431-a7e7-4d7e-84f2-828e5b5daf14",
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "2e45bc1a-8ef7-4349-8712-acfbab72f23e",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);",
                  "pm.globals.set(\"item_total\", data.items[0].total);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "812a60fa-cc92-46a0-914d-6599430f5976",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital-sub.test\",\r\n         \"quantity\":1\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }   \r\n}"
            },
            "url": {
              "raw": "https://{{host}}/api/v1/carts?expand=items.subscription_plan,items.subscription_terms",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "carts"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "items.subscription_plan,items.subscription_terms",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "a8ba4e0b-febd-456c-b13f-82dfcaa99192",
          "name": "Submit Cart Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.order.items[0];",
                  "tests[\"Subscription was created\"] === item.subcription !== null;",
                  "pm.globals.set(\"subscription_url\", item.subscription.url);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "{{cart_url}}/payments?expand=order.items.subscription",
              "host": [
                "{{cart_url}}"
              ],
              "path": [
                "payments"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order.items.subscription",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "bfbb9fb0-a4fc-4c47-b037-3591d9f4f0ae",
          "name": "Get the Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.items[0];",
                  "pm.globals.set(\"subscription_item\", item);",
                  "pm.globals.set(\"subscription_item_url\", item.url);",
                  "pm.globals.set(\"customer_url\", data.customer);",
                  "pm.globals.set(\"date_current_period_end\", data.date_current_period_end);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": "{{subscription_url}}",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "a85d44e7-56e4-4bc0-837a-4a2be1742e8f",
          "name": "Wait 3 seconds",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "a05ebd5c-7c23-42c3-9eb9-63ddde25ee85",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "",
                  "var date = new Date();",
                  "var waitForMinutes = 7;",
                  "",
                  "tests[\"Waiting a few seconds to burn down subscription used time\"] = true;",
                  "",
                  "setTimeout(function() {",
                  "    tests[\"Timer completed. Testing resuming...\"] = true;",
                  "}, 3000);",
                  "",
                  "",
                  ""
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "9751ab2a-b7c5-4e5c-9971-064d19f11c72",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "https://{{host}}/api/v1/subscriptions",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "8a50bd8f-c60a-4933-80a5-792769e47452",
          "name": "Get the Product",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"product_price\", data.price);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "https://{{host}}/api/v1/products/digital-term-sub.test?currency=USD",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "products",
                "digital-term-sub.test"
              ],
              "query": [
                {
                  "key": "currency",
                  "value": "USD",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "d0604277-001e-4356-b80d-f771cea1eba6",
          "name": "Run Preview",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Subscription term is OK\"] = data.subscription_terms.billing_interval === 1 && data.subscription_terms.billing_interval_unit === \"hour\";",
                  "tests[\"Trial term is OK\"] = data.subscription_terms.trial_interval === null && data.subscription_terms.trial_interval_unit === null;",
                  "tests[\"Payment total is 0\"] = data.payment_total === 0;",
                  "tests[\"Date next payment is OK \" + data.date_next_payment + \" \" + pm.globals.get(\"date_current_period_end\")] = data.date_next_payment === pm.globals.get(\"date_current_period_end\");",
                  "tests[\"Date effective is OK \" + data.date_effective + \" \" + pm.globals.get(\"date_current_period_end\")] = data.date_effective === pm.globals.get(\"date_current_period_end\");",
                  "",
                  "pm.globals.set(\"payment_total\", data.payment_total);",
                  "pm.globals.set(\"refund_total\", data.refund_total);",
                  "pm.globals.set(\"net_total\", data.net_total);",
                  "pm.globals.set(\"date_effective\", data.date_effective);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"apply_immediately\": false,\t\n\t\"product_id\": \"digital-term-sub.test\"\n}"
            },
            "url": {
              "raw": "{{subscription_url}}/items/preview?remove_item_id=digital-sub.test",
              "host": [
                "{{subscription_url}}"
              ],
              "path": [
                "items",
                "preview"
              ],
              "query": [
                {
                  "key": "remove_item_id",
                  "value": "digital-sub.test",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "90feab5f-c253-43a7-b100-4ad9bc6dc34c",
          "name": "Replace the Item",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "// There should be one invoice and the total should be less than the item total",
                  "tests[\"No change invoice was created\"] = data.subscription.invoices.total_items === 0;",
                  "tests[\"The subscription is not cancelled\"] = data.subscription.status === \"active\";",
                  "tests[\"An invoice has not been created\"] = data.subscription.invoices.total_items === 0;",
                  "tests[\"The replacement item has been scheduled\"] = data.subscription.items[0].change_at_current_period_end.item_id === \"digital-term-sub.test\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"date_effective\": \"{{date_effective}}\",\n\t\"apply_immediately\": false,\n\t\"product_id\": \"digital-term-sub.test\"\n}"
            },
            "url": {
              "raw": "{{subscription_url}}/items?remove_item_id=digital-sub.test&expand=subscription.invoices",
              "host": [
                "{{subscription_url}}"
              ],
              "path": [
                "items"
              ],
              "query": [
                {
                  "key": "remove_item_id",
                  "value": "digital-sub.test",
                  "equals": true
                },
                {
                  "key": "expand",
                  "value": "subscription.invoices",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "b13b5cb6-dbd6-404a-b301-1d60aa381f45",
          "name": "Get the Customer",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Correct number of orders have been placed\"] = data.orders.total_items === 1;",
                  "tests[\"Order 1 has the correct total\"] = data.orders.data[0].total === 20;",
                  "tests[\"No refunds recorded\"] = data.refunds.total_items === 0;",
                  "tests[\"Correct nubmer of subscriptions\"] = data.subscriptions.total_items === 1 && data.subscriptions.data[0].status === \"active\";",
                  "tests[\"Correct number of credit card payments\"] = _.filter(data.payments.data, function(payment) { return payment.payment_method.type == \"credit_card\"}).length === 1;",
                  "tests[\"No customer account balance payments\"] = _.filter(data.payments.data, function(payment) { return payment.payment_method.type == \"customer_account_balance\"}).length === 0;",
                  "tests[\"All payments are completed\"] = _.filter(data.payments.data, function(payment) { return payment.status == \"completed\"}).length === 1;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "{{customer_url}}?expand=refunds.payment_method,payments.payment_method,subscriptions,invoices,orders",
              "host": [
                "{{customer_url}}"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "refunds.payment_method,payments.payment_method,subscriptions,invoices,orders",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "cc0b63df-d0c2-4bbc-9e99-963116574856",
          "name": "Cancel Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Subscription cancelled successfully\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "tests[\"Subscription cancellation confirmed\"] = data.status === \"cancelled\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"cancellation_reason\": \"Cancelled upon completion of an automated test\"\r\n}"
            },
            "url": "{{subscription_url}}/cancel",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        }
      ]
    },
    {
      "_postman_id": "5fa4fd44-148e-4ef0-a6f3-b179adc26627",
      "name": "Replace Item, Immediate, Different Plan, Downgrade",
      "description": "",
      "item": [
        {
          "_postman_id": "ba735ea5-08c3-4ac7-ba91-eb48b0a484f1",
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "2e45bc1a-8ef7-4349-8712-acfbab72f23e",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);",
                  "pm.globals.set(\"item_total\", data.items[0].total);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "812a60fa-cc92-46a0-914d-6599430f5976",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital-term-sub.test\",\r\n         \"quantity\":1\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }   \r\n}"
            },
            "url": {
              "raw": "https://{{host}}/api/v1/carts?expand=items.subscription_plan,items.subscription_terms",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "carts"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "items.subscription_plan,items.subscription_terms",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "0c8954c1-a631-433e-8d59-326c94f5910a",
          "name": "Submit Cart Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.order.items[0];",
                  "tests[\"Subscription was created\"] === item.subcription !== null;",
                  "pm.globals.set(\"subscription_url\", item.subscription.url);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "{{cart_url}}/payments?expand=order.items.subscription",
              "host": [
                "{{cart_url}}"
              ],
              "path": [
                "payments"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order.items.subscription",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "8d5df13e-4e7a-4163-9256-332e3190562c",
          "name": "Get the Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.items[0];",
                  "pm.globals.set(\"subscription_item\", item);",
                  "pm.globals.set(\"subscription_item_url\", item.url);",
                  "pm.globals.set(\"customer_url\", data.customer);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": "{{subscription_url}}",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "5bb6c6c6-574d-400a-9222-68f806907009",
          "name": "Wait 3 seconds",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "a05ebd5c-7c23-42c3-9eb9-63ddde25ee85",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "",
                  "var date = new Date();",
                  "var waitForMinutes = 7;",
                  "",
                  "tests[\"Waiting a few seconds to burn down subscription used time\"] = true;",
                  "",
                  "setTimeout(function() {",
                  "    tests[\"Timer completed. Testing resuming...\"] = true;",
                  "}, 3000);",
                  "",
                  "",
                  ""
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "9751ab2a-b7c5-4e5c-9971-064d19f11c72",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "https://{{host}}/api/v1/subscriptions",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "f241ab28-6b11-42ed-9f82-3ce8835e6c4e",
          "name": "Get the Product",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"product_price\", data.price);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "https://{{host}}/api/v1/products/digital-sub.test?currency=USD",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "products",
                "digital-sub.test"
              ],
              "query": [
                {
                  "key": "currency",
                  "value": "USD",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "69ce595e-054c-4eb4-bcb2-d38c44ca2813",
          "name": "Run Preview",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Subscription term is OK\"] = data.subscription_terms.billing_interval === 1 && data.subscription_terms.billing_interval_unit === \"hour\";",
                  "tests[\"Trial term is OK\"] = data.subscription_terms.trial_interval === null && data.subscription_terms.trial_interval_unit === null;",
                  "tests[\"Payment total equals the product price\"] = data.payment_total === 20;",
                  "",
                  "var dateEffective = new Date(data.date_effective);",
                  "var diff = Math.abs(now - dateEffective);",
                  "",
                  "var now = new Date();",
                  "var dateNextPayment = new Date(data.date_next_payment);",
                  "var dateEffective = new Date(data.date_effective);",
                  "var nextPaymentdiff = Math.abs(dateNextPayment - dateEffective);",
                  "var effectiveDiff = Math.abs(now - dateEffective);",
                  "",
                  "tests[\"Date next payment is OK \" + data.date_next_payment] = nextPaymentdiff === 3600000;",
                  "tests[\"Date effective is OK \" + data.date_effective] = effectiveDiff < 60000; // Should be \"now\", basically but we'll give a bit of a buffer to handle any time differences between client and server.",
                  "",
                  "pm.globals.set(\"payment_total\", data.payment_total);",
                  "pm.globals.set(\"refund_total\", data.refund_total);",
                  "pm.globals.set(\"net_total\", data.net_total);",
                  "pm.globals.set(\"date_effective\", data.date_effective);",
                  "pm.globals.set(\"date_next_payment\", data.date_next_payment);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"apply_immediately\": true,\t\n\t\"product_id\": \"digital-sub.test\"\n}"
            },
            "url": {
              "raw": "{{subscription_url}}/items/preview?remove_item_id=digital-term-sub.test",
              "host": [
                "{{subscription_url}}"
              ],
              "path": [
                "items",
                "preview"
              ],
              "query": [
                {
                  "key": "remove_item_id",
                  "value": "digital-term-sub.test",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "9987c8cf-4b6d-4407-a4bb-f4cd60f26d7a",
          "name": "Replace the Item",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "// There should be one invoice and the total should be less than the item total",
                  "tests[\"No change invoice was created\"] = data.subscription.invoices.total_items === 0;",
                  "tests[\"Subscription has the cancelled the other item\"] = _.find(data.subscription.items, function(item) {return item.item_id == 'digital-term-sub.test' && item.cancelled}) !== undefined;",
                  "tests[\"Original subscription is cancelled\"] = data.subscription.status === \"cancelled\";",
                  "",
                  "// Compare with the preview amounts",
                  "tests[\"Invoice total equals the preview payment total\"] = data.subscription.customer.invoices.data[0].total == pm.globals.get(\"payment_total\");",
                  "",
                  "// The external refund should be the same as the net total.",
                  "data.subscription.customer.payments.data = data.subscription.customer.payments.data.reverse();",
                  "var refund = _.find(data.subscription.customer.refunds.data, function(r) { return r.payment_method.type === \"credit_card\" });",
                  "tests[\"Credit card refund equals net total \" + pm.globals.get(\"net_total\")] = pm.globals.get(\"net_total\") === refund.total * -1;",
                  "",
                  "// The payment should be from customer account balance and be the same as the payment total",
                  "data.subscription.customer.payments.data = data.subscription.customer.payments.data.reverse();",
                  "var payment = _.find(data.subscription.customer.payments.data, function(p) { return p.payment_method.type === \"customer_account_balance\" });",
                  "tests[\"Payment equals payment total and is the correct payment method type \" + pm.globals.get(\"payment_total\")] = pm.globals.get(\"payment_total\") === payment.total;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"date_effective\": \"{{date_effective}}\",\t\n\t\"apply_immediately\": true,\t\n\t\"product_id\": \"digital-sub.test\"\n}"
            },
            "url": {
              "raw": "{{subscription_url}}/items?remove_item_id=digital-term-sub.test&expand=subscription.invoices,subscription.customer.payments.payment_method,subscription.customer.invoices,subscription.customer.refunds.payment_method",
              "host": [
                "{{subscription_url}}"
              ],
              "path": [
                "items"
              ],
              "query": [
                {
                  "key": "remove_item_id",
                  "value": "digital-term-sub.test",
                  "equals": true
                },
                {
                  "key": "expand",
                  "value": "subscription.invoices,subscription.customer.payments.payment_method,subscription.customer.invoices,subscription.customer.refunds.payment_method",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "f30a3483-e090-41cc-9457-94b1ff838fe4",
          "name": "Get the Customer",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Correct number of orders have been placed\"] = data.orders.total_items === 2;",
                  "tests[\"Order 1 has the correct total\"] = data.orders.data[0].total === 35;",
                  "tests[\"Order 2 has the correct total\"] = data.orders.data[1].total === 20;",
                  "tests[\"Refund has been recorded for the correct amount\"] = data.refunds.total_items == 2 && data.refunds.data[0].total < 30 && data.refunds.data[1].total == 20;",
                  "tests[\"Correct nubmer of subscriptions and cancellations\"] = data.subscriptions.total_items === 2 && data.subscriptions.data[0].status === \"cancelled\" && data.subscriptions.data[1].status === \"active\"",
                  "tests[\"Correct number of credit card payments\"] = _.filter(data.payments.data, function(payment) { return payment.payment_method.type == \"credit_card\"}).length === 1;",
                  "tests[\"Correct number of customer account balance payments\"] = _.filter(data.payments.data, function(payment) { return payment.payment_method.type == \"customer_account_balance\"}).length === 1;",
                  "tests[\"All payments are completed\"] = _.filter(data.payments.data, function(payment) { return payment.status == \"completed\"}).length === 2;",
                  "tests[\"Correct number of customer account balance refunds\"] = _.filter(data.refunds.data, function(refund) { return refund.payment_method.type == \"customer_account_balance\"}).length === 1;",
                  "tests[\"Correct number of total refunds\"] = data.refunds.total_items === 2;  "
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "{{customer_url}}?expand=refunds.payment_method,payments.payment_method,subscriptions,invoices,orders",
              "host": [
                "{{customer_url}}"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "refunds.payment_method,payments.payment_method,subscriptions,invoices,orders",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "e6256dca-c3db-41b0-9f62-a4c6feeb25c5",
          "name": "Cancel Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Subscription cancelled successfully\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "tests[\"Subscription cancellation confirmed\"] = data.status === \"cancelled\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"cancellation_reason\": \"Cancelled upon completion of an automated test\"\r\n}"
            },
            "url": "{{subscription_url}}/cancel",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        }
      ]
    },
    {
      "_postman_id": "4fcfc9d6-01be-43e3-97ad-104ae22eb849",
      "name": "Replace Item, Period End, Different Plan, Downgrade",
      "description": "",
      "item": [
        {
          "_postman_id": "1f878988-4374-4af7-b7b5-f8aa9cf6a46e",
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "2e45bc1a-8ef7-4349-8712-acfbab72f23e",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);",
                  "pm.globals.set(\"item_total\", data.items[0].total);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "812a60fa-cc92-46a0-914d-6599430f5976",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital-term-sub.test\",\r\n         \"quantity\":1\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }   \r\n}"
            },
            "url": {
              "raw": "https://{{host}}/api/v1/carts?expand=items.subscription_plan,items.subscription_terms",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "carts"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "items.subscription_plan,items.subscription_terms",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "e0ac153b-322c-4609-9bb9-7f87710ba745",
          "name": "Submit Cart Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.order.items[0];",
                  "tests[\"Subscription was created\"] === item.subcription !== null;",
                  "pm.globals.set(\"subscription_url\", item.subscription.url);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "{{cart_url}}/payments?expand=order.items.subscription",
              "host": [
                "{{cart_url}}"
              ],
              "path": [
                "payments"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order.items.subscription",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "a36d911f-d5ea-48bf-af7d-fe95eb715337",
          "name": "Get the Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.items[0];",
                  "pm.globals.set(\"subscription_item\", item);",
                  "pm.globals.set(\"subscription_item_url\", item.url);",
                  "pm.globals.set(\"customer_url\", data.customer);",
                  "pm.globals.set(\"date_current_period_end\", data.date_current_period_end);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": "{{subscription_url}}",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "69e90e67-dcfe-49c5-a345-5a5a79757d60",
          "name": "Wait 3 seconds",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "a05ebd5c-7c23-42c3-9eb9-63ddde25ee85",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "",
                  "var date = new Date();",
                  "var waitForMinutes = 7;",
                  "",
                  "tests[\"Waiting a few seconds to burn down subscription used time\"] = true;",
                  "",
                  "setTimeout(function() {",
                  "    tests[\"Timer completed. Testing resuming...\"] = true;",
                  "}, 3000);",
                  "",
                  "",
                  ""
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "9751ab2a-b7c5-4e5c-9971-064d19f11c72",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "https://{{host}}/api/v1/subscriptions",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "704f51f7-77c5-4b31-aec8-cc9f2ca3aff3",
          "name": "Get the Product",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"product_price\", data.price);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "https://{{host}}/api/v1/products/digital-sub.test?currency=USD",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "products",
                "digital-sub.test"
              ],
              "query": [
                {
                  "key": "currency",
                  "value": "USD",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "43891b65-1ddc-477b-adf8-515223499ec8",
          "name": "Run Preview",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Subscription term is OK\"] = data.subscription_terms.billing_interval === 2 && data.subscription_terms.billing_interval_unit === \"hour\";",
                  "tests[\"Trial term is OK\"] = data.subscription_terms.trial_interval === null && data.subscription_terms.trial_interval_unit === null;",
                  "tests[\"Payment total is 0\"] = data.payment_total === 0;",
                  "tests[\"Date next payment is OK \" + data.date_next_payment + \" \" + pm.globals.get(\"date_current_period_end\")] = data.date_next_payment === pm.globals.get(\"date_current_period_end\");",
                  "tests[\"Date effective is OK \" + data.date_effective + \" \" + pm.globals.get(\"date_current_period_end\")] = data.date_effective === pm.globals.get(\"date_current_period_end\");",
                  "",
                  "pm.globals.set(\"payment_total\", data.payment_total);",
                  "pm.globals.set(\"refund_total\", data.refund_total);",
                  "pm.globals.set(\"net_total\", data.net_total);",
                  "pm.globals.set(\"date_effective\", data.date_effective);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"apply_immediately\": false,\t\n\t\"product_id\": \"digital-sub.test\"\n}"
            },
            "url": {
              "raw": "{{subscription_url}}/items/preview?remove_item_id=digital-term-sub.test",
              "host": [
                "{{subscription_url}}"
              ],
              "path": [
                "items",
                "preview"
              ],
              "query": [
                {
                  "key": "remove_item_id",
                  "value": "digital-term-sub.test",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "9b2ab518-f11f-4d25-8586-ac19f770dda8",
          "name": "Replace the Item",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "// There should be one invoice and the total should be less than the item total",
                  "tests[\"No change invoice was created\"] = data.subscription.invoices.total_items === 0;",
                  "tests[\"The subscription is not cancelled\"] = data.subscription.status === \"active\";",
                  "tests[\"An invoice has not been created\"] = data.subscription.invoices.total_items === 0;",
                  "tests[\"The replacement item has been scheduled\"] = data.subscription.items[0].change_at_current_period_end.item_id === \"digital-sub.test\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"apply_immediately\": false,\n\t\"product_id\": \"digital-sub.test\"\n}"
            },
            "url": {
              "raw": "{{subscription_url}}/items?remove_item_id=digital-term-sub.test&expand=subscription.invoices",
              "host": [
                "{{subscription_url}}"
              ],
              "path": [
                "items"
              ],
              "query": [
                {
                  "key": "remove_item_id",
                  "value": "digital-term-sub.test",
                  "equals": true
                },
                {
                  "key": "expand",
                  "value": "subscription.invoices",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "7b064485-9e41-43de-a0fa-75634e08f204",
          "name": "Get the Customer",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Correct number of orders have been placed\"] = data.orders.total_items === 1;",
                  "tests[\"Order 1 has the correct total\"] = data.orders.data[0].total === 35;",
                  "tests[\"No refunds recorded\"] = data.refunds.total_items === 0;",
                  "tests[\"Correct nubmer of subscriptions\"] = data.subscriptions.total_items === 1 && data.subscriptions.data[0].status === \"active\";",
                  "tests[\"Correct number of credit card payments\"] = _.filter(data.payments.data, function(payment) { return payment.payment_method.type == \"credit_card\"}).length === 1;",
                  "tests[\"No customer account balance payments\"] = _.filter(data.payments.data, function(payment) { return payment.payment_method.type == \"customer_account_balance\"}).length === 0;",
                  "tests[\"All payments are completed\"] = _.filter(data.payments.data, function(payment) { return payment.status == \"completed\"}).length === 1;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "{{customer_url}}?expand=refunds.payment_method,payments.payment_method,subscriptions,invoices,orders",
              "host": [
                "{{customer_url}}"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "refunds.payment_method,payments.payment_method,subscriptions,invoices,orders",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "21486841-54c8-45bc-af0b-e876a890c8d6",
          "name": "Cancel Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Subscription cancelled successfully\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "tests[\"Subscription cancellation confirmed\"] = data.status === \"cancelled\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"cancellation_reason\": \"Cancelled upon completion of an automated test\"\r\n}"
            },
            "url": "{{subscription_url}}/cancel",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        }
      ]
    },
    {
      "_postman_id": "2c40ffaf-30a7-44fe-a6f4-b5b840d66ce9",
      "name": "Replace Item, Immediate, Different Plan, Upgrade, Both Trial",
      "description": "",
      "item": [
        {
          "_postman_id": "9873dd72-76a4-4587-93e9-969d9f59ecc4",
          "name": "Get Product",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"subscription_plan_url\", data.subscription_plan);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "https://{{host}}/api/v1/products/digital-term-sub.test"
          },
          "response": []
        },
        {
          "_postman_id": "43947f7a-5064-4803-b334-ac7c2861d1e4",
          "name": "Add Trial to Subscription Plan",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"trial_interval\": 1,\n\t\"trial_interval_unit\": \"hour\"\n}"
            },
            "url": "{{subscription_plan_url}}"
          },
          "response": []
        },
        {
          "_postman_id": "608f5177-def4-4ab5-8418-24c96f3f19bd",
          "name": "Get Product (2)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"subscription_plan_2_url\", data.subscription_plan);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "https://{{host}}/api/v1/products/digital-pro-sub.test"
          },
          "response": []
        },
        {
          "_postman_id": "36a34cdb-3b9d-4898-95b2-c7e51f18c5a7",
          "name": "Add Trial to Subscription Plan (2)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"trial_interval\": 2,\n\t\"trial_interval_unit\": \"hour\"\n}"
            },
            "url": "{{subscription_plan_2_url}}"
          },
          "response": []
        },
        {
          "_postman_id": "a85e39ba-9579-4774-b093-7fb2d3fb4da3",
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "2e45bc1a-8ef7-4349-8712-acfbab72f23e",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);",
                  "pm.globals.set(\"item_total\", data.items[0].total);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "812a60fa-cc92-46a0-914d-6599430f5976",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital-term-sub.test\",\r\n         \"quantity\":1\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }   \r\n}"
            },
            "url": {
              "raw": "https://{{host}}/api/v1/carts?expand=items.subscription_plan,items.subscription_terms",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "carts"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "items.subscription_plan,items.subscription_terms",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "d97943d3-a69b-4e82-8dae-8353ee37abeb",
          "name": "Submit Cart Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.order.items[0];",
                  "tests[\"Subscription was created\"] === item.subcription !== null;",
                  "pm.globals.set(\"subscription_url\", item.subscription.url);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "{{cart_url}}/payments?expand=order.items.subscription",
              "host": [
                "{{cart_url}}"
              ],
              "path": [
                "payments"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order.items.subscription",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "231e0cce-f476-45bc-bc46-fc4ce9bb2b06",
          "name": "Get the Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.items[0];",
                  "pm.globals.set(\"subscription_item\", item);",
                  "pm.globals.set(\"subscription_item_url\", item.url);",
                  "pm.globals.set(\"customer_url\", data.customer);",
                  "pm.globals.set(\"date_current_period_end\", data.date_current_period_end);",
                  "pm.globals.set(\"date_trial_end\", data.date_trial_end);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "{{subscription_url}}",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "9d0e4701-6d13-49b8-acf8-05e4fbe9e3c9",
          "name": "Wait 3 seconds",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "a05ebd5c-7c23-42c3-9eb9-63ddde25ee85",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "",
                  "var date = new Date();",
                  "var waitForMinutes = 7;",
                  "",
                  "tests[\"Waiting a few seconds to burn down subscription used time\"] = true;",
                  "",
                  "setTimeout(function() {",
                  "    tests[\"Timer completed. Testing resuming...\"] = true;",
                  "}, 3000);",
                  "",
                  "",
                  ""
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "9751ab2a-b7c5-4e5c-9971-064d19f11c72",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "https://{{host}}/api/v1/subscriptions",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "b79ed4b1-a8bc-4ce4-82d9-7ccfa28c4d5c",
          "name": "Run Preview",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Subscription term is OK\"] = data.subscription_terms.billing_interval === 1 && data.subscription_terms.billing_interval_unit === \"hour\";",
                  "tests[\"Trial term is OK\"] = data.subscription_terms.trial_interval === 2 && data.subscription_terms.trial_interval_unit === \"hour\";",
                  "tests[\"Payment total is correct\"] = data.payment_total === 0;",
                  "",
                  "var dateEffective = new Date(data.date_effective);",
                  "var diff = Math.abs(now - dateEffective);",
                  "",
                  "var now = new Date();",
                  "var dateEffective = new Date(data.date_effective);",
                  "var effectiveDiff = Math.abs(now - dateEffective);",
                  "",
                  "tests[\"Date next payment is OK \" + data.date_next_payment] = data.date_next_payment === pm.globals.get(\"date_current_period_end\"); // Should be the same time as the end of the current trial period.",
                  "tests[\"Date effective is OK \" + data.date_effective] = effectiveDiff < 60000; // Should be \"now\", basically but we'll give a bit of a buffer to handle any time differences between client and server.",
                  "",
                  "pm.globals.set(\"payment_total\", data.payment_total);",
                  "pm.globals.set(\"refund_total\", data.refund_total);",
                  "pm.globals.set(\"net_total\", data.net_total);",
                  "pm.globals.set(\"date_effective\", data.date_effective);",
                  "pm.globals.set(\"date_next_payment\", data.date_next_payment);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"apply_immediately\": true,\t\n\t\"product_id\": \"digital-pro-sub.test\"\n}"
            },
            "url": {
              "raw": "{{subscription_url}}/items/preview?remove_item_id=digital-term-sub.test",
              "host": [
                "{{subscription_url}}"
              ],
              "path": [
                "items",
                "preview"
              ],
              "query": [
                {
                  "key": "remove_item_id",
                  "value": "digital-term-sub.test",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "45c96025-5c2a-4a6d-91c4-fb55183498f4",
          "name": "Replace the Item",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "// There should be no invoice created",
                  "tests[\"A change invoice was created\"] = data.subscription.customer.invoices.total_items === 1;",
                  "tests[\"Subscription has the cancelled the other item\"] = _.find(data.subscription.items, function(item) {return item.item_id == 'digital-term-sub.test' && item.cancelled}) !== undefined;",
                  "tests[\"Original subscription is cancelled\"] = data.subscription.status === \"cancelled\";",
                  "",
                  "// There should be no payments",
                  "tests[\"A new payment was created\"] = data.subscription.customer.payments.total_items === 2;",
                  "tests[\"New payment total was correct\"] = data.subscription.customer.payments.data[1].total === pm.globals.get(\"payment_total\");",
                  "",
                  "// There should be no refunds",
                  "tests[\"No refund was created\"] = data.subscription.customer.refunds.total_items === 0;",
                  "",
                  "// The new subscription should have the same trial end date as the first subscription",
                  "var subscription = data.subscription.customer.subscriptions.data[1];",
                  "tests[\"The new subscription has the correct trial end date\"] = data.subscription.customer.subscriptions.data[1].date_trial_end === pm.globals.get(\"date_trial_end\");",
                  "tests[\"The new subscription has the correct period end date\"] = data.subscription.customer.subscriptions.data[1].date_current_period_end === pm.globals.get(\"date_trial_end\");",
                  "pm.globals.set(\"subscription_2_url\", subscription.url);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"date_effective\": \"{{date_effective}}\",\n\t\"apply_immediately\": true,\t\n\t\"product_id\": \"digital-pro-sub.test\"\n}"
            },
            "url": {
              "raw": "{{subscription_url}}/items?remove_item_id=digital-term-sub.test&expand=subscription.invoices,subscription.customer.payments.payment_method,subscription.customer.invoices,subscription.customer.refunds.payment_method,subscription.customer.subscriptions",
              "host": [
                "{{subscription_url}}"
              ],
              "path": [
                "items"
              ],
              "query": [
                {
                  "key": "remove_item_id",
                  "value": "digital-term-sub.test",
                  "equals": true
                },
                {
                  "key": "expand",
                  "value": "subscription.invoices,subscription.customer.payments.payment_method,subscription.customer.invoices,subscription.customer.refunds.payment_method,subscription.customer.subscriptions",
                  "equals": true
                }
              ]
            }
          },
          "response": []
        },
        {
          "_postman_id": "5399501a-6213-4ca2-b11d-deabed6b7ef4",
          "name": "Remove Trial from Subscription Plan",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"trial_interval\": null,\n\t\"trial_interval_unit\": null\n}"
            },
            "url": "{{subscription_plan_url}}"
          },
          "response": []
        },
        {
          "_postman_id": "5b18e423-e49a-41ee-898d-e752436b5eab",
          "name": "Remove Trial from Subscription Plan (2)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"trial_interval\": null,\n\t\"trial_interval_unit\": null\n}"
            },
            "url": "{{subscription_plan_2_url}}"
          },
          "response": []
        },
        {
          "_postman_id": "b6171b11-4294-4c1d-80cd-294b2f44f566",
          "name": "Cancel Subscription (2)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Subscription cancelled successfully\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "tests[\"Subscription cancellation confirmed\"] = data.status === \"cancelled\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"cancellation_reason\": \"Cancelled upon completion of an automated test\"\r\n}"
            },
            "url": "{{subscription_2_url}}/cancel",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        }
      ],
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "id": "f6325fbe-21e3-4345-bbb2-bf987f6a110e",
            "type": "text/javascript",
            "exec": [
              ""
            ]
          }
        },
        {
          "listen": "test",
          "script": {
            "id": "7573f906-8a97-4b68-9f4e-adb179803d1f",
            "type": "text/javascript",
            "exec": [
              ""
            ]
          }
        }
      ]
    },
    {
      "_postman_id": "0d714cc9-5510-46dd-b476-7303be6f6672",
      "name": "Replace Item, Immediate, Different Plan, Upgrade, Original Trial",
      "description": "",
      "item": [
        {
          "_postman_id": "a0396ae5-b640-400f-92e1-3ef975e364c1",
          "name": "Get Product",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"subscription_plan_url\", data.subscription_plan);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "https://{{host}}/api/v1/products/digital-term-sub.test"
          },
          "response": []
        },
        {
          "_postman_id": "e488e21b-522c-4f18-99dc-adbc239c1f37",
          "name": "Add Trial to Subscription Plan",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"trial_interval\": 1,\n\t\"trial_interval_unit\": \"hour\"\n}"
            },
            "url": "{{subscription_plan_url}}"
          },
          "response": []
        },
        {
          "_postman_id": "236d01f2-45b7-4855-9e6d-75022e7c89dd",
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "2e45bc1a-8ef7-4349-8712-acfbab72f23e",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);",
                  "pm.globals.set(\"item_total\", data.items[0].total);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "812a60fa-cc92-46a0-914d-6599430f5976",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital-term-sub.test\",\r\n         \"quantity\":1\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }   \r\n}"
            },
            "url": {
              "raw": "https://{{host}}/api/v1/carts?expand=items.subscription_plan,items.subscription_terms",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "carts"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "items.subscription_plan,items.subscription_terms",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "2fc5f773-488d-43a4-9231-993cf9b751e7",
          "name": "Submit Cart Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.order.items[0];",
                  "tests[\"Subscription was created\"] === item.subcription !== null;",
                  "pm.globals.set(\"subscription_url\", item.subscription.url);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "{{cart_url}}/payments?expand=order.items.subscription",
              "host": [
                "{{cart_url}}"
              ],
              "path": [
                "payments"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order.items.subscription",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "c8d3550e-a5bb-4370-a2c8-82f2b8b24938",
          "name": "Get the Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.items[0];",
                  "pm.globals.set(\"subscription_item\", item);",
                  "pm.globals.set(\"subscription_item_url\", item.url);",
                  "pm.globals.set(\"customer_url\", data.customer);",
                  "pm.globals.set(\"date_current_period_end\", data.date_current_period_end);",
                  "pm.globals.set(\"date_trial_end\", data.date_trial_end);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "{{subscription_url}}",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "52766d3d-1221-4f75-893b-9a8e7251412c",
          "name": "Wait 3 seconds",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "a05ebd5c-7c23-42c3-9eb9-63ddde25ee85",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "",
                  "var date = new Date();",
                  "var waitForMinutes = 7;",
                  "",
                  "tests[\"Waiting a few seconds to burn down subscription used time\"] = true;",
                  "",
                  "setTimeout(function() {",
                  "    tests[\"Timer completed. Testing resuming...\"] = true;",
                  "}, 3000);",
                  "",
                  "",
                  ""
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "9751ab2a-b7c5-4e5c-9971-064d19f11c72",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "https://{{host}}/api/v1/subscriptions",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "f49017ec-cd7d-411a-a9ba-3abc94952d38",
          "name": "Run Preview",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Subscription term is OK\"] = data.subscription_terms.billing_interval === 1 && data.subscription_terms.billing_interval_unit === \"hour\";",
                  "tests[\"Trial term is OK\"] = data.subscription_terms.trial_interval === null && data.subscription_terms.trial_interval_unit === null;",
                  "tests[\"Payment total is correct\"] = data.payment_total === 50; // You pay for the new item now because it doesn't have a trial, and the old item is in trial so there is no refund.",
                  "",
                  "var dateEffective = new Date(data.date_effective);",
                  "var diff = Math.abs(now - dateEffective);",
                  "",
                  "var now = new Date();",
                  "var dateNextPayment = new Date(data.date_next_payment);",
                  "var dateEffective = new Date(data.date_effective);",
                  "var nextPaymentdiff = Math.abs(dateNextPayment - dateEffective);",
                  "var effectiveDiff = Math.abs(now - dateEffective);",
                  "",
                  "tests[\"Date next payment is OK \" + data.date_next_payment] = nextPaymentdiff === 3600000;",
                  "tests[\"Date effective is OK \" + data.date_effective] = effectiveDiff < 60000; // Should be \"now\", basically but we'll give a bit of a buffer to handle any time differences between client and server.",
                  "",
                  "pm.globals.set(\"payment_total\", data.payment_total);",
                  "pm.globals.set(\"refund_total\", data.refund_total);",
                  "pm.globals.set(\"net_total\", data.net_total);",
                  "pm.globals.set(\"date_effective\", data.date_effective);",
                  "pm.globals.set(\"date_next_payment\", data.date_next_payment);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"apply_immediately\": true,\t\n\t\"product_id\": \"digital-pro-sub.test\"\n}"
            },
            "url": {
              "raw": "{{subscription_url}}/items/preview?remove_item_id=digital-term-sub.test",
              "host": [
                "{{subscription_url}}"
              ],
              "path": [
                "items",
                "preview"
              ],
              "query": [
                {
                  "key": "remove_item_id",
                  "value": "digital-term-sub.test",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "36d33a8f-2095-4c43-9fc2-d4aa9941e99a",
          "name": "Replace the Item",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "// There should be no invoice created",
                  "tests[\"A change invoice was created\"] = data.subscription.customer.invoices.total_items === 1;",
                  "tests[\"Subscription has the cancelled the other item\"] = _.find(data.subscription.items, function(item) {return item.item_id == 'digital-term-sub.test' && item.cancelled}) !== undefined;",
                  "tests[\"Original subscription is cancelled\"] = data.subscription.status === \"cancelled\";",
                  "",
                  "// There should be no payments",
                  "tests[\"A new payment was created\"] = data.subscription.customer.payments.total_items === 2;",
                  "tests[\"New payment total was correct\"] = data.subscription.customer.payments.data[1].total === pm.globals.get(\"payment_total\");",
                  "",
                  "// There should be no refunds",
                  "tests[\"No refund was created\"] = data.subscription.customer.refunds.total_items === 0;",
                  "",
                  "// The new subscription should not have a trial",
                  "var subscription = data.subscription.customer.subscriptions.data[1];",
                  "tests[\"The new subscription has the correct trial end date\"] = data.subscription.customer.subscriptions.data[1].date_trial_end === null;",
                  "pm.globals.set(\"subscription_2_url\", subscription.url);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"date_effective\": \"{{date_effective}}\",\n\t\"apply_immediately\": true,\t\n\t\"product_id\": \"digital-pro-sub.test\"\n}"
            },
            "url": {
              "raw": "{{subscription_url}}/items?remove_item_id=digital-term-sub.test&expand=subscription.invoices,subscription.customer.payments.payment_method,subscription.customer.invoices,subscription.customer.refunds.payment_method,subscription.customer.subscriptions",
              "host": [
                "{{subscription_url}}"
              ],
              "path": [
                "items"
              ],
              "query": [
                {
                  "key": "remove_item_id",
                  "value": "digital-term-sub.test",
                  "equals": true
                },
                {
                  "key": "expand",
                  "value": "subscription.invoices,subscription.customer.payments.payment_method,subscription.customer.invoices,subscription.customer.refunds.payment_method,subscription.customer.subscriptions",
                  "equals": true
                }
              ]
            }
          },
          "response": []
        },
        {
          "_postman_id": "38aaf060-9b34-43d9-b2e6-6bbedd3d1d51",
          "name": "Remove Trial from Subscription Plan",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"trial_interval\": null,\n\t\"trial_interval_unit\": null\n}"
            },
            "url": "{{subscription_plan_url}}"
          },
          "response": []
        },
        {
          "_postman_id": "f226b366-6554-4237-b234-faac6db20865",
          "name": "Cancel Subscription (2)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Subscription cancelled successfully\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "tests[\"Subscription cancellation confirmed\"] = data.status === \"cancelled\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"cancellation_reason\": \"Cancelled upon completion of an automated test\"\r\n}"
            },
            "url": "{{subscription_2_url}}/cancel",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        }
      ],
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "id": "f6325fbe-21e3-4345-bbb2-bf987f6a110e",
            "type": "text/javascript",
            "exec": [
              ""
            ]
          }
        },
        {
          "listen": "test",
          "script": {
            "id": "7573f906-8a97-4b68-9f4e-adb179803d1f",
            "type": "text/javascript",
            "exec": [
              ""
            ]
          }
        }
      ]
    },
    {
      "_postman_id": "50e83c7b-8f41-4b9b-9be9-adf4f1021f8b",
      "name": "Replace Item, Immediate, Different Plan, Upgrade, New Trial",
      "description": "",
      "item": [
        {
          "_postman_id": "86999560-65fd-40ae-9e4e-cbbfc8c38a4d",
          "name": "Get Product",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"subscription_plan_url\", data.subscription_plan);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "https://{{host}}/api/v1/products/digital-pro-sub.test"
          },
          "response": []
        },
        {
          "_postman_id": "acaf125c-cfc5-4ecf-98e8-b659061f8c28",
          "name": "Add Trial to Subscription Plan",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"trial_interval\": 1,\n\t\"trial_interval_unit\": \"hour\"\n}"
            },
            "url": "{{subscription_plan_url}}"
          },
          "response": []
        },
        {
          "_postman_id": "8385de49-77f7-4d52-a579-2255a4fec9ee",
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "2e45bc1a-8ef7-4349-8712-acfbab72f23e",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);",
                  "pm.globals.set(\"item_total\", data.items[0].total);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "812a60fa-cc92-46a0-914d-6599430f5976",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital-term-sub.test\",\r\n         \"quantity\":1\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }   \r\n}"
            },
            "url": {
              "raw": "https://{{host}}/api/v1/carts?expand=items.subscription_plan,items.subscription_terms",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "carts"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "items.subscription_plan,items.subscription_terms",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "b55f5e4c-5fda-461c-9488-992b284998ef",
          "name": "Submit Cart Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.order.items[0];",
                  "tests[\"Subscription was created\"] === item.subcription !== null;",
                  "pm.globals.set(\"subscription_url\", item.subscription.url);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "{{cart_url}}/payments?expand=order.items.subscription",
              "host": [
                "{{cart_url}}"
              ],
              "path": [
                "payments"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order.items.subscription",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "3aebcf50-a030-4cec-af99-dd55a4b69c3d",
          "name": "Get the Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.items[0];",
                  "pm.globals.set(\"subscription_item\", item);",
                  "pm.globals.set(\"subscription_item_url\", item.url);",
                  "pm.globals.set(\"customer_url\", data.customer);",
                  "pm.globals.set(\"date_current_period_end\", data.date_current_period_end);",
                  "pm.globals.set(\"date_trial_end\", data.date_trial_end);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "{{subscription_url}}",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "c344c6d1-c2c1-4ade-bb42-b75865f816c0",
          "name": "Wait 3 seconds",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "a05ebd5c-7c23-42c3-9eb9-63ddde25ee85",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "",
                  "var date = new Date();",
                  "var waitForMinutes = 7;",
                  "",
                  "tests[\"Waiting a few seconds to burn down subscription used time\"] = true;",
                  "",
                  "setTimeout(function() {",
                  "    tests[\"Timer completed. Testing resuming...\"] = true;",
                  "}, 3000);",
                  "",
                  "",
                  ""
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "9751ab2a-b7c5-4e5c-9971-064d19f11c72",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "https://{{host}}/api/v1/subscriptions",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "cc8ff86a-250a-46d3-b691-79bace404300",
          "name": "Run Preview",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Subscription term is OK\"] = data.subscription_terms.billing_interval === 1 && data.subscription_terms.billing_interval_unit === \"hour\";",
                  "tests[\"Trial term is OK\"] = data.subscription_terms.trial_interval === null && data.subscription_terms.trial_interval_unit === null;",
                  "tests[\"Payment total is correct\"] = data.payment_total === 50; // You pay for the new item now because it doesn't have a trial, and the old item is in trial so there is no refund.",
                  "",
                  "var dateEffective = new Date(data.date_effective);",
                  "var diff = Math.abs(now - dateEffective);",
                  "",
                  "var now = new Date();",
                  "var dateNextPayment = new Date(data.date_next_payment);",
                  "var dateEffective = new Date(data.date_effective);",
                  "var nextPaymentdiff = Math.abs(dateNextPayment - dateEffective);",
                  "var effectiveDiff = Math.abs(now - dateEffective);",
                  "",
                  "tests[\"Date next payment is OK \" + data.date_next_payment] = nextPaymentdiff === 3600000;",
                  "tests[\"Date effective is OK \" + data.date_effective] = effectiveDiff < 60000; // Should be \"now\", basically but we'll give a bit of a buffer to handle any time differences between client and server.",
                  "",
                  "pm.globals.set(\"payment_total\", data.payment_total);",
                  "pm.globals.set(\"refund_total\", data.refund_total);",
                  "pm.globals.set(\"net_total\", data.net_total);",
                  "pm.globals.set(\"date_effective\", data.date_effective);",
                  "pm.globals.set(\"date_next_payment\", data.date_next_payment);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"apply_immediately\": true,\t\n\t\"product_id\": \"digital-pro-sub.test\"\n}"
            },
            "url": {
              "raw": "{{subscription_url}}/items/preview?remove_item_id=digital-term-sub.test",
              "host": [
                "{{subscription_url}}"
              ],
              "path": [
                "items",
                "preview"
              ],
              "query": [
                {
                  "key": "remove_item_id",
                  "value": "digital-term-sub.test",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "07d02f63-7d4c-433c-9c04-604f09478c5c",
          "name": "Replace the Item",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "// There should be no invoice created",
                  "tests[\"A change invoice was created\"] = data.subscription.customer.invoices.total_items === 1;",
                  "tests[\"Subscription has the cancelled the other item\"] = _.find(data.subscription.items, function(item) {return item.item_id == 'digital-term-sub.test' && item.cancelled}) !== undefined;",
                  "tests[\"Original subscription is cancelled\"] = data.subscription.status === \"cancelled\";",
                  "",
                  "// There should be no payments",
                  "tests[\"New payments were created\"] = data.subscription.customer.payments.total_items === 3;",
                  "tests[\"New payment totals was correct\"] = data.subscription.customer.payments.data[1].total + data.subscription.customer.payments.data[2].total === pm.globals.get(\"payment_total\");",
                  "",
                  "// There should be no refunds",
                  "tests[\"A refund was created\"] = data.subscription.customer.refunds.total_items === 1;",
                  "tests[\"Refund total was correct\"] = data.subscription.customer.refunds.data[0].total === pm.globals.get(\"refund_total\");",
                  "",
                  "// The new subscription should not have a trial",
                  "var subscription = data.subscription.customer.subscriptions.data[1];",
                  "tests[\"The new subscription has the correct trial end date\"] = data.subscription.customer.subscriptions.data[1].date_trial_end === null;",
                  "pm.globals.set(\"subscription_2_url\", subscription.url);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"date_effective\": \"{{date_effective}}\",\n\t\"apply_immediately\": true,\t\n\t\"product_id\": \"digital-pro-sub.test\"\n}"
            },
            "url": {
              "raw": "{{subscription_url}}/items?remove_item_id=digital-term-sub.test&expand=subscription.invoices,subscription.customer.payments.payment_method,subscription.customer.invoices,subscription.customer.refunds.payment_method,subscription.customer.subscriptions",
              "host": [
                "{{subscription_url}}"
              ],
              "path": [
                "items"
              ],
              "query": [
                {
                  "key": "remove_item_id",
                  "value": "digital-term-sub.test",
                  "equals": true
                },
                {
                  "key": "expand",
                  "value": "subscription.invoices,subscription.customer.payments.payment_method,subscription.customer.invoices,subscription.customer.refunds.payment_method,subscription.customer.subscriptions",
                  "equals": true
                }
              ]
            }
          },
          "response": []
        },
        {
          "_postman_id": "b13b5cd3-4632-4712-943d-6bb5a7574786",
          "name": "Remove Trial from Subscription Plan",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"trial_interval\": null,\n\t\"trial_interval_unit\": null\n}"
            },
            "url": "{{subscription_plan_url}}"
          },
          "response": []
        },
        {
          "_postman_id": "e0e0ce31-7511-4daa-b210-e6a0b70bd13c",
          "name": "Cancel Subscription (2)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Subscription cancelled successfully\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "tests[\"Subscription cancellation confirmed\"] = data.status === \"cancelled\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"cancellation_reason\": \"Cancelled upon completion of an automated test\"\r\n}"
            },
            "url": "{{subscription_2_url}}/cancel",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        }
      ],
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "id": "f6325fbe-21e3-4345-bbb2-bf987f6a110e",
            "type": "text/javascript",
            "exec": [
              ""
            ]
          }
        },
        {
          "listen": "test",
          "script": {
            "id": "7573f906-8a97-4b68-9f4e-adb179803d1f",
            "type": "text/javascript",
            "exec": [
              ""
            ]
          }
        }
      ]
    },
    {
      "_postman_id": "4d7dbd85-3c1f-46f2-976d-25f8ba780f9a",
      "name": "Extend Subscription, No Trial",
      "description": "",
      "item": [
        {
          "_postman_id": "22fac37b-2281-492d-b081-b1535c29a812",
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "2e45bc1a-8ef7-4349-8712-acfbab72f23e",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);",
                  "pm.globals.set(\"item_total\", data.items[0].total);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "812a60fa-cc92-46a0-914d-6599430f5976",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital-sub.test\",\r\n         \"quantity\":1\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }   \r\n}"
            },
            "url": {
              "raw": "https://{{host}}/api/v1/carts?expand=items.subscription_plan,items.subscription_terms",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "carts"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "items.subscription_plan,items.subscription_terms",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "e505c807-d9c9-412c-940d-5d137a2e9a49",
          "name": "Submit Cart Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.order.items[0];",
                  "tests[\"Subscription was created\"] === item.subcription !== null;",
                  "pm.globals.set(\"subscription_url\", item.subscription);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "{{cart_url}}/payments?expand=order.items",
              "host": [
                "{{cart_url}}"
              ],
              "path": [
                "payments"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order.items",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "dc9a1787-2e9a-4656-945b-58d976bd148d",
          "name": "Get the Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.items[0];",
                  "pm.globals.set(\"subscription_item\", item);",
                  "pm.globals.set(\"subscription_item_url\", item.url);",
                  "pm.globals.set(\"subscription_period_end\", data.date_current_period_end);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": "{{subscription_url}}",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "5235d9b0-0f6f-466b-9195-4b5b007b3e5c",
          "name": "Wait 3 seconds",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "a05ebd5c-7c23-42c3-9eb9-63ddde25ee85",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "",
                  "var date = new Date();",
                  "var waitForMinutes = 7;",
                  "",
                  "tests[\"Waiting a few seconds to burn down subscription used time\"] = true;",
                  "",
                  "setTimeout(function() {",
                  "    tests[\"Timer completed. Testing resuming...\"] = true;",
                  "}, 3000);",
                  "",
                  "",
                  ""
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "9751ab2a-b7c5-4e5c-9971-064d19f11c72",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "https://{{host}}/api/v1/subscriptions",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "d49dcafe-2cf3-4166-aab1-a85522c39f11",
          "name": "Extend Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "var previousPeriodEnd = new Date(pm.globals.get(\"subscription_period_end\"));",
                  "var newPeriodEnd = new Date(data.date_current_period_end);",
                  "var diff = Math.abs(newPeriodEnd - previousPeriodEnd);",
                  "",
                  "tests[\"Previous period end \" + pm.globals.get(\"subscription_period_end\") + \"(\" + previousPeriodEnd + \")\"] = true;",
                  "tests[\"New period end \" + data.date_current_period_end + \"(\" + newPeriodEnd + \")\"] = true;",
                  "tests[\"Subscription has been extended \" + diff] = diff > (2419200000 - 10000);",
                  "tests[\"No trial\"] = data.date_trial_end === null;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"interval\": 1,\n\t\"interval_unit\": \"month\"\n}"
            },
            "url": "{{subscription_url}}/extend",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "771377ad-deb4-4668-9352-5b8360a47d63",
          "name": "Cancel Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Subscription cancelled successfully\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "tests[\"Subscription cancellation confirmed\"] = data.status === \"cancelled\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"cancellation_reason\": \"Cancelled upon completion of an automated test\"\r\n}"
            },
            "url": "{{subscription_url}}/cancel",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        }
      ]
    },
    {
      "_postman_id": "1768e429-a636-4670-94bc-c77a6cfbb5e9",
      "name": "Extend Subscription, Trial",
      "description": "",
      "item": [
        {
          "_postman_id": "86ca9806-7f9a-4c07-960a-514c0800c3cc",
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "2e45bc1a-8ef7-4349-8712-acfbab72f23e",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);",
                  "pm.globals.set(\"item_total\", data.items[0].total);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "812a60fa-cc92-46a0-914d-6599430f5976",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"physical-sub.test\",\r\n         \"quantity\":1\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }   \r\n}"
            },
            "url": {
              "raw": "https://{{host}}/api/v1/carts?expand=items.subscription_plan,items.subscription_terms",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "carts"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "items.subscription_plan,items.subscription_terms",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "91bbda66-ff79-4870-a7f1-9f98e2754198",
          "name": "Submit Cart Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.order.items[0];",
                  "tests[\"Subscription was created\"] === item.subcription !== null;",
                  "pm.globals.set(\"subscription_url\", item.subscription);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "{{cart_url}}/payments?expand=order.items",
              "host": [
                "{{cart_url}}"
              ],
              "path": [
                "payments"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order.items",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "2c1e4647-70ed-4104-b5dc-c2f3591d633f",
          "name": "Get the Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.items[0];",
                  "pm.globals.set(\"subscription_item\", item);",
                  "pm.globals.set(\"subscription_item_url\", item.url);",
                  "pm.globals.set(\"subscription_period_end\", data.date_current_period_end);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": "{{subscription_url}}",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "7549216e-1b6b-40b5-9c68-82774a86267d",
          "name": "Wait 3 seconds",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "a05ebd5c-7c23-42c3-9eb9-63ddde25ee85",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "",
                  "var date = new Date();",
                  "var waitForMinutes = 7;",
                  "",
                  "tests[\"Waiting a few seconds to burn down subscription used time\"] = true;",
                  "",
                  "setTimeout(function() {",
                  "    tests[\"Timer completed. Testing resuming...\"] = true;",
                  "}, 3000);",
                  "",
                  "",
                  ""
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "9751ab2a-b7c5-4e5c-9971-064d19f11c72",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "https://{{host}}/api/v1/subscriptions",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "be86fee3-7697-453e-91c8-4e3cc500ab04",
          "name": "Extend Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "var previousPeriodEnd = new Date(pm.globals.get(\"subscription_period_end\"));",
                  "var newPeriodEnd = new Date(data.date_current_period_end);",
                  "var diff = Math.abs(newPeriodEnd - previousPeriodEnd);",
                  "",
                  "tests[\"Previous period end \" + pm.globals.get(\"subscription_period_end\") + \"(\" + previousPeriodEnd + \")\"] = true;",
                  "tests[\"New period end \" + data.date_current_period_end + \"(\" + newPeriodEnd + \")\"] = true;",
                  "tests[\"Subscription has been extended \" + diff] = diff > (2419200000 - 10000);",
                  "tests[\"Trial is set correctly\"] = data.date_trial_end === data.date_current_period_end;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"interval\": 1,\n\t\"interval_unit\": \"month\"\n}"
            },
            "url": "{{subscription_url}}/extend",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "2dad5894-d4da-4249-96e6-f487d4fb5dd6",
          "name": "Cancel Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Subscription cancelled successfully\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "tests[\"Subscription cancellation confirmed\"] = data.status === \"cancelled\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"cancellation_reason\": \"Cancelled upon completion of an automated test\"\r\n}"
            },
            "url": "{{subscription_url}}/cancel",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        }
      ]
    },
    {
      "_postman_id": "d5550751-b8e0-4ccc-8a8b-6e7f6a149d1d",
      "name": "Cancel Item, Immediate, Single Item Subscription",
      "description": "",
      "item": [
        {
          "_postman_id": "432a48f1-88cf-41aa-99cf-1a2b74a99c44",
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "2e45bc1a-8ef7-4349-8712-acfbab72f23e",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);",
                  "pm.globals.set(\"item_total\", data.items[0].total);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "812a60fa-cc92-46a0-914d-6599430f5976",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital-sub.test\",\r\n         \"quantity\":1\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }   \r\n}"
            },
            "url": {
              "raw": "https://{{host}}/api/v1/carts?expand=items.subscription_plan,items.subscription_terms",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "carts"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "items.subscription_plan,items.subscription_terms",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "4b8f524f-2fd8-48ed-9071-79aa83ca7c06",
          "name": "Submit Cart Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.order.items[0];",
                  "tests[\"Subscription was created\"] === item.subcription !== null;",
                  "pm.globals.set(\"subscription_url\", item.subscription);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "{{cart_url}}/payments?expand=order.items",
              "host": [
                "{{cart_url}}"
              ],
              "path": [
                "payments"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order.items",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "c1e12811-446b-41ac-9fc0-e4011a4ed7d7",
          "name": "Cancel Item",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Subscription cancelled successfully\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "tests[\"Subscription cancellation confirmed\"] = data.cancelled === true;",
                  "tests[\"Date cancelled is filled\"] = data.date_cancelled !== null;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"cancel_at_current_period_end\": false,\n    \"cancellation_reason\": \"Cancelled upon completion of an automated test\"\n}"
            },
            "url": "{{subscription_url}}/items/digital-sub.test/cancel",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "7ddc2f86-a0b4-47c0-b996-ac18cef55ce2",
          "name": "Get the Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "tests[\"Subscription is cancelled\"] = data.status === \"cancelled\";",
                  "tests[\"Date cancelled is filled\"] = data.date_cancelled !== null;",
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": "{{subscription_url}}",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        }
      ],
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "id": "311bcb93-f574-4cd9-aff4-3b42640899f7",
            "type": "text/javascript",
            "exec": [
              ""
            ]
          }
        },
        {
          "listen": "test",
          "script": {
            "id": "d66d30d1-858b-49ae-92ff-4073e0510018",
            "type": "text/javascript",
            "exec": [
              ""
            ]
          }
        }
      ]
    },
    {
      "_postman_id": "50b75519-3d2c-4154-8222-72c8a2cf23cd",
      "name": "Cancel Item, Immediate, Multi Item Subscription",
      "description": "",
      "item": [
        {
          "_postman_id": "6112092a-be1d-4891-a066-1b97e1876a6d",
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "2e45bc1a-8ef7-4349-8712-acfbab72f23e",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);",
                  "pm.globals.set(\"item_total\", data.items[0].total);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "812a60fa-cc92-46a0-914d-6599430f5976",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital-sub.test\",\r\n         \"quantity\":1\r\n      },\r\n      {\r\n         \"product_id\":\"digital-pro-sub.test\",\r\n         \"quantity\":1\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }   \r\n}"
            },
            "url": {
              "raw": "https://{{host}}/api/v1/carts?expand=items.subscription_plan,items.subscription_terms",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "carts"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "items.subscription_plan,items.subscription_terms",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "6199d1e0-7c80-4613-a611-6b16b9e6eb55",
          "name": "Submit Cart Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.order.items[0];",
                  "tests[\"Subscription was created\"] === item.subcription !== null;",
                  "pm.globals.set(\"subscription_url\", item.subscription);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "{{cart_url}}/payments?expand=order.items",
              "host": [
                "{{cart_url}}"
              ],
              "path": [
                "payments"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order.items",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "a57f53f4-91be-4656-98f4-00b98b7623a4",
          "name": "Cancel Item",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Subscription cancelled successfully\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "tests[\"Subscription cancellation confirmed\"] = data.cancelled === true;",
                  "tests[\"Date cancelled is filled\"] = data.date_cancelled !== null;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"cancel_at_current_period_end\": false,\n    \"cancellation_reason\": \"Cancelled upon completion of an automated test\"\n}"
            },
            "url": "{{subscription_url}}/items/digital-sub.test/cancel",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "9b212ee4-adc3-4487-a712-deeb5eef07b6",
          "name": "Get the Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "tests[\"Subscription is not cancelled\"] = data.status === \"active\";",
                  "tests[\"Date cancelled is empty\"] = data.date_cancelled === null;",
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": "{{subscription_url}}",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        }
      ],
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "id": "311bcb93-f574-4cd9-aff4-3b42640899f7",
            "type": "text/javascript",
            "exec": [
              ""
            ]
          }
        },
        {
          "listen": "test",
          "script": {
            "id": "d66d30d1-858b-49ae-92ff-4073e0510018",
            "type": "text/javascript",
            "exec": [
              ""
            ]
          }
        }
      ]
    },
    {
      "_postman_id": "081be738-4ef8-441b-9812-b62b31139dde",
      "name": "Cancel Item, Period End, Single Item Subscription",
      "description": "",
      "item": [
        {
          "_postman_id": "c26dd546-9896-4c03-a981-1b86c324303c",
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "2e45bc1a-8ef7-4349-8712-acfbab72f23e",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);",
                  "pm.globals.set(\"item_total\", data.items[0].total);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "812a60fa-cc92-46a0-914d-6599430f5976",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital-sub.test\",\r\n         \"quantity\":1\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }   \r\n}"
            },
            "url": {
              "raw": "https://{{host}}/api/v1/carts?expand=items.subscription_plan,items.subscription_terms",
              "protocol": "https",
              "host": [
                "{{host}}"
              ],
              "path": [
                "api",
                "v1",
                "carts"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "items.subscription_plan,items.subscription_terms",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "4e791268-84d8-46a9-a1bc-8239476a76fe",
          "name": "Submit Cart Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 201\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "var item = data.order.items[0];",
                  "tests[\"Subscription was created\"] === item.subcription !== null;",
                  "pm.globals.set(\"subscription_url\", item.subscription);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": {
              "raw": "{{cart_url}}/payments?expand=order.items",
              "host": [
                "{{cart_url}}"
              ],
              "path": [
                "payments"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order.items",
                  "equals": true
                }
              ]
            },
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "e4789603-ab91-40ce-beba-7e195a54f3a8",
          "name": "Cancel Item",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Subscription cancelled successfully\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "tests[\"Subscription cancellation confirmed\"] = data.cancelled === false;",
                  "tests[\"Date cancelled is filled\"] = data.date_cancelled !== null;",
                  "tests[\"Cancelation scheduled\"] = data.cancel_at_current_period_end === true;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"cancel_at_current_period_end\": true,\n    \"cancellation_reason\": \"Cancelled upon completion of an automated test\"\n}"
            },
            "url": "{{subscription_url}}/items/digital-sub.test/cancel",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "6f8b30f0-1a48-4e5a-b0f8-df97830e0d72",
          "name": "Get the Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "30ae10f7-5785-4af0-a0cf-fb1fbdf0cc25",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "tests[\"Subscription is cancelled\"] = data.status === \"active\";",
                  "tests[\"Date cancelled is filled\"] = data.date_cancelled === null;",
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n   \"payment_method\": {\r\n     \"save\": false,\r\n     \"type\": \"credit_card\",\r\n     \"data\": {\r\n         \"number\": \"4444555566661111\",\r\n         \"cvv\": 123,\r\n         \"exp_month\": 12,\r\n         \"exp_year\": 2025\r\n      }\r\n   }\r\n}"
            },
            "url": "{{subscription_url}}",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        }
      ],
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "id": "311bcb93-f574-4cd9-aff4-3b42640899f7",
            "type": "text/javascript",
            "exec": [
              ""
            ]
          }
        },
        {
          "listen": "test",
          "script": {
            "id": "d66d30d1-858b-49ae-92ff-4073e0510018",
            "type": "text/javascript",
            "exec": [
              ""
            ]
          }
        }
      ]
    },
    {
      "_postman_id": "f7b781c5-11db-4f0e-934c-a037517f64a9",
      "name": "Post-request Cleanup",
      "description": "",
      "item": [
        {
          "_postman_id": "4de380bd-d6e7-466e-884b-ed656fa3dffb",
          "name": "Enable Order Notification Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "93d9883a-b85b-4c50-b0be-0e8a981265c4",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Order email notifications have been enabled\"] = responseCode.code === 200;"
                ]
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "aba03a74-55f6-4b4f-9ff9-e0e92a9f735a",
                "type": "text/javascript",
                "exec": [
                  ""
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"active\": true\n}"
            },
            "url": "{{order_confirmation_subscription_url}}",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "f3f10b99-370b-4ab6-b474-f0d33e648194",
          "name": "Enable Payment Notification Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "92ba83da-5fd8-40c6-af75-0bdd3dca901c",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Payment email notifications have been enabled\"] = responseCode.code === 200;",
                  "",
                  "pm.globals.unset(\"order_confirmation_subscription_url\");",
                  "pm.globals.unset(\"payment_confirmation_subscription_url\");",
                  "pm.globals.unset(\"cart_url\");",
                  "pm.globals.unset(\"subscription_plan\");",
                  "pm.globals.unset(\"subscription_terms\");",
                  "pm.globals.unset(\"subscription_url\");",
                  "pm.globals.unset(\"coupon_url\");",
                  "",
                  ""
                ]
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "aba03a74-55f6-4b4f-9ff9-e0e92a9f735a",
                "type": "text/javascript",
                "exec": [
                  ""
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"active\": true\n}"
            },
            "url": "{{payment_confirmation_subscription_url}}",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "10e3c58c-cfa2-49b7-9cd0-f1d0ef16cd44",
          "name": "Enable Refund Notification Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "92ba83da-5fd8-40c6-af75-0bdd3dca901c",
                "exec": [
                  "tests[\"Refund email notifications have been enabled\"] = responseCode.code === 200;",
                  "",
                  "pm.globals.unset(\"order_confirmation_subscription_url\");",
                  "pm.globals.unset(\"payment_confirmation_subscription_url\");",
                  "pm.globals.unset(\"refund_confirmation_subscription_url\");",
                  "pm.globals.unset(\"cart_url\");",
                  "pm.globals.unset(\"subscription_plan\");",
                  "pm.globals.unset(\"subscription_terms\");",
                  "pm.globals.unset(\"subscription_url\");",
                  "pm.globals.unset(\"coupon_url\");",
                  "",
                  ""
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "aba03a74-55f6-4b4f-9ff9-e0e92a9f735a",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"active\": true\n}"
            },
            "url": "{{refund_confirmation_subscription_url}}",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "_postman_id": "26d5bdb3-8624-4fd5-8377-2280733c021e",
          "name": "Get Subscription Plans",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "a7f20a52-80fb-4c20-a8d5-e7c404517d70",
                "exec": [
                  "tests[\"Get subscription plans\"] = responseCode.code === 200;",
                  "",
                  "var list = JSON.parse(responseBody);",
                  "var data = list.data;",
                  "",
                  "data.forEach(function(item) {",
                  "    if (item.billing_interval_unit === \"hour\" && item.trial_interval_unit === null) {",
                  "        pm.globals.set(\"hour_subscription_plan_id\", item.subscription_plan_id);",
                  "    }",
                  "        if (item.billing_interval_unit === \"hour\" && item.trial_interval_unit === \"hour\") {",
                  "        pm.globals.set(\"hour_subscription_with_trial_plan_id\", item.subscription_plan_id);",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "812a60fa-cc92-46a0-914d-6599430f5976",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "https://{{host}}/api/v1/subscription_plans",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "id": "d900d853-31a8-46bd-8a5f-0ed7dfdc62a3",
        "type": "text/javascript",
        "exec": [
          ""
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "id": "7289bc1c-fd7d-4d5c-aa90-73ca4b2a8487",
        "type": "text/javascript",
        "exec": [
          ""
        ]
      }
    }
  ],
  "variable": [
    {
      "id": "ba993a5b-8a61-421d-9ea3-134646b0ab6b",
      "key": "name",
      "value": "James Smith",
      "type": "string",
      "description": ""
    },
    {
      "id": "95b01c1f-25f4-4b4d-9b73-e982de24b91e",
      "key": "address_1",
      "value": "678 Broad St",
      "type": "string",
      "description": ""
    },
    {
      "id": "3b535d3c-6a4e-487f-84c6-00d97d98dfce",
      "key": "city",
      "value": "Westerville",
      "type": "string",
      "description": ""
    },
    {
      "id": "235ce32d-fc3f-4c73-b527-32d8348af208",
      "key": "state_prov",
      "value": "OH",
      "type": "string",
      "description": ""
    },
    {
      "id": "9ff2f1cf-2897-48a4-87b8-1ea7bf044ca6",
      "key": "postal_code",
      "value": "43081",
      "type": "string",
      "description": ""
    },
    {
      "id": "9762cc64-e8b5-4266-a813-39922c04966f",
      "key": "country",
      "value": "US",
      "type": "string",
      "description": ""
    },
    {
      "id": "1ab6a7be-28bb-4054-8fd0-c4d469748199",
      "key": "phone",
      "value": "614-555-0191",
      "type": "string",
      "description": ""
    },
    {
      "id": "8f4c1b12-c435-426c-b34a-855f336d3a8a",
      "key": "product_id",
      "value": "physical-sub.test",
      "type": "string",
      "description": ""
    }
  ]
}