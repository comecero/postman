{
  "info": {
    "_postman_id": "5f8b04cb-56ab-404b-a278-be5f32135315",
    "name": "Refunds",
    "description": "- This set of tests expects you to be using the Base Account.\n\nTests creation of refunds in various scenarios.",
    "schema": "https://schema.getpostman.com/json/collection/v2.0.0/collection.json"
  },
  "item": [
    {
      "name": "Pre-request Configurations",
      "item": [
        {
          "name": "Disable Duplicate Payment Checker",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "82452e4c-9550-4daa-8063-f5b84f40aee0",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Payment email notifications have been disabled\"] = responseCode.code === 200;",
                  "",
                  ""
                ]
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "aba03a74-55f6-4b4f-9ff9-e0e92a9f735a",
                "type": "text/javascript",
                "exec": [
                  ""
                ]
              }
            }
          ],
          "_postman_id": "c45b703f-34a2-4e9d-aacf-fb5400bba520",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"duplicate_payment_timeout\": 0\n}"
            },
            "url": "https://{{host}}/api/v1/settings/payment",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "name": "Get Notification Subscriptions",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "2592e172-faa2-4ba6-b188-29c9626dc738",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Status is 200\"] = responseCode.code === 200;",
                  "",
                  "// Find the payment, order notification subscriptions",
                  "var notifications = JSON.parse(responseBody);",
                  "var list = notifications.data;",
                  "",
                  "_.each(list, function(item) {",
                  "    ",
                  "    if (item.type === \"order:confirmation\")",
                  "        pm.globals.set(\"order_confirmation_subscription_url\", item.url);",
                  "        ",
                  "            if (item.type === \"payment:confirmation\")",
                  "        pm.globals.set(\"payment_confirmation_subscription_url\", item.url);",
                  "        ",
                  "            if (item.type === \"refund:confirmation\")",
                  "        pm.globals.set(\"refund_confirmation_subscription_url\", item.url);        ",
                  "    ",
                  "});",
                  "",
                  "",
                  ""
                ]
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "aba03a74-55f6-4b4f-9ff9-e0e92a9f735a",
                "type": "text/javascript",
                "exec": [
                  ""
                ]
              }
            }
          ],
          "_postman_id": "878f9fa6-7bda-47a6-a2ad-e7e7730f757a",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"promotion_code\": \"{{promotion_code}}\",\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"{{product_id}}\",\r\n         \"quantity\":1\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }   \r\n}"
            },
            "url": "https://{{host}}/api/v1/notification_subscriptions",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "name": "Disable Order Notification Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "ec320aec-60a1-416a-8184-2ebe91db1f38",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Order email notifications have been disabled\"] = responseCode.code === 200;",
                  "",
                  "",
                  ""
                ]
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "aba03a74-55f6-4b4f-9ff9-e0e92a9f735a",
                "type": "text/javascript",
                "exec": [
                  ""
                ]
              }
            }
          ],
          "_postman_id": "33ccc4eb-0166-4842-a906-a4abec9d13e4",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"active\": false\n}"
            },
            "url": "{{order_confirmation_subscription_url}}",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "name": "Disable Payment Notification Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "82452e4c-9550-4daa-8063-f5b84f40aee0",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Payment email notifications have been disabled\"] = responseCode.code === 200;",
                  "",
                  ""
                ]
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "aba03a74-55f6-4b4f-9ff9-e0e92a9f735a",
                "type": "text/javascript",
                "exec": [
                  ""
                ]
              }
            }
          ],
          "_postman_id": "efdb5aaa-4982-4e49-91c3-f9eac20b7302",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"active\": false\n}"
            },
            "url": "{{payment_confirmation_subscription_url}}",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "name": "Disable Refund Notification Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "5de69872-771e-4fc8-8bc0-76c002663061",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Refund email notifications have been disabled\"] = responseCode.code === 200;",
                  "",
                  ""
                ]
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "aba03a74-55f6-4b4f-9ff9-e0e92a9f735a",
                "type": "text/javascript",
                "exec": [
                  ""
                ]
              }
            }
          ],
          "_postman_id": "ecbc5724-06a6-4fe0-a574-2e9c0cc8ae4b",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"active\": false\n}"
            },
            "url": "{{refund_confirmation_subscription_url}}",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        }
      ],
      "_postman_id": "60ac07b8-fe67-4652-ab82-ddd3907ab9d1",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "id": "db236e77-f986-4125-b356-5008a2e559a8",
            "type": "text/javascript",
            "exec": [
              ""
            ]
          }
        },
        {
          "listen": "test",
          "script": {
            "id": "fa8477f9-7918-46af-8244-edb14f473d45",
            "type": "text/javascript",
            "exec": [
              ""
            ]
          }
        }
      ]
    },
    {
      "name": "Direct Payment, Full Refund",
      "item": [
        {
          "name": "Create Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"payment_url\", data.url);"
                ]
              }
            }
          ],
          "_postman_id": "0a4c9e0d-e5d3-4b72-a374-0763b7a682fb",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"total\": 100,\n   \"currency\": \"USD\",\n   \"capture\": true,    \n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "https://{{host}}/api/v1/payments"
          },
          "response": []
        },
        {
          "name": "Submit Refund",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "fad07258-c4a3-4be0-b3bf-bba6e878a177",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Refund was successful\"] = data.total === 100 && data.subtotal === 100;"
                ]
              }
            }
          ],
          "_postman_id": "1602c26c-4210-47d2-ada1-2e1061a5de8e",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "{{payment_url}}/refunds"
          },
          "response": []
        }
      ],
      "_postman_id": "5a88c7b8-aa51-4bc8-8512-5d89fd34dfd8"
    },
    {
      "name": "Direct Payment, With Shipping",
      "item": [
        {
          "name": "Create Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"payment_url\", data.url);"
                ]
              }
            }
          ],
          "_postman_id": "76622758-0ee0-41b9-a4fb-8eec21053b66",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"total\": 100,\n   \"shipping\": 10,\n   \"currency\": \"USD\",\n   \"capture\": true,    \n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "https://{{host}}/api/v1/payments"
          },
          "response": []
        },
        {
          "name": "Submit Refund",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "63700591-fe09-430e-92cf-c8b7daa1c6e8",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Refund was successful\"] = data.shipping === 10 && data.total === 10;"
                ]
              }
            }
          ],
          "_postman_id": "065b0c3d-09b4-44ab-aa20-ba307eb74553",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"shipping\": 10\n}"
            },
            "url": "{{payment_url}}/refunds"
          },
          "response": []
        }
      ],
      "_postman_id": "02345c04-b0c7-4611-b181-821a0af032fa"
    },
    {
      "name": "Direct Payment, With Tax",
      "item": [
        {
          "name": "Create Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"payment_url\", data.url);"
                ]
              }
            }
          ],
          "_postman_id": "babd8876-b5c8-4b72-a4fd-67343562d6d6",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"total\": 100,\n   \"shipping\": 10,\n   \"tax\": 5,\n   \"currency\": \"USD\",\n   \"capture\": true,    \n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "https://{{host}}/api/v1/payments"
          },
          "response": []
        },
        {
          "name": "Submit Refund",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "76b8a95b-bf9a-4d1b-8810-1a664aa5ae64",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Refund was successful\"] = data.tax === 5 && data.total === 5 && data.subtotal === 0;"
                ]
              }
            }
          ],
          "_postman_id": "53c961de-64b2-4a19-9fe4-a959051aa4bc",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"tax\": 5\n}"
            },
            "url": "{{payment_url}}/refunds"
          },
          "response": []
        }
      ],
      "_postman_id": "29b9b343-1531-4bc2-8875-603b1d29f67a"
    },
    {
      "name": "Direct Payment, Calculate Tax",
      "item": [
        {
          "name": "Create Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"payment_url\", data.url);"
                ]
              }
            }
          ],
          "_postman_id": "af492d50-2fd3-4a0a-8ee5-5b575c641d97",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"total\": 130,\n   \"shipping\": 20,\n   \"tax\": 10,\n   \"currency\": \"USD\",\n   \"capture\": true,    \n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2023,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "https://{{host}}/api/v1/payments"
          },
          "response": []
        },
        {
          "name": "Submit Refund",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "c90e7a31-b9de-4b51-b720-a829f5f44263",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Refund was successful\"] = data.tax === 5 && data.shipping === 10 && data.total === 65;"
                ]
              }
            }
          ],
          "_postman_id": "cdb5c3d5-65c5-4db7-aa18-d1a069295e1f",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"total\": 65\n}"
            },
            "url": "{{payment_url}}/refunds"
          },
          "response": []
        }
      ],
      "_postman_id": "7404d8fa-2fc2-4fa2-b529-4bc67202818b"
    },
    {
      "name": "Direct Payment, With Amounts More Than Original",
      "item": [
        {
          "name": "Create Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"payment_url\", data.url);"
                ]
              }
            }
          ],
          "_postman_id": "c7a727e8-47b9-45f4-a8bd-eafeb1069892",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"total\": 100,\n   \"shipping\": 10,\n   \"currency\": \"USD\",\n   \"capture\": true,    \n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "https://{{host}}/api/v1/payments"
          },
          "response": []
        },
        {
          "name": "Submit Refund",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "86a0ad52-b928-4f55-ad55-db82a00b1413",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Check that you can't submit more than the original shipping amount\"] = responseCode.code === 400;"
                ]
              }
            }
          ],
          "_postman_id": "9118c6cd-52b0-40d1-94bb-548ad0b942a3",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"shipping\": 12\n}"
            },
            "url": "{{payment_url}}/refunds"
          },
          "response": []
        }
      ],
      "_postman_id": "3974d87a-e592-4fbf-9c7a-f101cd52411f"
    },
    {
      "name": "Direct Payment, Partial Refunds",
      "item": [
        {
          "name": "Create Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"payment_url\", data.url);"
                ]
              }
            }
          ],
          "_postman_id": "1a2d9b2a-54d3-4cfa-804b-7956b7ae42bb",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"total\": 100,\n   \"currency\": \"USD\",\n   \"capture\": true,    \n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "https://{{host}}/api/v1/payments"
          },
          "response": []
        },
        {
          "name": "Submit Refund",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "3c71742a-d648-4a47-8acf-1ea1c2532396",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Refund was successful\"] = data.total === 20 && data.subtotal === 20 && data.tax === 0 && data.shipping === 0;"
                ]
              }
            }
          ],
          "_postman_id": "791e2f91-fcc6-45ac-8a0f-99a1f3bb0e00",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"total\": 20\n}"
            },
            "url": "{{payment_url}}/refunds"
          },
          "response": []
        },
        {
          "name": "Submit Refund Remainder",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "5361b40a-232b-4889-8baf-395964d88183",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Refund was successful\"] = data.total === 80 && data.subtotal === 80 && data.shipping === 0 && data.tax === 0;"
                ]
              }
            }
          ],
          "_postman_id": "f99adf16-64ab-4853-a4ad-7b2e2261c380",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "{{payment_url}}/refunds"
          },
          "response": []
        }
      ],
      "_postman_id": "74fc263e-2491-4a33-97b1-4d1d7d5f93b0"
    },
    {
      "name": "Direct Payment, More Than Payment",
      "item": [
        {
          "name": "Create Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"payment_url\", data.url);"
                ]
              }
            }
          ],
          "_postman_id": "dbeece8d-a0ae-448a-b204-7be3eaa144c6",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"total\": 100,\n   \"currency\": \"USD\",\n   \"capture\": true,    \n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "https://{{host}}/api/v1/payments"
          },
          "response": []
        },
        {
          "name": "Submit Refund",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "8e81082b-a914-453a-a3d5-49626b34b8b8",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Check that you can't submit more than the original payment amount\"] = responseCode.code === 400;"
                ]
              }
            }
          ],
          "_postman_id": "5439072e-de80-4924-9a46-a71af48325d5",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"total\": 110\n}"
            },
            "url": "{{payment_url}}/refunds"
          },
          "response": []
        }
      ],
      "_postman_id": "b08a8012-6119-4175-8085-4b4b5563803d"
    },
    {
      "name": "Direct Payment, More Than Payment w/ Partials",
      "item": [
        {
          "name": "Create Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"payment_url\", data.url);"
                ]
              }
            }
          ],
          "_postman_id": "ec538ebd-37e6-438e-80dd-ad5a9f166554",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"total\": 100,\n   \"currency\": \"USD\",\n   \"capture\": true,    \n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "https://{{host}}/api/v1/payments"
          },
          "response": []
        },
        {
          "name": "Submit Refund",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "b51494b7-f0bc-414f-b37b-26637f44bc4f",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Refund was successful\"] = data.total === 20;"
                ]
              }
            }
          ],
          "_postman_id": "202c84b9-a1fc-4883-83ce-c951b5881b8e",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"total\": 20\n}"
            },
            "url": "{{payment_url}}/refunds"
          },
          "response": []
        },
        {
          "name": "Submit Refund More than Original",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "8e81082b-a914-453a-a3d5-49626b34b8b8",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Check that you can't submit more than the original payment amount\"] = responseCode.code === 400;"
                ]
              }
            }
          ],
          "_postman_id": "0b6c9776-b55e-4deb-b121-58c1def28ccc",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"total\": 90\n}"
            },
            "url": "{{payment_url}}/refunds"
          },
          "response": []
        }
      ],
      "_postman_id": "e73c8ded-5650-48c7-8a0e-c82f8b8aea34"
    },
    {
      "name": "From Order, Full Refund",
      "item": [
        {
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "3a0eecbc-a75e-4942-a4bf-2ee73fe61f21",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Cart created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);"
                ]
              }
            }
          ],
          "_postman_id": "a4e4c148-c59a-47c0-9c5e-5299884d9852",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital.test\",\r\n         \"quantity\":3\r\n      },   \t\r\n      {\r\n         \"product_id\":\"physical.test\",\r\n         \"quantity\":2\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }\r\n}"
            },
            "url": "https://{{host}}/api/v1/carts"
          },
          "response": []
        },
        {
          "name": "Create Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"order_url\", data.order);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "f746f38a-fe61-4b97-8be4-226f393d6761",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"capture\": true,    \n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "{{cart_url}}/payments"
          },
          "response": []
        },
        {
          "name": "Submit Refund",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "466c1548-eabb-4a62-96f5-df16d621b469",
                "exec": [
                  "tests[\"Refund created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Refund was successful\"] = data.total === 100 && data.subtotal === 90 && data.shipping === 10 && data.tax === 0;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "29c7cafc-9bcd-4c26-8706-3bdd71cab7e8",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "{{order_url}}/refunds"
          },
          "response": []
        }
      ],
      "_postman_id": "dcfdf4f7-f892-4cf9-947d-8dcce2de1b37"
    },
    {
      "name": "From Order, Partial Refunds",
      "item": [
        {
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "3a0eecbc-a75e-4942-a4bf-2ee73fe61f21",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Cart created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);"
                ]
              }
            }
          ],
          "_postman_id": "057641d5-9926-4d8d-b699-d109ce3624d1",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital.test\",\r\n         \"quantity\":3\r\n      },   \t\r\n      {\r\n         \"product_id\":\"physical.test\",\r\n         \"quantity\":2\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }\r\n}"
            },
            "url": "https://{{host}}/api/v1/carts"
          },
          "response": []
        },
        {
          "name": "Create Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"order_url\", data.order);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "0657db45-45b9-48ee-bd11-6a9a61d59d65",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"capture\": true,    \n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "{{cart_url}}/payments"
          },
          "response": []
        },
        {
          "name": "Submit Refund",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "ebc31667-fb7a-414b-a260-017a2d2bfc29",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Refund was successful\"] = data.total === 20 && data.shipping === 2 && data.subtotal === 18 && data.tax === 0;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "c0af8134-aad9-4360-96b2-43e6885a5d86",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"total\": 20\n}"
            },
            "url": "{{order_url}}/refunds"
          },
          "response": []
        },
        {
          "name": "Submit Refund Remainder",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "0ee4a4dc-9a73-4fa7-aa7d-e2b06d0b3e0b",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Refund was successful\"] = data.total === 80 && data.subtotal === 72 && data.shipping === 8 && data.tax === 0;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "0a179e8c-140d-46f6-a651-cc62fb072ad3",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"total\": 80\n}"
            },
            "url": "{{order_url}}/refunds"
          },
          "response": []
        }
      ],
      "_postman_id": "06a1bf42-46c5-47ba-9413-c5ad4b9e174c"
    },
    {
      "name": "From Order, Refund Items",
      "item": [
        {
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "3a0eecbc-a75e-4942-a4bf-2ee73fe61f21",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Cart created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);"
                ]
              }
            }
          ],
          "_postman_id": "3b4ee9e7-c070-41ea-84f9-6e13b7d6f861",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital.test\",\r\n         \"quantity\":3\r\n      },   \t\r\n      {\r\n         \"product_id\":\"physical.test\",\r\n         \"quantity\":2\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }\r\n}"
            },
            "url": "https://{{host}}/api/v1/carts"
          },
          "response": []
        },
        {
          "name": "Create Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"order_url\", data.order);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "f182add8-53a6-47e1-b387-d7d4a9e03571",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"capture\": true,    \n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "{{cart_url}}/payments"
          },
          "response": []
        },
        {
          "name": "Submit Refund",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "ec1490a0-afff-49ef-8749-f5d7362f8bda",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Refund was successful\"] = data.total === 90 && data.subtotal === 90 && data.shipping === 0 && data.tax === 0;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "69223b3d-2749-4111-90b9-aacdc2a97653",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"items\":[\n      {\n         \"item_id\":\"digital.test\",\n         \"quantity\":3\n      },   \t\n      {\n         \"item_id\":\"physical.test\",\n         \"quantity\":2\n      }        \n   ]\n}"
            },
            "url": "{{order_url}}/refunds"
          },
          "response": []
        }
      ],
      "_postman_id": "21209e77-7960-454f-bd7f-3903a1497923"
    },
    {
      "name": "From Order, Refund Items, More Than Order",
      "item": [
        {
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "3a0eecbc-a75e-4942-a4bf-2ee73fe61f21",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Cart created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);"
                ]
              }
            }
          ],
          "_postman_id": "8820fb1e-2075-447e-846c-464196acd080",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital.test\",\r\n         \"quantity\":3\r\n      },   \t\r\n      {\r\n         \"product_id\":\"physical.test\",\r\n         \"quantity\":2\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }\r\n}"
            },
            "url": "https://{{host}}/api/v1/carts"
          },
          "response": []
        },
        {
          "name": "Create Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"order_url\", data.order);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "852d5eb8-012a-44e1-999d-0db44b9a50ba",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"capture\": true,    \n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "{{cart_url}}/payments"
          },
          "response": []
        },
        {
          "name": "Submit Refund",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "88962220-a52d-40b0-8b9b-88edceef1deb",
                "exec": [
                  "tests[\"Check refunding more items that in order\"] = responseCode.code === 400;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "6c477ab5-150b-47cb-a0f2-90cd6c3b1839",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"items\":[\n      {\n         \"item_id\":\"digital.test\",\n         \"quantity\":4\n      },   \t\n      {\n         \"item_id\":\"physical.test\",\n         \"quantity\":2\n      }        \n   ]\n}"
            },
            "url": "{{order_url}}/refunds"
          },
          "response": []
        }
      ],
      "_postman_id": "e18094d1-7e9a-4569-9af6-b9edb3bd86f3"
    },
    {
      "name": "From Order, Refund Items, More Than Order w/ Partials",
      "item": [
        {
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "3a0eecbc-a75e-4942-a4bf-2ee73fe61f21",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Cart created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);"
                ]
              }
            }
          ],
          "_postman_id": "a07c323f-43b4-4e67-8b9e-f9567b0baec4",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital.test\",\r\n         \"quantity\":3\r\n      },   \t\r\n      {\r\n         \"product_id\":\"physical.test\",\r\n         \"quantity\":2\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }\r\n}"
            },
            "url": "https://{{host}}/api/v1/carts"
          },
          "response": []
        },
        {
          "name": "Create Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"order_url\", data.order);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "bb6fdb2c-cae9-47e9-a73d-6bb8c5314579",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"capture\": true,    \n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "{{cart_url}}/payments"
          },
          "response": []
        },
        {
          "name": "Submit Refund",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "b96552fc-b8d6-4837-83bc-6f4ffae7fff6",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Refund was successful\"] = data.total === 40;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "b38a81ef-3921-4e4d-b131-dbac6ab0ef02",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"items\":[\n      {\n         \"item_id\":\"digital.test\",\n         \"quantity\":1\n      },   \t\n      {\n         \"item_id\":\"physical.test\",\n         \"quantity\":1\n      }        \n   ]\n}"
            },
            "url": "{{order_url}}/refunds"
          },
          "response": []
        },
        {
          "name": "Submit Refund More Than Original",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "8e779a5f-cc28-4b8c-9535-04f7c7f7a066",
                "exec": [
                  "tests[\"Check refunding more items that in order with partial refund\"] = responseCode.code === 400;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "4c573294-6e79-4d94-b8df-d8cc7210cfca",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"items\":[\n      {\n         \"item_id\":\"digital.test\",\n         \"quantity\":3\n      }       \n   ]\n}"
            },
            "url": "{{order_url}}/refunds"
          },
          "response": []
        }
      ],
      "_postman_id": "ed12715b-0224-4ad4-ba2a-85cc759bdcbe"
    },
    {
      "name": "From Order, Refund Items with Shipping",
      "item": [
        {
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "3a0eecbc-a75e-4942-a4bf-2ee73fe61f21",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Cart created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);"
                ]
              }
            }
          ],
          "_postman_id": "cc8d7d89-de81-4c67-ad61-2e3031d6cbb0",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital.test\",\r\n         \"quantity\":3\r\n      },   \t\r\n      {\r\n         \"product_id\":\"physical.test\",\r\n         \"quantity\":2\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }\r\n}"
            },
            "url": "https://{{host}}/api/v1/carts"
          },
          "response": []
        },
        {
          "name": "Create Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"order_url\", data.order);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "36cf1f98-f7b5-4808-9200-a7c682c38a5a",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"capture\": true,    \n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "{{cart_url}}/payments"
          },
          "response": []
        },
        {
          "name": "Submit Refund",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "0f1028eb-5704-49b2-a602-637a8d2f1cb3",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Refund was successful\"] = data.total === 100 && data.subtotal === 90 && data.shipping === 10 && data.tax === 0;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "9751edcb-6dce-421d-a6e1-fa2ffa1eaae1",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"shipping\": 10,\n   \"items\":[\n      {\n         \"item_id\":\"digital.test\",\n         \"quantity\":3\n      },   \t\n      {\n         \"item_id\":\"physical.test\",\n         \"quantity\":2\n      }       \n   ]\n}"
            },
            "url": "{{order_url}}/refunds"
          },
          "response": []
        }
      ],
      "_postman_id": "36c357a2-af0d-47a0-9192-fc624c2a3260"
    },
    {
      "name": "From Order, Shipping Only",
      "item": [
        {
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "3a0eecbc-a75e-4942-a4bf-2ee73fe61f21",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Cart created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);"
                ]
              }
            }
          ],
          "_postman_id": "54b02e18-d239-4ef9-b84d-cbc4472b0e65",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital.test\",\r\n         \"quantity\":3\r\n      },   \t\r\n      {\r\n         \"product_id\":\"physical.test\",\r\n         \"quantity\":2\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }\r\n}"
            },
            "url": "https://{{host}}/api/v1/carts"
          },
          "response": []
        },
        {
          "name": "Create Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"order_url\", data.order);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "086e3e6e-b117-406a-8c1b-309a5fa3f238",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"capture\": true,    \n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "{{cart_url}}/payments"
          },
          "response": []
        },
        {
          "name": "Submit Refund",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "cea79572-2d85-4038-915f-7d0b4cac258a",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Refund was successful\"] = data.total === 10 && data.shipping === 10;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "504b8b1e-eaf9-43e8-b782-82842ef4b3cc",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"shipping\": 10\n}"
            },
            "url": "{{order_url}}/refunds"
          },
          "response": []
        }
      ],
      "_postman_id": "83b00a3d-ff23-4502-985a-472d685dcc8f"
    },
    {
      "name": "From Order, Multiple Payments",
      "item": [
        {
          "name": "Create Invoice",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "f73e074e-0051-4e94-82f4-e0517427cadc",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Invoice created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Total is OK\"] = data.total === 45;",
                  "tests[\"Item count is OK\"] = data.items_count === data.items.length && data.items_count === 2;",
                  "pm.globals.set(\"invoice_url\", data.url);"
                ]
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "4953e1ce-d1dd-48de-af8f-1305445dc4e8",
                "type": "text/javascript",
                "exec": [
                  "var date = new Date();",
                  "date.setMonth(date.getMonth() + 1);",
                  "pm.globals.set(\"date_due\", date.toISOString().substring(0, 10));"
                ]
              }
            }
          ],
          "_postman_id": "66c69844-16f2-4ada-8009-df559fd82e4e",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"date_due\": \"{{date_due}}\",\r\n  \"draft\": false,\r\n  \"suppress_customer_notification\": true,\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital.test\",\r\n         \"quantity\":1\r\n      },\r\n      {\r\n         \"product_id\":\"physical.test\",\r\n         \"quantity\":1\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }   \r\n}"
            },
            "url": "https://{{host}}/api/v1/invoices"
          },
          "response": []
        },
        {
          "name": "Create Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Status is pending\"] = data.status === \"completed\";",
                  "tests[\"Total is OK\"] = data.total === 5;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "16762c35-3f1a-4782-b202-c2ae5c8e4a17",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"capture\": true,\n   \"total\": 5,\n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "{{invoice_url}}/payments"
          },
          "response": []
        },
        {
          "name": "Create Failed Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment failed\"] = responseCode.code === 402;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Status is pending\"] = data.error.meta.payment.status === \"failed\";",
                  "tests[\"Total is OK\"] = data.error.meta.payment.total === 15;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "bb6917a1-005b-4cef-ac23-aae1419c7f55",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"capture\": true,\n   \"total\": 15,\n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566669999\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "{{invoice_url}}/payments"
          },
          "response": []
        },
        {
          "name": "Create Payment (Remainder)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"order_url\", data.order.url);",
                  "pm.globals.set(\"order_total\", data.order.total);",
                  "",
                  "tests[\"Status is pending\"] = data.status === \"completed\";",
                  "tests[\"Total is OK\"] = data.total === 40;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "52d7ff91-70fd-4f29-82f9-79a983ba11cc",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"capture\": true,\n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": {
              "raw": "{{invoice_url}}/payments?expand=order",
              "host": [
                "{{invoice_url}}"
              ],
              "path": [
                "payments"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Refund Order",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Capture request created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Refunds were successful\"] = data.success_count === 2;",
                  "tests[\"Correct number of refunds processed\"] = data.refunds.length === 2;",
                  "tests[\"Correct amount was refunded \" + pm.globals.get(\"order_total\")] = pm.globals.get(\"order_total\") === data.total;",
                  "",
                  "tests[\"Refunds processed in the correct order\"] === data.refunds[0].total > data.refunds[1].total;",
                  "",
                  "tests[\"Refund status is OK\"] = data.refunds[0].status === \"completed\";",
                  "tests[\"Refund 2 status is OK\"] = data.refunds[1].status === \"completed\";",
                  "tests[\"Order status is OK\"] = data.refunds[0].order.payment_status === \"refunded\";",
                  "tests[\"Invoice status is OK\"] = data.refunds[0].invoice.payment_status === \"refunded\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "3a08910d-d755-419c-9e52-8a8d24de75e1",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": {
              "raw": "{{order_url}}/refunds?expand=refunds.order,refunds.invoice",
              "host": [
                "{{order_url}}"
              ],
              "path": [
                "refunds"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "refunds.order,refunds.invoice"
                }
              ]
            }
          },
          "response": []
        }
      ],
      "_postman_id": "8107c389-274b-488b-a5bf-d3e2f3d2178b"
    },
    {
      "name": "From Order, Multiple Payments, Refund Failure",
      "item": [
        {
          "name": "Create Invoice",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "f73e074e-0051-4e94-82f4-e0517427cadc",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Invoice created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Total is OK\"] = data.total === 45;",
                  "tests[\"Item count is OK\"] = data.items_count === data.items.length && data.items_count === 2;",
                  "pm.globals.set(\"invoice_url\", data.url);"
                ]
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "4953e1ce-d1dd-48de-af8f-1305445dc4e8",
                "type": "text/javascript",
                "exec": [
                  "var date = new Date();",
                  "date.setMonth(date.getMonth() + 1);",
                  "pm.globals.set(\"date_due\", date.toISOString().substring(0, 10));"
                ]
              }
            }
          ],
          "_postman_id": "58f9678b-cec7-4820-9b0c-21369807a407",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"date_due\": \"{{date_due}}\",\r\n  \"draft\": false,\r\n  \"suppress_customer_notification\": true,\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital.test\",\r\n         \"quantity\":1\r\n      },\r\n      {\r\n         \"product_id\":\"physical.test\",\r\n         \"quantity\":1\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }   \r\n}"
            },
            "url": "https://{{host}}/api/v1/invoices"
          },
          "response": []
        },
        {
          "name": "Create Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Status is OK\"] = data.status === \"completed\";",
                  "tests[\"Total is OK\"] = data.total === 5;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "a60c109f-0b08-43aa-87fb-e162d4142b85",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"capture\": true,\n   \"total\": 5,\n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "{{invoice_url}}/payments"
          },
          "response": []
        },
        {
          "name": "Create Payment (Remainder)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"order_url\", data.order.url);",
                  "pm.globals.set(\"order_total\", data.order.total);",
                  "",
                  "tests[\"Status is OK\"] = data.status === \"completed\";",
                  "tests[\"Total is OK\"] = data.total === 40;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "af5b5d7f-21cb-4aaa-bd02-e092de918178",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"capture\": true,\n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661152\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": {
              "raw": "{{invoice_url}}/payments?expand=order",
              "host": [
                "{{invoice_url}}"
              ],
              "path": [
                "payments"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Refund Order",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Refund request created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Refund were successful\"] = data.success_count === 1;",
                  "tests[\"Correct number of refunds attempted\"] = data.refunds.length === 2;",
                  "tests[\"Correct amount was refunded\"] = data.total === 5;",
                  "",
                  "tests[\"Refunds processed in the correct order\"] === data.refunds[0].total > data.refunds[1].total;",
                  "",
                  "tests[\"Refund status is OK\"] = data.refunds[0].status === \"failed\";",
                  "tests[\"Refund 2 status is OK\"] = data.refunds[1].status === \"completed\";",
                  "tests[\"Order status is OK\"] = data.refunds[0].order.payment_status === \"completed\";",
                  "tests[\"Invoice status is OK\"] = data.refunds[0].invoice.payment_status === \"completed\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "970ce9d7-db1f-4fd8-b777-76338df88d7d",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": {
              "raw": "{{order_url}}/refunds?expand=refunds.order,refunds.invoice",
              "host": [
                "{{order_url}}"
              ],
              "path": [
                "refunds"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "refunds.order,refunds.invoice"
                }
              ]
            }
          },
          "response": []
        }
      ],
      "_postman_id": "02ca3c83-6c10-45fc-a7a5-d0a7a597091d"
    },
    {
      "name": "From Order, Multiple Payments, Pending",
      "item": [
        {
          "name": "Create Invoice",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "f73e074e-0051-4e94-82f4-e0517427cadc",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Invoice created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Total is OK\"] = data.total === 45;",
                  "tests[\"Item count is OK\"] = data.items_count === data.items.length && data.items_count === 2;",
                  "pm.globals.set(\"invoice_url\", data.url);"
                ]
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "4953e1ce-d1dd-48de-af8f-1305445dc4e8",
                "type": "text/javascript",
                "exec": [
                  "var date = new Date();",
                  "date.setMonth(date.getMonth() + 1);",
                  "pm.globals.set(\"date_due\", date.toISOString().substring(0, 10));"
                ]
              }
            }
          ],
          "_postman_id": "86e36bd9-a0bc-4bf4-8493-d8e0a7ddd68f",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"date_due\": \"{{date_due}}\",\r\n  \"draft\": false,\r\n  \"suppress_customer_notification\": true,\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital.test\",\r\n         \"quantity\":1\r\n      },\r\n      {\r\n         \"product_id\":\"physical.test\",\r\n         \"quantity\":1\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }   \r\n}"
            },
            "url": "https://{{host}}/api/v1/invoices"
          },
          "response": []
        },
        {
          "name": "Create Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Status is OK\"] = data.status === \"completed\";",
                  "tests[\"Total is OK\"] = data.total === 5;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "b4f9779f-dee3-46a0-acf4-4957efcbfbe2",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"capture\": true,\n   \"total\": 5,\n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "{{invoice_url}}/payments"
          },
          "response": []
        },
        {
          "name": "Create Payment (Pending)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Status is OK\"] = data.status === \"pending\";",
                  "tests[\"Total is OK\"] = data.total === 10;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "90f5b9fb-a9b7-43f0-b1ae-1b8ab37f5af7",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"capture\": false,\n   \"total\": 10,\n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "{{invoice_url}}/payments"
          },
          "response": []
        },
        {
          "name": "Create Payment (Remainder)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"order_url\", data.order.url);",
                  "pm.globals.set(\"order_total\", data.order.total);",
                  "",
                  "tests[\"Status is OK\"] = data.status === \"completed\";",
                  "tests[\"Total is OK\"] = data.total === 30;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "56b50cd1-b202-4753-853b-63f860a27a2b",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"capture\": true,\n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": {
              "raw": "{{invoice_url}}/payments?expand=order",
              "host": [
                "{{invoice_url}}"
              ],
              "path": [
                "payments"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Refund Order (Overflow)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Refund more than captured total\"] = responseCode.code === 400;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "76a4fae6-125d-47dd-96c6-8f1a8d8df3a1",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"total\": 45\n}"
            },
            "url": {
              "raw": "{{order_url}}/refunds?expand=refunds.order,refunds.invoice",
              "host": [
                "{{order_url}}"
              ],
              "path": [
                "refunds"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "refunds.order,refunds.invoice"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Refund Order",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Refund request created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Refunds were successful\"] = data.success_count === 2;",
                  "tests[\"Correct number of refunds processed\"] = data.refunds.length === 2;",
                  "tests[\"Correct amount was refunded\"] = data.total === 35;",
                  "",
                  "tests[\"Refunds processed in the correct order\"] === data.refunds[0].total > data.refunds[1].total;",
                  "",
                  "tests[\"Refund status is OK\"] = data.refunds[0].status === \"completed\";",
                  "tests[\"Refund 2 status is OK\"] = data.refunds[1].status === \"completed\";",
                  "tests[\"Order status is OK\"] = data.refunds[0].order.payment_status === \"pending\";",
                  "tests[\"Invoice status is OK\"] = data.refunds[0].invoice.payment_status === \"pending\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "192c63dc-c372-4c97-975f-31cf9f4f1cea",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": {
              "raw": "{{order_url}}/refunds?expand=refunds.order,refunds.invoice",
              "host": [
                "{{order_url}}"
              ],
              "path": [
                "refunds"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "refunds.order,refunds.invoice"
                }
              ]
            }
          },
          "response": []
        }
      ],
      "_postman_id": "513e677b-5246-4d07-ada5-ed531384f28c"
    },
    {
      "name": "From Order, Mixture of Payment Statuses",
      "item": [
        {
          "name": "Create Invoice",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "3a0eecbc-a75e-4942-a4bf-2ee73fe61f21",
                "exec": [
                  "tests[\"Cart created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"invoice_url\", data.url);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "6a2ce46a-9657-400c-a902-ee2f2b44ad9e",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"date_due\": \"{{date_due}}\",\r\n  \"draft\": false,\r\n  \"suppress_customer_notification\": true,\t\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital.test\",\r\n         \"quantity\":3\r\n      },   \t\r\n      {\r\n         \"product_id\":\"physical.test\",\r\n         \"quantity\":2\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }\r\n}"
            },
            "url": "https://{{host}}/api/v1/invoices"
          },
          "response": []
        },
        {
          "name": "Partial Payment (Success, Capture)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "tests[\"Total is OK\"] = data.total === 15;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "18f64238-8345-4a7a-8375-c26ca4e331c4",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"total\": 15,\n   \"capture\": true,    \n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "{{invoice_url}}/payments"
          },
          "response": []
        },
        {
          "name": "Partial Payment (Success, No Capture)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "tests[\"Total is OK\"] = data.total === 20;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "93328a64-78aa-4a73-8d22-ffcda58c1668",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"total\": 20,\n    \"capture\": false,\n    \"payment_method\": {\n        \"save\": true,\n        \"type\": \"credit_card\",\n        \"data\": {\n            \"number\": \"4444555566661111\",\n            \"cvv\": 123,\n            \"exp_month\": 12,\n            \"exp_year\": 2022,\n            \"cardholder_name\": \"{{name}}\",\n            \"billing_address\": {\n                \"address_1\": \"{{address_1}}.\",\n                \"city\": \"{{city}}\",\n                \"state_prov\": \"{{state_prov}}\",\n                \"postal_code\": \"{{postal_code}}\",\n                \"country\": \"{{country}}\"\n            }\n        }\n    }\n}"
            },
            "url": "{{invoice_url}}/payments"
          },
          "response": []
        },
        {
          "name": "Partial Payment (Fail)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment failed\"] = responseCode.code === 402;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "aeb093f3-382e-4603-ae7b-5391d8ce6054",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"total\": 35,\n   \"capture\": true,    \n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566669999\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "{{invoice_url}}/payments"
          },
          "response": []
        },
        {
          "name": "Remainder Payment (Success, Capture)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "tests[\"Total is OK\"] = data.total === 65;",
                  "pm.globals.set(\"order_url\", data.order);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "b6caee0d-4b97-44b0-abbc-ec6b7368ee9f",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"capture\": true,    \n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "{{invoice_url}}/payments"
          },
          "response": []
        },
        {
          "name": "Submit Refund",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "466c1548-eabb-4a62-96f5-df16d621b469",
                "exec": [
                  "tests[\"Refund created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Refund was successful\"] = data.total === 70;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "fdb555a3-0e49-4fbe-9dba-ff1ad9edb7f0",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"total\": 70\n}"
            },
            "url": "{{order_url}}/refunds"
          },
          "response": []
        },
        {
          "name": "Submit Refund (Overflow)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "466c1548-eabb-4a62-96f5-df16d621b469",
                "exec": [
                  "tests[\"Refund failed\"] = responseCode.code === 400;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "b8a57a37-0034-4090-aee4-be8f53bc15ad",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"total\": 31\n}"
            },
            "url": "{{order_url}}/refunds"
          },
          "response": []
        },
        {
          "name": "Submit Refund (Remainder)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "466c1548-eabb-4a62-96f5-df16d621b469",
                "exec": [
                  "tests[\"Refund created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Refund was successful\"] = data.total === 10; // 10 and not 30 because there's a $20 pending payment."
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "e31feab2-365e-4dd5-99cf-0543c331c3c5",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"total\": 10\n}"
            },
            "url": "{{order_url}}/refunds"
          },
          "response": []
        }
      ],
      "_postman_id": "a18fd47b-6486-49f8-9604-52599c55bb81"
    },
    {
      "name": "From Order, Multiple Payments, Chargeback",
      "item": [
        {
          "name": "Create Invoice",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "f73e074e-0051-4e94-82f4-e0517427cadc",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Invoice created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Total is OK\"] = data.total === 45;",
                  "tests[\"Item count is OK\"] = data.items_count === data.items.length && data.items_count === 2;",
                  "pm.globals.set(\"invoice_url\", data.url);"
                ]
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "4953e1ce-d1dd-48de-af8f-1305445dc4e8",
                "type": "text/javascript",
                "exec": [
                  "var date = new Date();",
                  "date.setMonth(date.getMonth() + 1);",
                  "pm.globals.set(\"date_due\", date.toISOString().substring(0, 10));"
                ]
              }
            }
          ],
          "_postman_id": "340ed305-94e0-4e06-a5fc-ee626cf8db97",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"date_due\": \"{{date_due}}\",\r\n  \"draft\": false,\r\n  \"suppress_customer_notification\": true,\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital.test\",\r\n         \"quantity\":1\r\n      },\r\n      {\r\n         \"product_id\":\"physical.test\",\r\n         \"quantity\":1\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }   \r\n}"
            },
            "url": "https://{{host}}/api/v1/invoices"
          },
          "response": []
        },
        {
          "name": "Create Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Status is pending\"] = data.status === \"completed\";",
                  "tests[\"Total is OK\"] = data.total === 5;",
                  "",
                  "pm.globals.set(\"payment_url\", data.url);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "22bbc193-165c-44e2-bae3-721b83879ea4",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"capture\": true,\n   \"total\": 5,\n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "{{invoice_url}}/payments"
          },
          "response": []
        },
        {
          "name": "Create Payment (Remainder)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"order_url\", data.order.url);",
                  "pm.globals.set(\"order_total\", data.order.total);",
                  "",
                  "tests[\"Status is pending\"] = data.status === \"completed\";",
                  "tests[\"Total is OK\"] = data.total === 40;",
                  "",
                  "pm.globals.set(\"payment_2_url\", data.url);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "5764de14-b421-4f59-837c-79b81b88748e",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"capture\": true,\n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": {
              "raw": "{{invoice_url}}/payments?expand=order",
              "host": [
                "{{invoice_url}}"
              ],
              "path": [
                "payments"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Refund Order",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Chargeback failed, can't record against order\"] = responseCode.code === 400;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "d2171d2c-b20d-460b-aa66-9797c131fc29",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"total\": 5,\n\t\"is_chargeback\": true\n}"
            },
            "url": "{{order_url}}/refunds"
          },
          "response": []
        },
        {
          "name": "Refund Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Capture request created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Correct amount was refunded\"] = data.total === 5;",
                  "tests[\"Refund marked as chargeback\"] = data.is_chargeback === true;",
                  "tests[\"Refund status is OK\"] = data.status === \"completed\";",
                  "tests[\"Payment status is OK\"] = data.payment.status === \"refunded\";",
                  "tests[\"Order status is OK\"] = data.order.payment_status === \"completed\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "174a3a20-75a4-4f27-aa7b-1d2bc5604f81",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"total\": 5,\n\t\"is_chargeback\": true\n}"
            },
            "url": {
              "raw": "{{payment_url}}/refunds?expand=order,payment",
              "host": [
                "{{payment_url}}"
              ],
              "path": [
                "refunds"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order,payment"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Refund Payment (2)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Capture request created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Correct amount was refunded\"] = data.total === 40;",
                  "tests[\"Refund marked as chargeback\"] = data.is_chargeback === true;",
                  "tests[\"Refund status is OK\"] = data.status === \"completed\";",
                  "tests[\"Payment status is OK\"] = data.payment.status === \"refunded\";",
                  "tests[\"Order status is OK\"] = data.order.payment_status === \"refunded\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "917e3b50-12a5-49c8-862e-eb2003012167",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"total\": 40,\n\t\"is_chargeback\": true\n}"
            },
            "url": {
              "raw": "{{payment_2_url}}/refunds?expand=order,payment",
              "host": [
                "{{payment_2_url}}"
              ],
              "path": [
                "refunds"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order,payment"
                }
              ]
            }
          },
          "response": []
        }
      ],
      "_postman_id": "150e1127-5ae8-43e3-b4f5-a455487cecac"
    },
    {
      "name": "From Order, Record Only",
      "item": [
        {
          "name": "Create Invoice",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "f73e074e-0051-4e94-82f4-e0517427cadc",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Invoice created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Total is OK\"] = data.total === 45;",
                  "tests[\"Item count is OK\"] = data.items_count === data.items.length && data.items_count === 2;",
                  "pm.globals.set(\"invoice_url\", data.url);"
                ]
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "4953e1ce-d1dd-48de-af8f-1305445dc4e8",
                "type": "text/javascript",
                "exec": [
                  "var date = new Date();",
                  "date.setMonth(date.getMonth() + 1);",
                  "pm.globals.set(\"date_due\", date.toISOString().substring(0, 10));"
                ]
              }
            }
          ],
          "_postman_id": "2103f64d-10bf-4f61-bea8-94d51cb6c4f5",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"date_due\": \"{{date_due}}\",\r\n  \"draft\": false,\r\n  \"suppress_customer_notification\": true,\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital.test\",\r\n         \"quantity\":1\r\n      },\r\n      {\r\n         \"product_id\":\"physical.test\",\r\n         \"quantity\":1\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }   \r\n}"
            },
            "url": "https://{{host}}/api/v1/invoices"
          },
          "response": []
        },
        {
          "name": "Create Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Status is pending\"] = data.status === \"completed\";",
                  "tests[\"Total is OK\"] = data.total === 5;",
                  "",
                  "pm.globals.set(\"payment_url\", data.url);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "624dfec3-c2b8-45a0-954d-3a7bf0406a3d",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"total\": 5,\n    \"capture\": true,\n    \"payment_method\": {\n        \"save\": true,\n        \"type\": \"credit_card\",\n        \"data\": {\n            \"number\": \"4444555566661111\",\n            \"cvv\": 123,\n            \"exp_month\": 12,\n            \"exp_year\": 2022,\n            \"cardholder_name\": \"{{name}}\",\n            \"billing_address\": {\n                \"address_1\": \"{{address_1}}.\",\n                \"city\": \"{{city}}\",\n                \"state_prov\": \"{{state_prov}}\",\n                \"postal_code\": \"{{postal_code}}\",\n                \"country\": \"{{country}}\"\n            }\n        }\n    }\n}"
            },
            "url": "{{invoice_url}}/payments"
          },
          "response": []
        },
        {
          "name": "Create Payment (Remainder)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Status is completed\"] = data.status === \"completed\";",
                  "tests[\"Total is OK\"] = data.total === 40;",
                  "",
                  "pm.globals.set(\"payment_2_url\", data.url);",
                  "pm.globals.set(\"order_url\", data.order);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "f8964976-4b1d-48cc-8ff6-4454a95e9f45",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"capture\": true,\n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "{{invoice_url}}/payments"
          },
          "response": []
        },
        {
          "name": "Refund Order",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Refund failed, can't record 'record only' against order\"] = responseCode.code === 400;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "d4aed47f-8d66-4c81-95d3-c8964eaaa515",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"total\": 5,\n\t\"record_only\": true,\n\t\"record_only_memo\": \"Refund as part of an automated test\"\n}"
            },
            "url": "{{order_url}}/refunds"
          },
          "response": []
        },
        {
          "name": "Refund Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Capture request created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Correct amount was refunded\"] = data.total === 5;",
                  "tests[\"Refund marked as record only\"] = data.record_only === true;",
                  "tests[\"Record only memo set\"] = data.record_only_memo !== null;",
                  "tests[\"Refund status is OK\"] = data.status === \"completed\";",
                  "tests[\"Payment status is OK\"] = data.payment.status === \"refunded\";",
                  "tests[\"Order status is OK\"] = data.order.payment_status === \"completed\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "b5aec1f1-ac22-462a-bc68-9e595d94c1e9",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"total\": 5,\n\t\"record_only\": true,\n\t\"record_only_memo\": \"Refund as part of an automated test\"\n}"
            },
            "url": {
              "raw": "{{payment_url}}/refunds?expand=order,payment",
              "host": [
                "{{payment_url}}"
              ],
              "path": [
                "refunds"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order,payment"
                }
              ]
            }
          },
          "response": []
        }
      ],
      "_postman_id": "1e4ec435-bfd8-4b53-ab56-74d35c11a35e"
    },
    {
      "name": "From Order, Multiple Payments, Refunds, Calculated Final",
      "item": [
        {
          "name": "Create Invoice",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "f73e074e-0051-4e94-82f4-e0517427cadc",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Invoice created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Total is OK\"] = data.total === 45;",
                  "tests[\"Item count is OK\"] = data.items_count === data.items.length && data.items_count === 2;",
                  "pm.globals.set(\"invoice_url\", data.url);"
                ]
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "4953e1ce-d1dd-48de-af8f-1305445dc4e8",
                "type": "text/javascript",
                "exec": [
                  "var date = new Date();",
                  "date.setMonth(date.getMonth() + 1);",
                  "pm.globals.set(\"date_due\", date.toISOString().substring(0, 10));"
                ]
              }
            }
          ],
          "_postman_id": "d4b624a8-f6e5-409e-836f-48c742bfbb16",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"date_due\": \"{{date_due}}\",\r\n  \"draft\": false,\r\n  \"suppress_customer_notification\": true,\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital.test\",\r\n         \"quantity\":1\r\n      },\r\n      {\r\n         \"product_id\":\"physical.test\",\r\n         \"quantity\":1\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }   \r\n}"
            },
            "url": "https://{{host}}/api/v1/invoices"
          },
          "response": []
        },
        {
          "name": "Create Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Status is pending\"] = data.status === \"completed\";",
                  "tests[\"Total is OK\"] = data.total === 15;",
                  "",
                  "pm.globals.set(\"payment_url\", data.url);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "91ea354b-406a-4b94-928f-ce62eb0e679f",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"capture\": true,\n   \"total\": 15,\n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "{{invoice_url}}/payments"
          },
          "response": []
        },
        {
          "name": "Create Failed Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment failed\"] = responseCode.code === 402;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Status is pending\"] = data.error.meta.payment.status === \"failed\";",
                  "tests[\"Total is OK\"] = data.error.meta.payment.total === 15;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "a719ca96-3983-49a9-89ae-83776639ed16",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"capture\": true,\n   \"total\": 15,\n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566669999\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "{{invoice_url}}/payments"
          },
          "response": []
        },
        {
          "name": "Create Payment (Remainder)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"order_url\", data.order.url);",
                  "pm.globals.set(\"order_total\", data.order.total);",
                  "",
                  "tests[\"Status is pending\"] = data.status === \"completed\";",
                  "tests[\"Total is OK\"] = data.total === 30;",
                  "",
                  "pm.globals.set(\"payment_2_url\", data.url);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "a44a0091-96a3-45a5-ba64-9f81ae77b63f",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"capture\": true,\n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": {
              "raw": "{{invoice_url}}/payments?expand=order",
              "host": [
                "{{invoice_url}}"
              ],
              "path": [
                "payments"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Partial Refund",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Refund created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Correct amount was refunded\"] = data.total === 10;",
                  "tests[\"Refund status is OK\"] = data.status === \"completed\";",
                  "tests[\"Payment status is OK\"] = data.payment.status === \"completed\";",
                  "tests[\"Order status is OK\"] = data.order.payment_status === \"completed\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "5cccd5ae-5890-4366-9196-e48384ce70de",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"total\": 10\n}"
            },
            "url": {
              "raw": "{{payment_url}}/refunds?expand=order,payment",
              "host": [
                "{{payment_url}}"
              ],
              "path": [
                "refunds"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order,payment"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Partial Refund (2)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Refund created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Correct amount was refunded\"] = data.total === 20;",
                  "tests[\"Refund status is OK\"] = data.status === \"completed\";",
                  "tests[\"Payment status is OK\"] = data.payment.status === \"completed\";",
                  "tests[\"Order status is OK\"] = data.order.payment_status === \"completed\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "f9ec1b7d-19ee-4c9a-807c-d7f934360d24",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"total\": 20\n}"
            },
            "url": {
              "raw": "{{payment_2_url}}/refunds?expand=order,payment",
              "host": [
                "{{payment_2_url}}"
              ],
              "path": [
                "refunds"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order,payment"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Refund Order",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Capture request created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Refunds were successful\"] = data.success_count === 2;",
                  "tests[\"Correct number of refunds processed\"] = data.refunds.length === 2;",
                  "tests[\"Correct amount was refunded\"] = data.total === 15;",
                  "",
                  "tests[\"Refunds processed in the correct order\"] === data.refunds[0].total > data.refunds[1].total;",
                  "",
                  "tests[\"Refund status is OK\"] = data.refunds[0].status === \"completed\";",
                  "tests[\"Refund 2 status is OK\"] = data.refunds[1].status === \"completed\";",
                  "tests[\"Order status is OK\"] = data.refunds[0].order.payment_status === \"refunded\";",
                  "tests[\"Invoice status is OK\"] = data.refunds[0].invoice.payment_status === \"refunded\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "2aaa3279-d9b8-4d19-a6c2-f1699f9a57e1",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": {
              "raw": "{{order_url}}/refunds?expand=refunds.order,refunds.invoice",
              "host": [
                "{{order_url}}"
              ],
              "path": [
                "refunds"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "refunds.order,refunds.invoice"
                }
              ]
            }
          },
          "response": []
        }
      ],
      "_postman_id": "947a8e5b-feda-4b93-85b9-a7b8bf157b7d"
    },
    {
      "name": "From Order, Multiple Payments, Refunds, Chain",
      "item": [
        {
          "name": "Create Invoice",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "f73e074e-0051-4e94-82f4-e0517427cadc",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Invoice created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Total is OK\"] = data.total === 45;",
                  "tests[\"Item count is OK\"] = data.items_count === data.items.length && data.items_count === 2;",
                  "pm.globals.set(\"invoice_url\", data.url);"
                ]
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "4953e1ce-d1dd-48de-af8f-1305445dc4e8",
                "type": "text/javascript",
                "exec": [
                  "var date = new Date();",
                  "date.setMonth(date.getMonth() + 1);",
                  "pm.globals.set(\"date_due\", date.toISOString().substring(0, 10));"
                ]
              }
            }
          ],
          "_postman_id": "5f67ecf7-2d1f-46ab-9740-f3ee20aff2a1",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"date_due\": \"{{date_due}}\",\r\n  \"draft\": false,\r\n  \"suppress_customer_notification\": true,\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital.test\",\r\n         \"quantity\":1\r\n      },\r\n      {\r\n         \"product_id\":\"physical.test\",\r\n         \"quantity\":1\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }   \r\n}"
            },
            "url": "https://{{host}}/api/v1/invoices"
          },
          "response": []
        },
        {
          "name": "Create Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Status is correct\"] = data.status === \"completed\";",
                  "tests[\"Total is OK\"] = data.total === 15;",
                  "",
                  "pm.globals.set(\"payment_url\", data.url);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "856a2fe3-7a7c-44a5-bc51-1e61d5bf270d",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"capture\": true,\n   \"total\": 15,\n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "{{invoice_url}}/payments"
          },
          "response": []
        },
        {
          "name": "Create Payment (2)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Status is correct\"] = data.status === \"completed\";",
                  "tests[\"Total is OK\"] = data.total === 20;",
                  "",
                  "pm.globals.set(\"payment_2_url\", data.url);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "e7cbd022-bdf5-43cb-b22b-2cc30ab921a8",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"total\": 20,\n    \"capture\": true,\n    \"payment_method\": {\n        \"save\": true,\n        \"type\": \"credit_card\",\n        \"data\": {\n            \"number\": \"4444555566661111\",\n            \"cvv\": 123,\n            \"exp_month\": 12,\n            \"exp_year\": 2022,\n            \"cardholder_name\": \"{{name}}\",\n            \"billing_address\": {\n                \"address_1\": \"{{address_1}}.\",\n                \"city\": \"{{city}}\",\n                \"state_prov\": \"{{state_prov}}\",\n                \"postal_code\": \"{{postal_code}}\",\n                \"country\": \"{{country}}\"\n            }\n        }\n    }\n}"
            },
            "url": {
              "raw": "{{invoice_url}}/payments?expand=order",
              "host": [
                "{{invoice_url}}"
              ],
              "path": [
                "payments"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Create Payment (Remainder)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Status is OK\"] = data.status === \"completed\";",
                  "tests[\"Total is OK\"] = data.total === 10;",
                  "",
                  "pm.globals.set(\"payment_3_url\", data.url);",
                  "pm.globals.set(\"order_url\", data.order.url);",
                  "pm.globals.set(\"order_total\", data.order.total);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "7f3007c2-097e-4f52-9d8f-90fc5e5b86f1",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"capture\": true,\n    \"payment_method\": {\n        \"save\": true,\n        \"type\": \"credit_card\",\n        \"data\": {\n            \"number\": \"4444555566661111\",\n            \"cvv\": 123,\n            \"exp_month\": 12,\n            \"exp_year\": 2022,\n            \"cardholder_name\": \"{{name}}\",\n            \"billing_address\": {\n                \"address_1\": \"{{address_1}}.\",\n                \"city\": \"{{city}}\",\n                \"state_prov\": \"{{state_prov}}\",\n                \"postal_code\": \"{{postal_code}}\",\n                \"country\": \"{{country}}\"\n            }\n        }\n    }\n}"
            },
            "url": {
              "raw": "{{invoice_url}}/payments?expand=order",
              "host": [
                "{{invoice_url}}"
              ],
              "path": [
                "payments"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Partial Refund",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Refund created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Correct amount was refunded\"] = data.total === 1;",
                  "tests[\"Refund status is OK\"] = data.status === \"completed\";",
                  "tests[\"Payment status is OK\"] = data.payment.status === \"completed\";",
                  "tests[\"Order status is OK\"] = data.order.payment_status === \"completed\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "8c56b638-0b58-422e-872c-79f94557d3fb",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"total\": 1\n}"
            },
            "url": {
              "raw": "{{payment_url}}/refunds?expand=order,payment",
              "host": [
                "{{payment_url}}"
              ],
              "path": [
                "refunds"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order,payment"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Partial Refund (2)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Refund created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Correct amount was refunded\"] = data.total === 2;",
                  "tests[\"Refund status is OK\"] = data.status === \"completed\";",
                  "tests[\"Payment status is OK\"] = data.payment.status === \"completed\";",
                  "tests[\"Order status is OK\"] = data.order.payment_status === \"completed\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "46b69f14-d66c-4ff7-9809-b333285faedf",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"total\": 2\n}"
            },
            "url": {
              "raw": "{{payment_2_url}}/refunds?expand=order,payment",
              "host": [
                "{{payment_2_url}}"
              ],
              "path": [
                "refunds"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order,payment"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Partial Refund (3)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Refund created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Correct amount was refunded\"] = data.total === 3;",
                  "tests[\"Refund status is OK\"] = data.status === \"completed\";",
                  "tests[\"Payment status is OK\"] = data.payment.status === \"completed\";",
                  "tests[\"Order status is OK\"] = data.order.payment_status === \"completed\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "ca589115-b2cf-44d0-97e6-213c5f35cde2",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"total\": 3\n}"
            },
            "url": {
              "raw": "{{payment_3_url}}/refunds?expand=order,payment",
              "host": [
                "{{payment_3_url}}"
              ],
              "path": [
                "refunds"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "order,payment"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Refund Order",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Capture request created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Refunds were successful\"] = data.success_count === 3;",
                  "tests[\"Correct number of refunds processed\"] = data.refunds.length === 3;",
                  "tests[\"Correct amount was refunded\"] = data.total === 38;",
                  "",
                  "tests[\"Refunds processed in the correct order\"] === data.refunds[0].total > data.refunds[1].total;",
                  "",
                  "tests[\"Refund status is OK\"] = data.refunds[0].status === \"completed\";",
                  "tests[\"Refund 2 status is OK\"] = data.refunds[1].status === \"completed\";",
                  "tests[\"Refund 3 status is OK\"] = data.refunds[2].status === \"completed\";",
                  "tests[\"Order status is OK\"] = data.refunds[0].order.payment_status === \"completed\";",
                  "tests[\"Invoice status is OK\"] = data.refunds[0].invoice.payment_status === \"completed\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "7e24eeea-fe8d-48d3-81da-f90a2e86428f",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"total\": 38\n}"
            },
            "url": {
              "raw": "{{order_url}}/refunds?expand=refunds.order,refunds.invoice",
              "host": [
                "{{order_url}}"
              ],
              "path": [
                "refunds"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "refunds.order,refunds.invoice"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Refund Order (2)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Capture request created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Refunds were successful\"] = data.success_count === 1;",
                  "tests[\"Correct number of refunds processed\"] = data.refunds.length === 1;",
                  "tests[\"Correct amount was refunded\"] = data.total === 1;",
                  "",
                  "tests[\"Refund status is OK\"] = data.refunds[0].status === \"completed\";",
                  "tests[\"Order status is OK\"] = data.refunds[0].order.payment_status === \"refunded\";",
                  "tests[\"Invoice status is OK\"] = data.refunds[0].invoice.payment_status === \"refunded\";"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "090c2073-6b77-49c0-9d1e-eda68c1cccc9",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": {
              "raw": "{{order_url}}/refunds?expand=refunds.order,refunds.invoice",
              "host": [
                "{{order_url}}"
              ],
              "path": [
                "refunds"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "refunds.order,refunds.invoice"
                }
              ]
            }
          },
          "response": []
        }
      ],
      "_postman_id": "460d1df1-790f-4a62-b557-40d938f5c32d"
    },
    {
      "name": "From Order, Refund to CAB, with Chargeback",
      "item": [
        {
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "3a0eecbc-a75e-4942-a4bf-2ee73fe61f21",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Cart created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);"
                ]
              }
            }
          ],
          "_postman_id": "7ed8dbe2-2c7a-4ee8-8e40-d408d3b84623",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital.test\",\r\n         \"quantity\":3\r\n      },   \t\r\n      {\r\n         \"product_id\":\"physical.test\",\r\n         \"quantity\":2\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }\r\n}"
            },
            "url": "https://{{host}}/api/v1/carts"
          },
          "response": []
        },
        {
          "name": "Create Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"order_url\", data.order);",
                  "pm.globals.set(\"payment_url\", data.url);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "7a37ecf5-0cba-4cca-92d9-e417a5d8b9c3",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"capture\": true,    \n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "{{cart_url}}/payments"
          },
          "response": []
        },
        {
          "name": "Submit Refund",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "466c1548-eabb-4a62-96f5-df16d621b469",
                "exec": [
                  "tests[\"Refund created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Refund was successful\"] = data.total === 100 && data.subtotal === 90 && data.shipping === 10 && data.tax === 0;",
                  "",
                  "pm.globals.set(\"customer_url\", data.refunds[0].customer);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "381f02c5-1d27-46a1-b390-333dc8682d35",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"payment_method\": {\n        \"type\": \"customer_account_balance\"\n    }\n}"
            },
            "url": {
              "raw": "{{order_url}}/refunds?expand=refunds.payment_method",
              "host": [
                "{{order_url}}"
              ],
              "path": [
                "refunds"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "refunds.payment_method"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Check CAB",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "466c1548-eabb-4a62-96f5-df16d621b469",
                "exec": [
                  "tests[\"Balance fetched successfully\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Balance is correct\"] = data.amount === 100;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "e16956bf-6c6e-461d-8e1f-4d26e8f5507c",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"payment_method\": {\n\t\t\"type\": \"customer_account_balance\"\n\t}\n}"
            },
            "url": "{{customer_url}}/balance"
          },
          "response": []
        },
        {
          "name": "Process Chargeback",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "466c1548-eabb-4a62-96f5-df16d621b469",
                "exec": [
                  "tests[\"Chargeback created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Chargeback was successful\"] = data.total === 100 && data.subtotal === 90 && data.shipping === 10 && data.tax === 0;",
                  "",
                  "pm.globals.set(\"customer_url\", data.customer);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "7286811a-f611-4225-9cb3-42dd05affa16",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"is_chargeback\": true,\n\t\"total\": 100\n}"
            },
            "url": {
              "raw": "{{payment_url}}/refunds?expand=refunds.payment_method",
              "host": [
                "{{payment_url}}"
              ],
              "path": [
                "refunds"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "refunds.payment_method"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Check CAB (2)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "466c1548-eabb-4a62-96f5-df16d621b469",
                "exec": [
                  "tests[\"Balance fetched successfully\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Balance is correct\"] = data.amount === 0;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "3ccd42da-ac8d-4104-950a-5c98b503d19b",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"payment_method\": {\n\t\t\"type\": \"customer_account_balance\"\n\t}\n}"
            },
            "url": "{{customer_url}}/balance"
          },
          "response": []
        },
        {
          "name": "Process Chargeback (2)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "466c1548-eabb-4a62-96f5-df16d621b469",
                "exec": [
                  "tests[\"Chargeback cannot be created\"] = responseCode.code === 400;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "458d1cfa-7d9a-49eb-b9e5-145332f9899b",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"is_chargeback\": true,\n\t\"total\": 100\n}"
            },
            "url": {
              "raw": "{{payment_url}}/refunds?expand=refunds.payment_method",
              "host": [
                "{{payment_url}}"
              ],
              "path": [
                "refunds"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "refunds.payment_method"
                }
              ]
            }
          },
          "response": []
        }
      ],
      "_postman_id": "02def655-f40b-4756-8405-efcd1e6d4382"
    },
    {
      "name": "From Order, Refund to CAB, with Partial Chargeback",
      "item": [
        {
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "3a0eecbc-a75e-4942-a4bf-2ee73fe61f21",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Cart created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);"
                ]
              }
            }
          ],
          "_postman_id": "a4d97d9e-6cbd-4277-b7ff-cd1a3f80e6a4",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"currency\": \"USD\",\r\n   \"items\":[\r\n      {\r\n         \"product_id\":\"digital.test\",\r\n         \"quantity\":3\r\n      },   \t\r\n      {\r\n         \"product_id\":\"physical.test\",\r\n         \"quantity\":2\r\n      }        \r\n   ],\r\n  \"customer\": {\r\n    \"name\": \"{{name}}\",\r\n    \"email\": \"{{email}}\",\r\n    \"billing_address\": {\r\n        \"address_1\": \"{{address_1}}\",\r\n        \"city\": \"{{city}}\",\r\n        \"state_prov\": \"{{state_prov}}\",\r\n        \"postal_code\": \"{{postal_code}}\",\r\n        \"country\": \"{{country}}\"\r\n    }   \r\n  }\r\n}"
            },
            "url": "https://{{host}}/api/v1/carts"
          },
          "response": []
        },
        {
          "name": "Create Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"order_url\", data.order);",
                  "pm.globals.set(\"payment_url\", data.url);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "44d20936-4c8e-4546-a834-61b7eb79cb87",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"capture\": true,    \n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "{{cart_url}}/payments"
          },
          "response": []
        },
        {
          "name": "Submit Refund",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "466c1548-eabb-4a62-96f5-df16d621b469",
                "exec": [
                  "tests[\"Refund created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Refund was successful\"] = data.total === 100 && data.subtotal === 90 && data.shipping === 10 && data.tax === 0;",
                  "",
                  "pm.globals.set(\"customer_url\", data.refunds[0].customer);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "45866749-11d4-407a-8ced-39a0f7e9fa4a",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"payment_method\": {\n        \"type\": \"customer_account_balance\"\n    }\n}"
            },
            "url": {
              "raw": "{{order_url}}/refunds?expand=refunds.payment_method",
              "host": [
                "{{order_url}}"
              ],
              "path": [
                "refunds"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "refunds.payment_method"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Check CAB",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "466c1548-eabb-4a62-96f5-df16d621b469",
                "exec": [
                  "tests[\"Balance fetched successfully\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Balance is correct\"] = data.amount === 100;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "d229054e-3d16-456a-be19-6a3694ffcfd3",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"payment_method\": {\n\t\t\"type\": \"customer_account_balance\"\n\t}\n}"
            },
            "url": "{{customer_url}}/balance"
          },
          "response": []
        },
        {
          "name": "Process Chargeback",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "466c1548-eabb-4a62-96f5-df16d621b469",
                "exec": [
                  "tests[\"Chargeback created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Chargeback was successful\"] = data.total === 60;",
                  "",
                  "pm.globals.set(\"customer_url\", data.customer);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "62b4ac60-4ed1-411c-bba5-20e18fe8096f",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"is_chargeback\": true,\n\t\"total\": 60\n}"
            },
            "url": {
              "raw": "{{payment_url}}/refunds?expand=refunds.payment_method",
              "host": [
                "{{payment_url}}"
              ],
              "path": [
                "refunds"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "refunds.payment_method"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Check CAB (2)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "466c1548-eabb-4a62-96f5-df16d621b469",
                "exec": [
                  "tests[\"Balance fetched successfully\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Balance is correct\"] = data.amount === 40;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "1cfaa0e8-6233-48d7-ae2b-8ba4475c490a",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"payment_method\": {\n\t\t\"type\": \"customer_account_balance\"\n\t}\n}"
            },
            "url": "{{customer_url}}/balance"
          },
          "response": []
        },
        {
          "name": "Process Chargeback (2)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "466c1548-eabb-4a62-96f5-df16d621b469",
                "exec": [
                  "tests[\"Chargeback created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Chargeback was successful\"] = data.total === 40;",
                  "",
                  "pm.globals.set(\"customer_url\", data.customer);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "137fb08f-2e0a-4c32-9f72-f273d227b224",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"is_chargeback\": true,\n\t\"total\": 40\n}"
            },
            "url": {
              "raw": "{{payment_url}}/refunds?expand=refunds.payment_method",
              "host": [
                "{{payment_url}}"
              ],
              "path": [
                "refunds"
              ],
              "query": [
                {
                  "key": "expand",
                  "value": "refunds.payment_method"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Check CAB (3)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "466c1548-eabb-4a62-96f5-df16d621b469",
                "exec": [
                  "tests[\"Balance fetched successfully\"] = responseCode.code === 200;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Balance is correct\"] = data.amount === 0;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "d13c191a-a154-4727-ac97-2f6b99814664",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"payment_method\": {\n\t\t\"type\": \"customer_account_balance\"\n\t}\n}"
            },
            "url": "{{customer_url}}/balance"
          },
          "response": []
        }
      ],
      "_postman_id": "6a86a0eb-a28d-44ef-9fe6-2f3580cea443"
    },
    {
      "name": "From Order, Single Payment, Order Level Discount",
      "item": [
        {
          "name": "Create Coupon: 40% off Order",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "11f7ecaf-d06d-4487-b346-967fa0f15101",
                "exec": [
                  "tests[\"Status code is 201\"] = responseCode.code === 201;",
                  "",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "if (data.url) {",
                  "    pm.globals.set(\"coupon_url\", data.url);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "dc9dfc60-1370-4431-9fd4-5373ef19b112",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"apply_to_recurring\": false,\n    \"active\": true,\n    \"config\": {\n        \"type\": \"order\",\n        \"code\": \"forty-off-order\",\n        \"discount_percent\": 0.4\n    },\n    \"name\": \"40% off Order\",\n    \"type\": \"coupon\"\n}"
            },
            "url": "https://{{host}}/api/v1/promotions"
          },
          "response": []
        },
        {
          "name": "Create Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "3a0eecbc-a75e-4942-a4bf-2ee73fe61f21",
                "exec": [
                  "tests[\"Cart created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "0b9362c0-bffa-4b5f-94cc-49d5065d80da",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"promotion_code\": \"forty-off-order\",\n    \"currency\": \"USD\",\n    \"items\": [\n        {\n            \"product_id\": \"digital.test\",\n            \"quantity\": 3\n        }\n    ],\n    \"customer\": {\n        \"name\": \"{{name}}\",\n        \"email\": \"{{email}}\",\n        \"billing_address\": {\n            \"address_1\": \"{{address_1}}\",\n            \"city\": \"{{city}}\",\n            \"state_prov\": \"{{state_prov}}\",\n            \"postal_code\": \"{{postal_code}}\",\n            \"country\": \"{{country}}\"\n        }\n    }\n}"
            },
            "url": "https://{{host}}/api/v1/carts"
          },
          "response": []
        },
        {
          "name": "Create Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"order_url\", data.order);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "342bb27c-6e02-43be-9bd2-cef330f82483",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"capture\": true,    \n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "{{cart_url}}/payments"
          },
          "response": []
        },
        {
          "name": "Submit Refund",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "3c71742a-d648-4a47-8acf-1ea1c2532396",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Refund was successful\"] = data.total === 5 && data.subtotal === 5 && data.tax === 0 && data.shipping === 0;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "74bbd129-7f90-40f9-b805-ef6037708989",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"total\": 5\n}"
            },
            "url": "{{order_url}}/refunds"
          },
          "response": []
        },
        {
          "name": "Create Cart w/ Tax, Shipping",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "3a0eecbc-a75e-4942-a4bf-2ee73fe61f21",
                "exec": [
                  "tests[\"Cart created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"cart_url\", data.url);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "091876e5-f94c-48cc-b5ed-95efaf2ff0f9",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"promotion_code\": \"forty-off-order\",\n    \"currency\": \"USD\",\n    \"items\": [\n        {\n            \"product_id\": \"physical.test\",\n            \"quantity\": 3\n        }\n    ],\n    \"customer\": {\n        \"name\": \"{{name}}\",\n        \"email\": \"{{email}}\",\n        \"billing_address\": {\n            \"address_1\": \"{{address_1}}\",\n            \"city\": \"{{city}}\",\n            \"state_prov\": \"CA\",\n            \"postal_code\": \"90210\",\n            \"country\": \"US\"\n        }\n    }\n}"
            },
            "url": "https://{{host}}/api/v1/carts"
          },
          "response": []
        },
        {
          "name": "Create Payment w/Tax, Shipping",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "6e193edc-602f-4356-8557-fd2cbb35b887",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "pm.globals.set(\"order_url\", data.order);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "5931d725-ce32-4b7a-86d1-2e1b26722996",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n   \"capture\": true,    \n   \"payment_method\":{\n     \"save\": true,\n     \"type\": \"credit_card\",\n      \"data\":{\n         \"number\":\"4444555566661111\",\n         \"cvv\":123,\n         \"exp_month\":12,\n         \"exp_year\":2022,\n         \"cardholder_name\":\"{{name}}\",\n         \"billing_address\":{\n            \"address_1\":\"{{address_1}}.\",\n            \"city\":\"{{city}}\",\n            \"state_prov\":\"{{state_prov}}\",\n            \"postal_code\":\"{{postal_code}}\",\n            \"country\":\"{{country}}\"\n         }\n      }\n   }\n}"
            },
            "url": "{{cart_url}}/payments"
          },
          "response": []
        },
        {
          "name": "Delete Coupon",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "11f7ecaf-d06d-4487-b346-967fa0f15101",
                "exec": [
                  "tests[\"Status code is 204\"] = responseCode.code === 204;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "bfa27727-3b28-4692-8582-9b63817216c4",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "{{coupon_url}}"
          },
          "response": []
        },
        {
          "name": "Submit Refund w/Tax, Shipping",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "3c71742a-d648-4a47-8acf-1ea1c2532396",
                "exec": [
                  "tests[\"Payment created successfully\"] = responseCode.code === 201;",
                  "var data = JSON.parse(responseBody);",
                  "",
                  "tests[\"Refund was successful\"] = data.total === 10 && data.subtotal === 7.67 && data.tax === 0.79 && data.shipping === 1.54;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "99bd71e2-127f-47c5-a088-8adb20f3cc85",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"total\": 10\n}"
            },
            "url": "{{order_url}}/refunds"
          },
          "response": []
        }
      ],
      "_postman_id": "6873f127-04fa-496e-a6e0-cb167de4ff26"
    },
    {
      "name": "Post-request Cleanup",
      "item": [
        {
          "name": "Enable Duplicate Payment Checker",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "82452e4c-9550-4daa-8063-f5b84f40aee0",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Payment email notifications have been disabled\"] = responseCode.code === 200;",
                  "",
                  ""
                ]
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "aba03a74-55f6-4b4f-9ff9-e0e92a9f735a",
                "type": "text/javascript",
                "exec": [
                  ""
                ]
              }
            }
          ],
          "_postman_id": "eb942784-a8de-4ae6-b4e7-4ea57720b405",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"duplicate_payment_timeout\": 120\n}"
            },
            "url": "https://{{host}}/api/v1/settings/payment",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "name": "Enable Order Notification Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "930c5570-6aa0-4d4d-8d90-448b23b70c0e",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Order email notifications have been enabled\"] = responseCode.code === 200;"
                ]
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "aba03a74-55f6-4b4f-9ff9-e0e92a9f735a",
                "type": "text/javascript",
                "exec": [
                  ""
                ]
              }
            }
          ],
          "_postman_id": "d0a0d472-93d2-4b18-b3ea-89249d841310",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"active\": true\n}"
            },
            "url": "{{order_confirmation_subscription_url}}",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "name": "Enable Payment Notification Subscription",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "f416fa82-c105-4be9-a221-b1ddfb31e205",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Payment email notifications have been enabled\"] = responseCode.code === 200;",
                  "",
                  ""
                ]
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "aba03a74-55f6-4b4f-9ff9-e0e92a9f735a",
                "type": "text/javascript",
                "exec": [
                  ""
                ]
              }
            }
          ],
          "_postman_id": "17a20ac9-d78c-4848-9e27-3a55ba22b6a2",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"active\": true\n}"
            },
            "url": "{{payment_confirmation_subscription_url}}",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        },
        {
          "name": "Enable Refund Notification Subscription Copy",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "0f0314b8-4191-4fe3-abd2-0fba509ce142",
                "type": "text/javascript",
                "exec": [
                  "tests[\"Payment email notifications have been enabled\"] = responseCode.code === 200;",
                  "pm.globals.unset(\"payment_url\");",
                  "pm.globals.unset(\"cart_url\");",
                  "pm.globals.unset(\"order_confirmation_subscription_url\");",
                  "pm.globals.unset(\"payment_confirmation_subscription_url\");",
                  "pm.globals.unset(\"refund_confirmation_subscription_url\");",
                  "",
                  ""
                ]
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "aba03a74-55f6-4b4f-9ff9-e0e92a9f735a",
                "type": "text/javascript",
                "exec": [
                  ""
                ]
              }
            }
          ],
          "_postman_id": "ae24805c-529f-46a0-a4ee-72937413b1be",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n\t\"active\": true\n}"
            },
            "url": "{{refund_confirmation_subscription_url}}",
            "description": "- This set of tests expects you to use the [Customer Data Subscriptions](https://docs.google.com/spreadsheets/d/14wnj6iScmBw6jANOGR4Ki71uVzn5dZgE0KFAGEbz6LI/edit#gid=0) data collection in the runner.\n- This set of tests expects you to be using the Base Account."
          },
          "response": []
        }
      ],
      "_postman_id": "94a42b9f-5156-4ba1-af0d-017fee50f55a"
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "id": "e38a0227-2a65-4525-b4df-605b0407f9f1",
        "type": "text/javascript",
        "exec": [
          ""
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "id": "8ddd01dd-1386-4596-a0dc-b4c1be5962cd",
        "type": "text/javascript",
        "exec": [
          ""
        ]
      }
    }
  ],
  "variable": [
    {
      "id": "9a51326d-5312-4b58-847b-55b582be0578",
      "key": "name",
      "value": "James Smith",
      "type": "string"
    },
    {
      "id": "7bdb263b-f6a4-4b6c-b07c-d9d5e6dff97d",
      "key": "address_1",
      "value": "648 Broad St",
      "type": "string"
    },
    {
      "id": "5100ad90-2845-4e8a-9ca8-5933c352ca2f",
      "key": "city",
      "value": "Westerville",
      "type": "string"
    },
    {
      "id": "14cd781b-30e3-40ca-8c52-dc405e5d602f",
      "key": "state_prov",
      "value": "OH",
      "type": "string"
    },
    {
      "id": "c7b72c5c-a5ff-4f58-bdab-a4fcd9fb146a",
      "key": "postal_code",
      "value": "43081",
      "type": "string"
    },
    {
      "id": "8570c899-f968-412d-913b-9b6369b072d2",
      "key": "country",
      "value": "US",
      "type": "string"
    },
    {
      "id": "24bee497-8dd9-4ce1-bf0d-c7b73b0fbb39",
      "key": "phone",
      "value": "614-555-0191",
      "type": "string"
    }
  ]
}